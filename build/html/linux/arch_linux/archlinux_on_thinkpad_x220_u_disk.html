<!DOCTYPE html>
<html class="writer-html5" lang="zh" data-content_root="../../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ThinkPad X220上运行Arch Linux(U盘) &mdash; Cloud Atlas: Discovery beta 文档</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/theme.css?v=19f00094" />
      <link rel="stylesheet" type="text/css" href="../../_static/graphviz.css?v=fd3f3429" />

  
    <link rel="shortcut icon" href="../../_static/favicon.png"/>
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../../_static/jquery.js?v=5d32c60e"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../../_static/documentation_options.js?v=8534f863"></script>
        <script src="../../_static/doctools.js?v=9a2dae69"></script>
        <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="索引" href="../../genindex.html" />
    <link rel="search" title="搜索" href="../../search.html" />
    <link rel="copyright" title="版权所有" href="../../copyright.html" />
    <link rel="next" title="MacBook Air上运行Arch Linux" href="archlinux_on_mba.html" />
    <link rel="prev" title="ThinkPad X220上运行Arch Linux" href="archlinux_on_thinkpad_x220.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            Cloud Atlas: Discovery
          </a>
              <div class="version">
                1.1
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="搜索文档" aria-label="搜索文档" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="导航菜单">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../studio/index.html">Studio</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../infrastructure/index.html">Infrastructure</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../devops/index.html">DevOps</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../kvm/index.html">KVM</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ceph/index.html">Ceph</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../gluster/index.html">Gluster</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ovirt/index.html">oVirt</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../openstack/index.html">OpenStack</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../docker/index.html">Docker</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../kubernetes/index.html">Kubernetes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../k8s_dev/index.html">Kubernetes Develop</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../rancher/index.html">Rancher</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../openshift/index.html">OpenShift</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../sql/index.html">SQL</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../sqlite/index.html">SQLite</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../mysql/index.html">MySQL</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../pgsql/index.html">PostgreSQL</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../nosql/index.html">NoSQL</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../network/index.html">Network</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../infra_service/index.html">Infra-Service</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../infra_search/index.html">Infra-Search</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../web/index.html">Web</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../info_service/index.html">Info-Service</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../big_data/index.html">Big Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../machine_learning/index.html">Machine Learning</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../drone/index.html">Drone</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">Linux</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../best_linux.html">最佳Linux</a></li>
<li class="toctree-l2"><a class="reference internal" href="../admin/index.html">Linux系统管理</a></li>
<li class="toctree-l2"><a class="reference internal" href="../redhat_linux/index.html">RedHat Linux</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html">Arch Linux</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="intro_archlinux.html">Arch Linux简介</a></li>
<li class="toctree-l3"><a class="reference internal" href="best_archlinux.html">最佳Arch Linux发行版</a></li>
<li class="toctree-l3"><a class="reference internal" href="archlinux_on_mbp.html">MacBook Pro上运行Arch Linux</a></li>
<li class="toctree-l3"><a class="reference internal" href="archlinux_on_thinkpad_x220.html">ThinkPad X220上运行Arch Linux</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">ThinkPad X220上运行Arch Linux(U盘)</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id1">准备工作</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id2">有线网络设置</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id3">准备工作</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id4">安装</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id5">配置</a></li>
<li class="toctree-l4"><a class="reference internal" href="#root">Root密码及用户账号</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id7">安装系统工具</a></li>
<li class="toctree-l4"><a class="reference internal" href="#efistub">使用EFISTUB启动(失败)</a></li>
<li class="toctree-l4"><a class="reference internal" href="#boot-loader-grub">安装Boot Loader - GRUB</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id8">安装必要软件包</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id9">网络配置</a></li>
<li class="toctree-l4"><a class="reference internal" href="#ip">静态IP</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id10">无线网络</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id11">参考</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="archlinux_on_mba.html">MacBook Air上运行Arch Linux</a></li>
<li class="toctree-l3"><a class="reference internal" href="kinto.html">Kinto.sh - 为Linux/Windows提供 <code class="docutils literal notranslate"><span class="pre">Mac风格快捷键</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="archlinux_init.html">Arch Linux精简系统初始化</a></li>
<li class="toctree-l3"><a class="reference internal" href="archlinux_chinese_mirrorlist.html">arch linux添加国内源(mirrorlist)</a></li>
<li class="toctree-l3"><a class="reference internal" href="archlinux_config_ip.html">arch linux配置IP(静态或动态)</a></li>
<li class="toctree-l3"><a class="reference internal" href="archlinux_wpa_supplicant.html">arch linux使用wpa_supplicant连接无线网络</a></li>
<li class="toctree-l3"><a class="reference internal" href="archlinux_sway.html">archlinux Sway图形桌面</a></li>
<li class="toctree-l3"><a class="reference internal" href="archlinux_chinese.html">arch linux中文环境</a></li>
<li class="toctree-l3"><a class="reference internal" href="archlinux_sway_chinese.html">archlinux Sway图形桌面和中文环境</a></li>
<li class="toctree-l3"><a class="reference internal" href="archlinux_ms_fonts.html">Arch Linux Windows字体</a></li>
<li class="toctree-l3"><a class="reference internal" href="archlinux_vultr.html">在Vultr VPS中运行Arch Linux</a></li>
<li class="toctree-l3"><a class="reference internal" href="pacman.html">Pacman</a></li>
<li class="toctree-l3"><a class="reference internal" href="pacman_proxy.html">pacman使用代理服务器</a></li>
<li class="toctree-l3"><a class="reference internal" href="archlinux_downgrade_package.html">arch linux降级软件包</a></li>
<li class="toctree-l3"><a class="reference internal" href="archlinux_aur.html">Arch Linux AUR</a></li>
<li class="toctree-l3"><a class="reference internal" href="archlinux_snap.html">Arch Linux运行snap</a></li>
<li class="toctree-l3"><a class="reference internal" href="archlinux_alsa.html">Arch Linux ALSA声音系统</a></li>
<li class="toctree-l3"><a class="reference internal" href="archlinux_hibernates.html">Arch Linux Hibernates</a></li>
<li class="toctree-l3"><a class="reference internal" href="alien_convert_package.html">alien转换安装包</a></li>
<li class="toctree-l3"><a class="reference internal" href="archlinux_developer.html">Arch Linux开发环境</a></li>
<li class="toctree-l3"><a class="reference internal" href="xmodmap.html">Xmodmap修改键盘映射</a></li>
<li class="toctree-l3"><a class="reference internal" href="dropbox.html">Arch Linux上使用Dropbox</a></li>
<li class="toctree-l3"><a class="reference internal" href="cross_compile.html">交叉编译</a></li>
<li class="toctree-l3"><a class="reference internal" href="archlinux_makepkg.html">Arch Linux makepkg</a></li>
<li class="toctree-l3"><a class="reference internal" href="archlinux_wine.html">ArchLinux平台wine环境运行Windows程序</a></li>
<li class="toctree-l3"><a class="reference internal" href="archlinux_build_kernel.html">Arch Linux编译内核</a></li>
<li class="toctree-l3"><a class="reference internal" href="archlinux_kernel.html">Arch Linux 内核</a></li>
<li class="toctree-l3"><a class="reference internal" href="archlinux_novnc.html">在浏览器中访问arch linux(noVNC)</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../asahi_linux/index.html">Asahi Linux</a></li>
<li class="toctree-l2"><a class="reference internal" href="../gentoo_linux/index.html">Gentoo Linux</a></li>
<li class="toctree-l2"><a class="reference internal" href="../lfs/index.html">LFS(Linux from scratch)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../blfs/index.html">BLFS(Beyond Linux from scratch)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../alfs/index.html">ALFS(Automated Linux from scratch)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pilfs/index.html">PiLFS(Automated Linux from scratch on the Raspberry Pi)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../yocto/index.html">Yocto</a></li>
<li class="toctree-l2"><a class="reference internal" href="../debian/index.html">Debian</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ubuntu_linux/index.html">Ubuntu Linux</a></li>
<li class="toctree-l2"><a class="reference internal" href="../suse_linux/index.html">SUSE Linux</a></li>
<li class="toctree-l2"><a class="reference internal" href="../kali_linux/index.html">Kali Linux</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tails_linux/index.html">Tails Linux</a></li>
<li class="toctree-l2"><a class="reference internal" href="../qubes_os/index.html">Qubes OS</a></li>
<li class="toctree-l2"><a class="reference internal" href="../postmarketos/index.html">postmarketOS</a></li>
<li class="toctree-l2"><a class="reference internal" href="../container_os/index.html">容器化操作系统(Container OS)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../fedora_coreos/index.html">Fedora CoreOS容器操作系统</a></li>
<li class="toctree-l2"><a class="reference internal" href="../chromeos/index.html">ChromeOS</a></li>
<li class="toctree-l2"><a class="reference internal" href="../alpine_linux/index.html">Alpine Linux</a></li>
<li class="toctree-l2"><a class="reference internal" href="../subgraph_os/index.html">Subgraph OS</a></li>
<li class="toctree-l2"><a class="reference internal" href="../kaios/index.html">KaiOS - 世界第三手机操作系统</a></li>
<li class="toctree-l2"><a class="reference internal" href="../compute/index.html">Linux计算</a></li>
<li class="toctree-l2"><a class="reference internal" href="../storage/index.html">Linux存储</a></li>
<li class="toctree-l2"><a class="reference internal" href="../network/index.html">Linux网络</a></li>
<li class="toctree-l2"><a class="reference internal" href="../server/index.html">Linux服务器</a></li>
<li class="toctree-l2"><a class="reference internal" href="../security/index.html">Linux安全</a></li>
<li class="toctree-l2"><a class="reference internal" href="../desktop/index.html">Linux桌面</a></li>
<li class="toctree-l2"><a class="reference internal" href="../linux_tablet/index.html">Linux平板</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../kernel/index.html">Kernel</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../performance/index.html">Performance</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../distributed_system/index.html">Distributed System</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../shell/index.html">Shell</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../python/index.html">Python</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../django/index.html">Django</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../javascript/index.html">JavaScript</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../nodejs/index.html">Node.js</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../clang/index.html">C</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../golang/index.html">Go</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../swift/index.html">Swift</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../rust/index.html">Rust</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ruby/index.html">Ruby</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../lua/index.html">Lua</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../arm/index.html">ARM</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../raspberry_pi/index.html">Raspberry Pi</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../android/index.html">Android</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../bsd/index.html">BSD</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../freebsd/index.html">FreeBSD</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../apple/index.html">Apple</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../windows/index.html">Windows</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../real/index.html">Real</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../management/index.html">Management</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../life/index.html">Life</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../copyright.html">Copyright</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../aboutme.html">关于作者</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../donate.html">捐赠</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../thanks.html">感谢</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../roadmap.html">Roadmap</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../appendix/index.html">附录</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="移动版导航菜单" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Cloud Atlas: Discovery</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="页面导航">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../index.html">Linux</a></li>
          <li class="breadcrumb-item"><a href="index.html">Arch Linux</a></li>
      <li class="breadcrumb-item active">ThinkPad X220上运行Arch Linux(U盘)</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../_sources/linux/arch_linux/archlinux_on_thinkpad_x220_u_disk.rst.txt" rel="nofollow"> 查看页面源码</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="thinkpad-x220arch-linux-u">
<span id="archlinux-on-thinkpad-x220-u-disk"></span><h1>ThinkPad X220上运行Arch Linux(U盘)<a class="headerlink" href="#thinkpad-x220arch-linux-u" title="Link to this heading"></a></h1>
<p>之前在 <a class="reference internal" href="archlinux_on_thinkpad_x220.html#archlinux-on-thinkpad-x220"><span class="std std-ref">ThinkPad X220上运行Arch Linux</span></a> 是作为个人工作站，随着我在 <a class="reference internal" href="../../real/priv_cloud/priv_cloud_infra.html#priv-cloud-infra"><span class="std std-ref">私有云架构</span></a> 部署需要有独立主机来实现带外管理和监控，并且ThinkPad X220已经不作为主工作桌面，硬盘已经拆除，所以将ThinkPad X220上安装U盘来运行一个经鉴定  <a class="reference internal" href="index.html#arch-linux"><span class="std std-ref">Arch Linux</span></a> 。</p>
<div class="admonition warning">
<p class="admonition-title">警告</p>
<p>我最初以为在U盘上安装Arch Linux和 <a class="reference internal" href="archlinux_on_thinkpad_x220.html#archlinux-on-thinkpad-x220"><span class="std std-ref">ThinkPad X220上运行Arch Linux</span></a> 是一样的 ，毕竟拆掉了SSD硬盘之后，插入的U盘也被识别成 <code class="docutils literal notranslate"><span class="pre">/dev/sda</span></code> 设备。然而，实践发现，同样的步骤安装 <code class="docutils literal notranslate"><span class="pre">EFISTUB</span></code> 启动却失败。原来还是需要配置一个启动管理器。</p>
</div>
<section id="id1">
<h2>准备工作<a class="headerlink" href="#id1" title="Link to this heading"></a></h2>
<ul>
<li><p>创建安装U盘:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">dd</span> <span class="k">if</span><span class="o">=</span><span class="n">archlinux</span><span class="o">-</span><span class="mf">2022.06.01</span><span class="o">-</span><span class="n">x86_64</span><span class="o">.</span><span class="n">iso</span> <span class="n">of</span><span class="o">=/</span><span class="n">dev</span><span class="o">/</span><span class="n">rdisk3</span> <span class="n">bs</span><span class="o">=</span><span class="mi">10</span><span class="n">m</span>
</pre></div>
</div>
</li>
</ul>
<p>将U盘插到ThnkPad X220的USB接口，启动主机，选择U盘启动，字符终端</p>
<ul>
<li><p>Arch Linux安装需要网络，在 <a class="reference internal" href="../../studio/hardware/thinkpad_x220.html#thinkpad-x220"><span class="std std-ref">ThinkPad X220笔记本</span></a> 上可以自动识别网络设备，所以安装比 <a class="reference internal" href="archlinux_on_mbp.html#archlinux-on-mbp"><span class="std std-ref">MacBook Pro上运行Arch Linux</span></a> 方便很多:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ip</span> <span class="n">link</span>
</pre></div>
</div>
</li>
</ul>
<p>可以看到:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">enp0s25</span>
<span class="n">wlan0</span>
</pre></div>
</div>
</section>
<section id="id2">
<h2>有线网络设置<a class="headerlink" href="#id2" title="Link to this heading"></a></h2>
<p>默认启动dhcp分配IP地址，所以如果有线局域网已经提供DHCP服务，则可以自动分配IP地址连接网络。 默认安装系统是已经启动了sshd服务，就可以远程登陆系统进行下一步安装</p>
<ul>
<li><p>如果网络没有提供DHCP服务，则采用静态IP配置:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ip</span> <span class="n">address</span> <span class="n">add</span> <span class="mf">192.168.6.199</span><span class="o">/</span><span class="mi">24</span> <span class="n">dev</span> <span class="n">enp0s25</span>
<span class="n">ip</span> <span class="n">route</span> <span class="n">add</span> <span class="mf">0.0.0.0</span> <span class="n">via</span> <span class="mf">192.168.6.200</span> <span class="n">dev</span> <span class="n">enp0s25</span>
<span class="n">ip</span> <span class="n">link</span> <span class="nb">set</span> <span class="n">enp0s25</span> <span class="n">up</span>
</pre></div>
</div>
</li>
</ul>
</section>
<section id="id3">
<h2>准备工作<a class="headerlink" href="#id3" title="Link to this heading"></a></h2>
<ul>
<li><p>更新系统时钟:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">timedatectl</span> <span class="nb">set</span><span class="o">-</span><span class="n">ntp</span> <span class="n">true</span>
</pre></div>
</div>
</li>
<li><p><a class="reference internal" href="../storage/disk/parted.html#parted"><span class="std std-ref">parted分区工具</span></a> 磁盘分区(128G规格):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">parted</span> <span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">sda</span> <span class="n">mklabel</span> <span class="n">gpt</span>
<span class="n">parted</span> <span class="o">-</span><span class="n">a</span> <span class="n">optimal</span> <span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">sda</span> <span class="n">mkpart</span> <span class="n">ESP</span> <span class="n">fat32</span> <span class="mi">0</span><span class="o">%</span> <span class="mi">256</span><span class="n">MB</span>
<span class="n">parted</span> <span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">sda</span> <span class="nb">set</span> <span class="mi">1</span> <span class="n">esp</span> <span class="n">on</span>
<span class="n">parted</span> <span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">sda</span> <span class="nb">set</span> <span class="mi">1</span> <span class="n">boot</span> <span class="n">on</span>
<span class="n">parted</span> <span class="o">-</span><span class="n">a</span> <span class="n">optimal</span> <span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">sda</span> <span class="n">mkpart</span> <span class="n">primary</span> <span class="n">xfs</span> <span class="mi">256</span><span class="n">MB</span> <span class="mi">100</span><span class="o">%</span>
</pre></div>
</div>
</li>
</ul>
<div class="admonition note">
<p class="admonition-title">备注</p>
<ul class="simple">
<li><p>/dev/sdb1 划分为 EFI系统分区，大小 260-512MB</p></li>
<li><p>/dev/sdb2 根分区，大小100+GB(剩余空间)</p></li>
</ul>
</div>
<p>完成后检查 <code class="docutils literal notranslate"><span class="pre">fdisk</span> <span class="pre">-l</span></code> 可以看到:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Disk</span> <span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">sda</span><span class="p">:</span> <span class="mf">115.69</span> <span class="n">GiB</span><span class="p">,</span> <span class="mi">124218507264</span> <span class="nb">bytes</span><span class="p">,</span> <span class="mi">242614272</span> <span class="n">sectors</span>
<span class="n">Disk</span> <span class="n">model</span><span class="p">:</span> <span class="n">Ultra</span> <span class="n">Fit</span>
<span class="n">Units</span><span class="p">:</span> <span class="n">sectors</span> <span class="n">of</span> <span class="mi">1</span> <span class="o">*</span> <span class="mi">512</span> <span class="o">=</span> <span class="mi">512</span> <span class="nb">bytes</span>
<span class="n">Sector</span> <span class="n">size</span> <span class="p">(</span><span class="n">logical</span><span class="o">/</span><span class="n">physical</span><span class="p">):</span> <span class="mi">512</span> <span class="nb">bytes</span> <span class="o">/</span> <span class="mi">512</span> <span class="nb">bytes</span>
<span class="n">I</span><span class="o">/</span><span class="n">O</span> <span class="n">size</span> <span class="p">(</span><span class="n">minimum</span><span class="o">/</span><span class="n">optimal</span><span class="p">):</span> <span class="mi">512</span> <span class="nb">bytes</span> <span class="o">/</span> <span class="mi">512</span> <span class="nb">bytes</span>
<span class="n">Disklabel</span> <span class="nb">type</span><span class="p">:</span> <span class="n">gpt</span>
<span class="n">Disk</span> <span class="n">identifier</span><span class="p">:</span> <span class="n">FD028129</span><span class="o">-</span><span class="mi">1</span><span class="n">CA4</span><span class="o">-</span><span class="mi">4370</span><span class="o">-</span><span class="n">BAF7</span><span class="o">-</span><span class="mi">510</span><span class="n">BF30CED83</span>

<span class="n">Device</span>      <span class="n">Start</span>       <span class="n">End</span>   <span class="n">Sectors</span>   <span class="n">Size</span> <span class="n">Type</span>
<span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">sda1</span>    <span class="mi">2048</span>    <span class="mi">499711</span>    <span class="mi">497664</span>   <span class="mi">243</span><span class="n">M</span> <span class="n">EFI</span> <span class="n">System</span>
<span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">sda2</span>  <span class="mi">499712</span> <span class="mi">242612223</span> <span class="mi">242112512</span> <span class="mf">115.4</span><span class="n">G</span> <span class="n">Linux</span> <span class="n">filesystem</span>
</pre></div>
</div>
<ul>
<li><p>格式化分区:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">mkdosfs</span> <span class="o">-</span><span class="n">F</span> <span class="mi">32</span> <span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">sda1</span>
<span class="n">mkfs</span><span class="o">.</span><span class="n">xfs</span> <span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">sda2</span>
</pre></div>
</div>
</li>
<li><p>(废弃，针对EFISTUB的方法)挂载文件系统:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">mount</span> <span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">sda2</span> <span class="o">/</span><span class="n">mnt</span>
<span class="n">mkdir</span> <span class="o">/</span><span class="n">mnt</span><span class="o">/</span><span class="n">boot</span>
<span class="n">mount</span> <span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">sda1</span> <span class="o">/</span><span class="n">mnt</span><span class="o">/</span><span class="n">boot</span>
</pre></div>
</div>
</li>
<li><p>(正确，采用GRUB)挂在文件系统:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">mount</span> <span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">sda2</span> <span class="o">/</span><span class="n">mnt</span>
</pre></div>
</div>
</li>
</ul>
</section>
<section id="id4">
<h2>安装<a class="headerlink" href="#id4" title="Link to this heading"></a></h2>
<ul>
<li><p>安装基本软件包:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pacstrap</span> <span class="o">/</span><span class="n">mnt</span> <span class="n">base</span> <span class="n">linux</span> <span class="n">linux</span><span class="o">-</span><span class="n">firmware</span>
</pre></div>
</div>
</li>
</ul>
</section>
<section id="id5">
<h2>配置<a class="headerlink" href="#id5" title="Link to this heading"></a></h2>
<ul class="simple">
<li><p>fstab</p></li>
</ul>
<p>生成fstab文件(这里 <code class="docutils literal notranslate"><span class="pre">-U</span></code> 或 <code class="docutils literal notranslate"><span class="pre">-L</span></code> 定义UUID或labels):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">genfstab</span> <span class="o">-</span><span class="n">U</span> <span class="o">/</span><span class="n">mnt</span> <span class="o">&gt;&gt;</span> <span class="o">/</span><span class="n">mnt</span><span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">fstab</span>
</pre></div>
</div>
<ul class="simple">
<li><p>chroot</p></li>
</ul>
<p>将根修改到新系统:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">arch</span><span class="o">-</span><span class="n">chroot</span> <span class="o">/</span><span class="n">mnt</span>
</pre></div>
</div>
<ul>
<li><p>设置时区:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ln</span> <span class="o">-</span><span class="n">sf</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">share</span><span class="o">/</span><span class="n">zoneinifo</span><span class="o">/</span><span class="n">Asia</span><span class="o">/</span><span class="n">Shanghai</span> <span class="o">/</span><span class="n">etcc</span><span class="o">/</span><span class="n">localtime</span>
</pre></div>
</div>
</li>
</ul>
<p>运行 hwclock 生成 /etc/cadjtime</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">hwclock</span> <span class="o">--</span><span class="n">systohc</span>
</pre></div>
</div>
<ul>
<li><p>安装简化版vi作为服务器配置维护工具:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pacman</span> <span class="o">-</span><span class="n">S</span> <span class="n">vi</span>
</pre></div>
</div>
</li>
<li><p>本地化语言支持 - 只需要UTF支持就可以，所以修改 <code class="docutils literal notranslate"><span class="pre">/etc/locale.gen</span></code> 保留 <code class="docutils literal notranslate"><span class="pre">en_US.UTF-8</span> <span class="pre">UTF-8</span></code> 然后执行:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">locale</span><span class="o">-</span><span class="n">gen</span>
</pre></div>
</div>
</li>
</ul>
<p>创建 <code class="docutils literal notranslate"><span class="pre">locale.conf</span></code> 设置如下:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">LANG</span><span class="o">=</span><span class="n">en_US</span><span class="o">.</span><span class="n">UTF</span><span class="o">-</span><span class="mi">8</span>
</pre></div>
</div>
<section id="id6">
<h3>网络配置<a class="headerlink" href="#id6" title="Link to this heading"></a></h3>
<ul>
<li><p>创建 <code class="docutils literal notranslate"><span class="pre">/etc/hostname</span></code> 文件，内容是主机名:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">acloud</span>
</pre></div>
</div>
</li>
<li><p>编辑 <code class="docutils literal notranslate"><span class="pre">/etc/hosts</span></code></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mf">127.0.0.1</span>    <span class="n">localhost</span>
<span class="mf">127.0.0.1</span>    <span class="n">acloud</span><span class="o">.</span><span class="n">staging</span><span class="o">.</span><span class="n">huatai</span><span class="o">.</span><span class="n">me</span> <span class="n">acloud</span>
</pre></div>
</div>
</li>
</ul>
</section>
</section>
<section id="root">
<h2>Root密码及用户账号<a class="headerlink" href="#root" title="Link to this heading"></a></h2>
<ul>
<li><p>设置root密码:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">passwd</span>
</pre></div>
</div>
</li>
<li><p>设置日常账号:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">groupadd</span> <span class="o">-</span><span class="n">g</span> <span class="mi">20</span> <span class="n">staff</span>
<span class="n">useradd</span> <span class="o">-</span><span class="n">g</span> <span class="mi">20</span> <span class="o">-</span><span class="n">u</span> <span class="mi">502</span> <span class="o">-</span><span class="n">d</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">huatai</span> <span class="o">-</span><span class="n">m</span> <span class="n">huatai</span>
<span class="n">passwd</span> <span class="n">huatai</span>
</pre></div>
</div>
</li>
<li><p>设置sudo:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pacman</span> <span class="o">-</span><span class="n">S</span> <span class="n">sudo</span>
<span class="n">echo</span> <span class="s2">&quot;huatai   ALL=(ALL:ALL) NOPASSWD:ALL&quot;</span> <span class="o">&gt;&gt;</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">sudoers</span>
</pre></div>
</div>
</li>
</ul>
</section>
<section id="id7">
<h2>安装系统工具<a class="headerlink" href="#id7" title="Link to this heading"></a></h2>
<ul>
<li><p>安装openssh:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pacman</span> <span class="o">-</span><span class="n">S</span> <span class="n">openssh</span>
</pre></div>
</div>
</li>
</ul>
<p>此时还在chroot状态，所以无法直接使用 <a class="reference internal" href="../redhat_linux/systemd/index.html#systemd"><span class="std std-ref">Systemd进程管理器</span></a> ，则执行以下命令手工启动 <code class="docutils literal notranslate"><span class="pre">sshd</span></code></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ssh</span><span class="o">-</span><span class="n">keygen</span> <span class="o">-</span><span class="n">A</span>
<span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">sshd</span>
</pre></div>
</div>
</section>
<section id="efistub">
<h2>使用EFISTUB启动(失败)<a class="headerlink" href="#efistub" title="Link to this heading"></a></h2>
<div class="admonition note">
<p class="admonition-title">备注</p>
<p>我尝试了EFISTUB方式，但是在移动U盘上失败，启动页面空白。所以改为参考 <a class="reference external" href="https://wiki.archlinux.org/title/Install_Arch_Linux_on_a_removable_medium">Install Arch Linux on a removable medium</a> 采用安装标准boot loader 来启动</p>
<p>本段落是我的尝试记录，实际未成功，所以应该跳过这段</p>
</div>
<ul>
<li><p>安装 efibootmgr</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pacman</span> <span class="o">-</span><span class="n">S</span> <span class="n">efibootmgr</span>
</pre></div>
</div>
</li>
<li><p>获取 <code class="docutils literal notranslate"><span class="pre">/dev/sda1</span></code> 分区ID (PARTUUID):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ls</span> <span class="o">-</span><span class="n">lh</span> <span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">disk</span><span class="o">/</span><span class="n">by</span><span class="o">-</span><span class="n">partuuid</span><span class="o">/</span>
</pre></div>
</div>
</li>
</ul>
<p>显示:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">lrwxrwxrwx</span> <span class="mi">1</span> <span class="n">root</span> <span class="n">root</span> <span class="mi">10</span> <span class="n">Jun</span> <span class="mi">14</span> <span class="mi">02</span><span class="p">:</span><span class="mi">42</span> <span class="mi">258</span><span class="n">b404c</span><span class="o">-</span><span class="n">d631</span><span class="o">-</span><span class="mi">4</span><span class="n">b9a</span><span class="o">-</span><span class="mi">9457</span><span class="o">-</span><span class="mi">05</span><span class="n">c928be2e02</span> <span class="o">-&gt;</span> <span class="o">../../</span><span class="n">sda2</span>
<span class="n">lrwxrwxrwx</span> <span class="mi">1</span> <span class="n">root</span> <span class="n">root</span> <span class="mi">10</span> <span class="n">Jun</span> <span class="mi">14</span> <span class="mi">02</span><span class="p">:</span><span class="mi">42</span> <span class="n">f8b79904</span><span class="o">-</span><span class="mi">985</span><span class="n">b</span><span class="o">-</span><span class="mi">455</span><span class="n">f</span><span class="o">-</span><span class="mi">8182</span><span class="o">-</span><span class="mf">75e313</span><span class="n">efbbdf</span> <span class="o">-&gt;</span> <span class="o">../../</span><span class="n">sda1</span>
</pre></div>
</div>
<p>这里 <code class="docutils literal notranslate"><span class="pre">sda1</span></code> 的PARTUUID是我们需要用来创建启动PART ID的参数:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">efibootmgr</span> <span class="o">--</span><span class="n">disk</span> <span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">sda</span> <span class="o">--</span><span class="n">part</span> <span class="mi">1</span> <span class="o">--</span><span class="n">create</span> <span class="o">--</span><span class="n">label</span> <span class="s2">&quot;Arch Linux&quot;</span> <span class="o">--</span><span class="n">loader</span> <span class="o">/</span><span class="n">vmlinuz</span><span class="o">-</span><span class="n">linux</span> <span class="o">--</span><span class="n">unicode</span> <span class="s1">&#39;root=PARTUUID=258b404c-d631-4b9a-9457-05c928be2e02 rw initrd=\initramfs-linux.img&#39;</span> <span class="o">--</span><span class="n">verbose</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">备注</p>
<p>参数:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">--part</span> <span class="pre">1</span></code> 标识ESP分区</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">root=</span></code> 标识root分区，也就是这里的 <code class="docutils literal notranslate"><span class="pre">sda2</span></code></p></li>
<li><p>如果使用swap分区，则还可以添加 <code class="docutils literal notranslate"><span class="pre">resume=</span></code> 参数来标识swap分区</p></li>
</ul>
</div>
<div class="admonition warning">
<p class="admonition-title">警告</p>
<p>这里有一个疑惑， <code class="docutils literal notranslate"><span class="pre">--disk</span> <span class="pre">/dev/sda</span></code> 能保证系统启动时候设备识别么？毕竟每次启动系统是被磁盘顺序不同，可能会有不同的设备标记。</p>
<p>例如，我安装启动U盘和目标U盘都插在主机上，启动时候</p>
</div>
<ul class="simple">
<li><p>arch linux不能识别ESP分区的vfat文件系统，启动时候会报错 <code class="docutils literal notranslate"><span class="pre">mount:</span> <span class="pre">/new_root:</span> <span class="pre">unknown</span> <span class="pre">filesystem</span> <span class="pre">type</span> <span class="pre">'vfat'</span></code> 。原因是我将VFAT的分区 <code class="docutils literal notranslate"><span class="pre">/etc/sda1</span></code> 作为 <code class="docutils literal notranslate"><span class="pre">/boot</span></code> ，但是默认安装的内核是没有带有VFAT模块。</p></li>
</ul>
<p>修改 <code class="docutils literal notranslate"><span class="pre">/etc/mkinitcpio.conf</span></code> 添加 vfat 和 xfs 模块:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">MODULES</span><span class="o">=</span><span class="p">(</span><span class="n">vfat</span> <span class="n">xfs</span><span class="p">)</span>
<span class="n">BINARIES</span><span class="o">=</span><span class="p">(</span><span class="n">fsck</span> <span class="n">fsck</span><span class="o">.</span><span class="n">ext2</span> <span class="n">fsck</span><span class="o">.</span><span class="n">ext3</span> <span class="n">fsck</span><span class="o">.</span><span class="n">ext4</span> <span class="n">e2fsck</span> <span class="n">fsck</span><span class="o">.</span><span class="n">vfat</span> <span class="n">fsck</span><span class="o">.</span><span class="n">msdos</span> <span class="n">fsck</span><span class="o">.</span><span class="n">fat</span> <span class="n">fsck</span><span class="o">.</span><span class="n">xfs</span><span class="p">)</span>
</pre></div>
</div>
<ul>
<li><p>安装fsck工具:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pacman</span> <span class="o">-</span><span class="n">S</span> <span class="n">dosfstools</span> <span class="n">xfsprogs</span>
</pre></div>
</div>
</li>
<li><p>生成新的initramfs:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">mkinitcpio</span> <span class="o">-</span><span class="n">P</span>
</pre></div>
</div>
</li>
</ul>
<p>这里有一些WARNING提示，是和硬件相关的 firmware</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">==&gt;</span> <span class="n">WARNING</span><span class="p">:</span> <span class="n">Possibly</span> <span class="n">missing</span> <span class="n">firmware</span> <span class="k">for</span> <span class="n">module</span><span class="p">:</span> <span class="n">aic94xx</span>
<span class="o">==&gt;</span> <span class="n">WARNING</span><span class="p">:</span> <span class="n">Possibly</span> <span class="n">missing</span> <span class="n">firmware</span> <span class="k">for</span> <span class="n">module</span><span class="p">:</span> <span class="n">bfa</span>
<span class="o">==&gt;</span> <span class="n">WARNING</span><span class="p">:</span> <span class="n">Possibly</span> <span class="n">missing</span> <span class="n">firmware</span> <span class="k">for</span> <span class="n">module</span><span class="p">:</span> <span class="n">qed</span>
<span class="o">==&gt;</span> <span class="n">WARNING</span><span class="p">:</span> <span class="n">Possibly</span> <span class="n">missing</span> <span class="n">firmware</span> <span class="k">for</span> <span class="n">module</span><span class="p">:</span> <span class="n">qla1280</span>
<span class="o">==&gt;</span> <span class="n">WARNING</span><span class="p">:</span> <span class="n">Possibly</span> <span class="n">missing</span> <span class="n">firmware</span> <span class="k">for</span> <span class="n">module</span><span class="p">:</span> <span class="n">qla2xxx</span>
<span class="o">==&gt;</span> <span class="n">WARNING</span><span class="p">:</span> <span class="n">Possibly</span> <span class="n">missing</span> <span class="n">firmware</span> <span class="k">for</span> <span class="n">module</span><span class="p">:</span> <span class="n">wd719x</span>
<span class="o">==&gt;</span> <span class="n">WARNING</span><span class="p">:</span> <span class="n">Possibly</span> <span class="n">missing</span> <span class="n">firmware</span> <span class="k">for</span> <span class="n">module</span><span class="p">:</span> <span class="n">xhci_pci</span>
</pre></div>
</div>
<p>只要系统已经安装了 <code class="docutils literal notranslate"><span class="pre">linux-firmware</span></code> ，上述WARNING可以忽略</p>
<ul>
<li><p>设置以后检查启动项:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">efibootmgr</span> <span class="o">--</span><span class="n">verbose</span>
</pre></div>
</div>
</li>
<li><p>设置启动顺序:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">efibootmgr</span> <span class="o">--</span><span class="n">bootorder</span> <span class="n">XXXX</span><span class="p">,</span><span class="n">XXXX</span> <span class="o">--</span><span class="n">verbose</span>
</pre></div>
</div>
</li>
</ul>
<p>这里 <code class="docutils literal notranslate"><span class="pre">xxxx,xxxx</span></code> 是刚才 <code class="docutils literal notranslate"><span class="pre">efibootmgr</span> <span class="pre">--verbose</span></code> 输出的每个启动项的编号。默认就是刚才新添加的启动项在最前面，也就是默认先启动刚才新安装的配置</p>
<div class="admonition note">
<p class="admonition-title">备注</p>
<p>如果历史上积累了太多无用的EFI启动项，可以通过以下命令删除:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">efibootmgr</span> <span class="o">-</span><span class="n">b</span> <span class="c1"># -B</span>
</pre></div>
</div>
<p>这里 <code class="docutils literal notranslate"><span class="pre">#</span></code> 是项目，请替换成实际值，例如:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">efibootmgr</span> <span class="o">-</span><span class="n">b</span> <span class="mi">001</span><span class="n">F</span> <span class="o">-</span><span class="n">B</span>
</pre></div>
</div>
</div>
<ul class="simple">
<li><p>重启系统</p></li>
</ul>
<p>使用exit或者ctrl-d命令chroot环境，然后 <code class="docutils literal notranslate"><span class="pre">umount</span> <span class="pre">-R</span> <span class="pre">/mnt</span></code> ，最后输入 <code class="docutils literal notranslate"><span class="pre">reboot</span></code> 命令重启系统。</p>
</section>
<section id="boot-loader-grub">
<h2>安装Boot Loader - GRUB<a class="headerlink" href="#boot-loader-grub" title="Link to this heading"></a></h2>
<ul>
<li><p>对于使用GRUB的系统，和前面EFISTUB不同，暂时不挂载 <code class="docutils literal notranslate"><span class="pre">/dev/sda1</span></code> ，只挂载 <code class="docutils literal notranslate"><span class="pre">/dev/sda2</span></code> 到 <code class="docutils literal notranslate"><span class="pre">/mnt</span></code> 即执行 <code class="docutils literal notranslate"><span class="pre">pacstrap</span> <span class="pre">/mnt</span> <span class="pre">base</span> <span class="pre">linux</span> <span class="pre">linux-firmware</span></code> 。不过，我已经执行过一次 <code class="docutils literal notranslate"><span class="pre">efibootmgr</span></code> ，所以简单将文件移动到 <code class="docutils literal notranslate"><span class="pre">/boot</span></code> 目录下即可</p></li>
<li><p>执行chroot:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">arch</span><span class="o">-</span><span class="n">chroot</span> <span class="o">/</span><span class="n">mnt</span>
</pre></div>
</div>
</li>
<li><p>其他安装软件步骤都是相同的，见上文</p></li>
<li><p>安装Grub bootloader:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pacman</span> <span class="o">-</span><span class="n">S</span> <span class="n">grub</span> <span class="n">efibootmgr</span>
</pre></div>
</div>
</li>
</ul>
<div class="admonition note">
<p class="admonition-title">备注</p>
<p>Grub会调用 <code class="docutils literal notranslate"><span class="pre">efibootmgr</span></code> 来操作UEFI</p>
</div>
<ul>
<li><p>创建EFI分区挂载目录:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">mkdir</span> <span class="o">/</span><span class="n">boot</span><span class="o">/</span><span class="n">efi</span>
</pre></div>
</div>
</li>
<li><p>挂载ESP分区:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">mount</span> <span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">sda1</span> <span class="o">/</span><span class="n">boot</span><span class="o">/</span><span class="n">efi</span>
</pre></div>
</div>
</li>
<li><p>安装grub:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">grub</span><span class="o">-</span><span class="n">install</span> <span class="o">--</span><span class="n">target</span><span class="o">=</span><span class="n">x86_64</span><span class="o">-</span><span class="n">efi</span> <span class="o">--</span><span class="n">bootloader</span><span class="o">-</span><span class="nb">id</span><span class="o">=</span><span class="n">GRUB</span> <span class="o">--</span><span class="n">efi</span><span class="o">-</span><span class="n">directory</span><span class="o">=/</span><span class="n">boot</span><span class="o">/</span><span class="n">efi</span>
</pre></div>
</div>
</li>
<li><p>创建配置:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">grub</span><span class="o">-</span><span class="n">mkconfig</span> <span class="o">-</span><span class="n">o</span> <span class="o">/</span><span class="n">boot</span><span class="o">/</span><span class="n">grub</span><span class="o">/</span><span class="n">grub</span><span class="o">.</span><span class="n">cfg</span>
</pre></div>
</div>
</li>
<li><p>注意 <code class="docutils literal notranslate"><span class="pre">/etc/fstab</span></code> 配置，需要修订 <code class="docutils literal notranslate"><span class="pre">/boot/efi</span></code> 挂载 <code class="docutils literal notranslate"><span class="pre">/dev/sda1</span></code></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># /dev/sda2</span>
<span class="n">UUID</span><span class="o">=</span><span class="n">e5f1f419</span><span class="o">-</span><span class="mi">266</span><span class="n">c</span><span class="o">-</span><span class="mi">41</span><span class="n">b3</span><span class="o">-</span><span class="mi">9</span><span class="n">df8</span><span class="o">-</span><span class="n">fef7fcd26f02</span>    <span class="o">/</span>           <span class="n">xfs</span>         <span class="n">rw</span><span class="p">,</span><span class="n">relatime</span><span class="p">,</span><span class="n">attr2</span><span class="p">,</span><span class="n">inode64</span><span class="p">,</span><span class="n">logbufs</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span><span class="n">logbsize</span><span class="o">=</span><span class="mi">32</span><span class="n">k</span><span class="p">,</span><span class="n">noquota</span>  <span class="mi">0</span> <span class="mi">1</span>
<span class="c1"># /dev/sda1</span>
<span class="n">UUID</span><span class="o">=</span><span class="mi">5800</span><span class="o">-</span><span class="mi">6</span><span class="n">B75</span>       <span class="o">/</span><span class="n">boot</span><span class="o">/</span><span class="n">efi</span>       <span class="n">vfat</span>        <span class="n">rw</span><span class="p">,</span><span class="n">relatime</span><span class="p">,</span><span class="n">fmask</span><span class="o">=</span><span class="mi">0022</span><span class="p">,</span><span class="n">dmask</span><span class="o">=</span><span class="mi">0022</span><span class="p">,</span><span class="n">codepage</span><span class="o">=</span><span class="mi">437</span><span class="p">,</span><span class="n">iocharset</span><span class="o">=</span><span class="n">ascii</span><span class="p">,</span><span class="n">shortname</span><span class="o">=</span><span class="n">mixed</span><span class="p">,</span><span class="n">utf8</span><span class="p">,</span><span class="n">errors</span><span class="o">=</span><span class="n">remount</span><span class="o">-</span><span class="n">ro</span> <span class="mi">0</span> <span class="mi">2</span>
</pre></div>
</div>
</li>
</ul>
<div class="admonition note">
<p class="admonition-title">备注</p>
<p>这里 <code class="docutils literal notranslate"><span class="pre">/dev/sda1</span></code> 挂载修改为 <code class="docutils literal notranslate"><span class="pre">/boot/efi</span></code></p>
</div>
<ul>
<li><p>修改 <code class="docutils literal notranslate"><span class="pre">/etc/mkinitcpio.conf</span></code> 添加 vfat 和 xfs 模块(重要步骤，确保内核启动支持vfat和xfs分区)，并且带上必要的磁盘fsck(按需要支持的分区类型添加):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">MODULES</span><span class="o">=</span><span class="p">(</span><span class="n">vfat</span> <span class="n">xfs</span><span class="p">)</span>
<span class="n">BINARIES</span><span class="o">=</span><span class="p">(</span><span class="n">fsck</span> <span class="n">fsck</span><span class="o">.</span><span class="n">ext2</span> <span class="n">fsck</span><span class="o">.</span><span class="n">ext3</span> <span class="n">fsck</span><span class="o">.</span><span class="n">ext4</span> <span class="n">e2fsck</span> <span class="n">fsck</span><span class="o">.</span><span class="n">vfat</span> <span class="n">fsck</span><span class="o">.</span><span class="n">msdos</span> <span class="n">fsck</span><span class="o">.</span><span class="n">fat</span> <span class="n">fsck</span><span class="o">.</span><span class="n">xfs</span><span class="p">)</span>
</pre></div>
</div>
</li>
<li><p>修改 <code class="docutils literal notranslate"><span class="pre">HOOKS</span></code> 段落，将 <code class="docutils literal notranslate"><span class="pre">block</span></code> 和 <code class="docutils literal notranslate"><span class="pre">keyboard</span></code> 提前到 <code class="docutils literal notranslate"><span class="pre">autodetect</span></code> 前面。这个措施对于在多系统启动是在早期用户空间加载需要的模块:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#HOOKS=(base udev autodetect modconf block filesystems keyboard fsck)</span>
<span class="n">HOOKS</span><span class="o">=</span><span class="p">(</span><span class="n">base</span> <span class="n">udev</span> <span class="n">block</span> <span class="n">keyboard</span> <span class="n">autodetect</span> <span class="n">modconf</span> <span class="n">filesystems</span> <span class="n">fsck</span><span class="p">)</span>
</pre></div>
</div>
</li>
<li><p>如果U盘需要用于不同的处理器，例如intel或amd，则同时安装 <code class="docutils literal notranslate"><span class="pre">amd-ucode</span></code> 和 <code class="docutils literal notranslate"><span class="pre">intel-ucode</span></code> 软件包:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#pacman -S amd-ucode intel-ucode</span>
<span class="n">pacman</span> <span class="o">-</span><span class="n">S</span> <span class="n">intel</span><span class="o">-</span><span class="n">ucode</span>
</pre></div>
</div>
</li>
<li><p>安装fsck工具:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pacman</span> <span class="o">-</span><span class="n">S</span> <span class="n">dosfstools</span> <span class="n">xfsprogs</span>
</pre></div>
</div>
</li>
<li><p>生成新的initramfs:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">mkinitcpio</span> <span class="o">-</span><span class="n">P</span>
</pre></div>
</div>
</li>
</ul>
</section>
<section id="id8">
<h2>安装必要软件包<a class="headerlink" href="#id8" title="Link to this heading"></a></h2>
<ul>
<li><p>为方便工作，安装以下软件包:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pacman</span> <span class="o">-</span><span class="n">S</span> <span class="n">sudo</span> <span class="n">screen</span> <span class="n">wpa_supplicant</span>
</pre></div>
</div>
</li>
<li><p>升级系统:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">pacman</span> <span class="o">-</span><span class="n">Syu</span>
</pre></div>
</div>
</li>
</ul>
</section>
<section id="id9">
<h2>网络配置<a class="headerlink" href="#id9" title="Link to this heading"></a></h2>
<p>这次安装的arch linux是作为服务器使用，所以只安装字符界面工具。网络配置我没有采用 <a class="reference internal" href="archlinux_on_thinkpad_x220.html#archlinux-on-thinkpad-x220"><span class="std std-ref">ThinkPad X220上运行Arch Linux</span></a> 的 netctl 工具。</p>
<p><a class="reference internal" href="archlinux_config_ip.html#archlinux-config-ip"><span class="std std-ref">arch linux配置IP(静态或动态)</span></a> 提供了不同的网络配置方法，这里实践仅采用简洁的 <a class="reference internal" href="../redhat_linux/systemd/systemd_networkd.html#systemd-networkd"><span class="std std-ref">Systemd Networkd服务</span></a> 完成</p>
</section>
<section id="ip">
<h2>静态IP<a class="headerlink" href="#ip" title="Link to this heading"></a></h2>
<ul>
<li><p>编辑 <code class="docutils literal notranslate"><span class="pre">/etc/systemd/network/enp0s25.network</span></code></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">Match</span><span class="p">]</span>
<span class="n">Name</span><span class="o">=</span><span class="n">enp0s25</span>

<span class="p">[</span><span class="n">Network</span><span class="p">]</span>
<span class="n">Address</span><span class="o">=</span><span class="mf">192.168.6.199</span><span class="o">/</span><span class="mi">24</span>
<span class="n">Gateway</span><span class="o">=</span><span class="mf">192.168.6.200</span>
<span class="n">DNS</span><span class="o">=</span><span class="mf">192.168.6.200</span>
</pre></div>
</div>
</li>
<li><p>启动服务:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">systemctl</span> <span class="n">enable</span> <span class="o">--</span><span class="n">now</span> <span class="n">systemd</span><span class="o">-</span><span class="n">networkd</span>
</pre></div>
</div>
</li>
</ul>
<div class="admonition note">
<p class="admonition-title">备注</p>
<p>上述配置是完成对物理主机的有线网卡静态IP地址配置，这个IP地址是内网IP地址</p>
</div>
</section>
<section id="id10">
<h2>无线网络<a class="headerlink" href="#id10" title="Link to this heading"></a></h2>
<p>系统默认采用了 <a class="reference internal" href="../redhat_linux/systemd/index.html#systemd"><span class="std std-ref">Systemd进程管理器</span></a> ，所以通常可以直接 <a class="reference internal" href="../redhat_linux/systemd/systemd_networkd_wlan.html#systemd-networkd-wlan"><span class="std std-ref">使用systemd-networkd配置无线</span></a> ，对于复杂的 <code class="docutils literal notranslate"><span class="pre">802.1x和EAP</span></code> 认证，可以 <a class="reference internal" href="../ubuntu_linux/network/wpa_supplicant.html#wpa-supplicant"><span class="std std-ref">使用wpa_supplicant连接无线网络</span></a></p>
<section id="wep-wpa2">
<h3>WEP/WPA2网络<a class="headerlink" href="#wep-wpa2" title="Link to this heading"></a></h3>
</section>
</section>
<section id="id11">
<h2>参考<a class="headerlink" href="#id11" title="Link to this heading"></a></h2>
<ul class="simple">
<li><p><a class="reference external" href="https://wiki.archlinux.org/title/Install_Arch_Linux_on_a_removable_medium">Install Arch Linux on a removable medium</a></p></li>
<li><p><a class="reference external" href="https://itsfoss.com/install-arch-linux/">How to Install Arch Linux[Step by Step Guide]</a></p></li>
<li><p><a class="reference external" href="https://wiki.archlinux.org/index.php/Installation_guide">archlinux Installation guide</a></p></li>
<li><p><a class="reference external" href="https://www.wikihow.com/Install-Arch-Linux">How to Install Arch Linux</a></p></li>
<li><p><a class="reference external" href="http://www.linuxandubuntu.com/home/how-to-setup-a-wifi-in-arch-linux-using-terminal">How To Setup A WiFi Network In Arch Linux Using Terminal</a></p></li>
</ul>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="页脚">
        <a href="archlinux_on_thinkpad_x220.html" class="btn btn-neutral float-left" title="ThinkPad X220上运行Arch Linux" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> 上一页</a>
        <a href="archlinux_on_mba.html" class="btn btn-neutral float-right" title="MacBook Air上运行Arch Linux" accesskey="n" rel="next">下一页 <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; <a href="../../copyright.html">版权所有</a> 2018 - now, Huatai Huang。</p>
  </div>

  利用 <a href="https://www.sphinx-doc.org/">Sphinx</a> 构建，使用的 
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">主题</a>
    由 <a href="https://readthedocs.org">Read the Docs</a> 开发.
  
    <!-- your html code here -->
    <br>
    <p><a href="https://github.com/huataihuang/cloud-atlas/issues">留言和讨论</a>|<a href="https://github.com/huataihuang/cloud-atlas/blob/master/source/donate.rst">请我喝一杯咖啡 👈</a></p>
    <br>
    <p>网站采用 <a href="https://utteranc.es/">utterances</a> 评论系统，所有评论存储在<a href="https://github.com/huataihuang/cloud-atlas/issues">GitHub issues</a> 中，如果你看不到下方的评论框，那么可能需要<a href="https://cloud-atlas.readthedocs.io/zh-cn/latest/linux/security/vpn/index.html">自备梯子</a> 👈</p>
    <div class="articleComments">
        <comments>
  <script src="https://utteranc.es/client.js"
    repo="huataihuang/cloud-atlas"
    issue-term="pathname"
    theme="github-light"
    crossorigin="anonymous"
    async>
  </script>
</comments>
    </div>


</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>