<!DOCTYPE html>
<html class="writer-html5" lang="zh" data-content_root="../../../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>LVM架构 &mdash; Cloud Atlas: Discovery beta 文档</title>
      <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="../../../_static/css/theme.css?v=19f00094" />
      <link rel="stylesheet" type="text/css" href="../../../_static/graphviz.css?v=fd3f3429" />

  
    <link rel="shortcut icon" href="../../../_static/favicon.png"/>
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../../../_static/jquery.js?v=5d32c60e"></script>
        <script src="../../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../../../_static/documentation_options.js?v=8534f863"></script>
        <script src="../../../_static/doctools.js?v=9a2dae69"></script>
        <script src="../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="索引" href="../../../genindex.html" />
    <link rel="search" title="搜索" href="../../../search.html" />
    <link rel="copyright" title="版权所有" href="../../../copyright.html" />
    <link rel="next" title="lvmraid vs. mdadm" href="lvmraid_vs_mdadm.html" />
    <link rel="prev" title="Linux LVM逻辑卷管理" href="index.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../../index.html" class="icon icon-home">
            Cloud Atlas: Discovery
          </a>
              <div class="version">
                1.1
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="搜索文档" aria-label="搜索文档" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="导航菜单">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../studio/index.html">Studio</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../infrastructure/index.html">Infrastructure</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../devops/index.html">DevOps</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../kvm/index.html">KVM</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../ceph/index.html">Ceph</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../gluster/index.html">Gluster</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../ovirt/index.html">oVirt</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../openstack/index.html">OpenStack</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../docker/index.html">Docker</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../kubernetes/index.html">Kubernetes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../k8s_dev/index.html">Kubernetes Develop</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../rancher/index.html">Rancher</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../openshift/index.html">OpenShift</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../sql/index.html">SQL</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../sqlite/index.html">SQLite</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../mysql/index.html">MySQL</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../pgsql/index.html">PostgreSQL</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../nosql/index.html">NoSQL</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../network/index.html">Network</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../infra_service/index.html">Infra-Service</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../infra_search/index.html">Infra-Search</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../web/index.html">Web</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../info_service/index.html">Info-Service</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../big_data/index.html">Big Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../machine_learning/index.html">Machine Learning</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../drone/index.html">Drone</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../index.html">Linux</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../best_linux.html">最佳Linux</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../admin/index.html">Linux系统管理</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../redhat_linux/index.html">RedHat Linux</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../arch_linux/index.html">Arch Linux</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../asahi_linux/index.html">Asahi Linux</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../gentoo_linux/index.html">Gentoo Linux</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../lfs/index.html">LFS(Linux from scratch)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../blfs/index.html">BLFS(Beyond Linux from scratch)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../alfs/index.html">ALFS(Automated Linux from scratch)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../pilfs/index.html">PiLFS(Automated Linux from scratch on the Raspberry Pi)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../yocto/index.html">Yocto</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../debian/index.html">Debian</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../ubuntu_linux/index.html">Ubuntu Linux</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../suse_linux/index.html">SUSE Linux</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../kali_linux/index.html">Kali Linux</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../tails_linux/index.html">Tails Linux</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../qubes_os/index.html">Qubes OS</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../postmarketos/index.html">postmarketOS</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../container_os/index.html">容器化操作系统(Container OS)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../fedora_coreos/index.html">Fedora CoreOS容器操作系统</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../chromeos/index.html">ChromeOS</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../alpine_linux/index.html">Alpine Linux</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../subgraph_os/index.html">Subgraph OS</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../kaios/index.html">KaiOS - 世界第三手机操作系统</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../compute/index.html">Linux计算</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../index.html">Linux存储</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../disk/index.html">Linux磁盘</a></li>
<li class="toctree-l3"><a class="reference internal" href="../nvme/index.html">Linux NVMe</a></li>
<li class="toctree-l3"><a class="reference internal" href="../iscsi/index.html">Linux iSCSI</a></li>
<li class="toctree-l3"><a class="reference internal" href="../pmem/index.html">Linux 持久内存</a></li>
<li class="toctree-l3"><a class="reference internal" href="../spdk/index.html">Linux SPDK</a></li>
<li class="toctree-l3"><a class="reference internal" href="../filesystem/index.html">Linux文件系统</a></li>
<li class="toctree-l3 current"><a class="reference internal" href="index.html">Linux LVM逻辑卷管理</a><ul class="current">
<li class="toctree-l4 current"><a class="current reference internal" href="#">LVM架构</a></li>
<li class="toctree-l4"><a class="reference internal" href="lvmraid_vs_mdadm.html">lvmraid vs. mdadm</a></li>
<li class="toctree-l4"><a class="reference internal" href="lvm_partion_vs_disk.html">构建LVM卷管理应该使用分区还是直接使用磁盘?</a></li>
<li class="toctree-l4"><a class="reference internal" href="deploy_lvm.html">部署LVM</a></li>
<li class="toctree-l4"><a class="reference internal" href="deploy_lvm_mdadm_raid10.html">在 <span class="xref std std-ref">mdadm_raid10</span> 上部署LVM</a></li>
<li class="toctree-l4"><a class="reference internal" href="lvmraid.html">LVM RAID( <code class="docutils literal notranslate"><span class="pre">lvmraid</span></code> )</a></li>
<li class="toctree-l4"><a class="reference internal" href="striped_lvm.html">条带化逻辑卷管理(LVM)</a></li>
<li class="toctree-l4"><a class="reference internal" href="lvmcache.html">LVM卷缓存</a></li>
<li class="toctree-l4"><a class="reference internal" href="lvmthin.html">精简模式LVM</a></li>
<li class="toctree-l4"><a class="reference internal" href="extend_ext4_on_lvm.html">扩展LVM上的EXT4文件系统</a></li>
<li class="toctree-l4"><a class="reference internal" href="bhyve_ubuntu_extend_ext4_on_lvm.html">bhyve上Ubuntu虚拟机扩展LVM上的EXT4文件系统</a></li>
<li class="toctree-l4"><a class="reference internal" href="lvm_device_excluded_by_filter.html">LVM执行 <code class="docutils literal notranslate"><span class="pre">pvcreate</span></code> 时报错 <code class="docutils literal notranslate"><span class="pre">Device</span> <span class="pre">/dev/XXX</span> <span class="pre">excluded</span> <span class="pre">by</span> <span class="pre">a</span> <span class="pre">filter.</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../software_raid/index.html">Linux 软RAID</a></li>
<li class="toctree-l3"><a class="reference internal" href="../zfs/index.html">ZFS</a></li>
<li class="toctree-l3"><a class="reference internal" href="../btrfs/index.html">Btrfs</a></li>
<li class="toctree-l3"><a class="reference internal" href="../stratis/index.html">Stratis - Linux存储系统</a></li>
<li class="toctree-l3"><a class="reference internal" href="../openmediavault/index.html">openmediavault - Linux NAS存储</a></li>
<li class="toctree-l3"><a class="reference internal" href="../bcache/index.html">Linux Bcache(块缓存)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../nas/index.html">NAS</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../network/index.html">Linux网络</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../server/index.html">Linux服务器</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../security/index.html">Linux安全</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../desktop/index.html">Linux桌面</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../linux_tablet/index.html">Linux平板</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../kernel/index.html">Kernel</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../performance/index.html">Performance</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../distributed_system/index.html">Distributed System</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../shell/index.html">Shell</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../python/index.html">Python</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../django/index.html">Django</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../javascript/index.html">JavaScript</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../nodejs/index.html">Node.js</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../clang/index.html">C</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../golang/index.html">Go</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../swift/index.html">Swift</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../rust/index.html">Rust</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../ruby/index.html">Ruby</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../lua/index.html">Lua</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../arm/index.html">ARM</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../raspberry_pi/index.html">Raspberry Pi</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../android/index.html">Android</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../bsd/index.html">BSD</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../freebsd/index.html">FreeBSD</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../apple/index.html">Apple</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../windows/index.html">Windows</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../real/index.html">Real</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../management/index.html">Management</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../life/index.html">Life</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../copyright.html">Copyright</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../aboutme.html">关于作者</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../donate.html">捐赠</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../thanks.html">感谢</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../roadmap.html">Roadmap</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../appendix/index.html">附录</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="移动版导航菜单" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">Cloud Atlas: Discovery</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="页面导航">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../index.html">Linux</a></li>
          <li class="breadcrumb-item"><a href="../index.html">Linux存储</a></li>
          <li class="breadcrumb-item"><a href="index.html">Linux LVM逻辑卷管理</a></li>
      <li class="breadcrumb-item active">LVM架构</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../../_sources/linux/storage/lvm/lvm_infra.rst.txt" rel="nofollow"> 查看页面源码</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="lvm">
<span id="lvm-infra"></span><h1>LVM架构<a class="headerlink" href="#lvm" title="Link to this heading"></a></h1>
<div class="admonition note">
<p class="admonition-title">备注</p>
<p>我在早期LVM卷学习的基础上，结合现代LVM卷管理的改进以及相关文档，修订本文</p>
</div>
<section id="id1">
<h2>逻辑卷LVM<a class="headerlink" href="#id1" title="Link to this heading"></a></h2>
<p>LVM是基于Linux kernel的逻辑卷管理，通过将多个磁盘或类似的存储设备组合成大存储。LVM最初由Heinz Mauelshagen公司开发，基于HP-UX的LVM设计。多数Linux发行版本已经支持在逻辑卷上的根文件系统上安装一个启动系统。</p>
<p>通过使用逻辑卷(LVM)可已在物理存储上创建一个抽象层，比直接使用物理存储具有更大灵活性: LVM软件抽象层隐藏了底层硬件存储，使得调整文件系统大小以及移动，无需停止应用或卸载文件系统。</p>
<p>相比直接使用物理存储，逻辑卷具有以下优势:</p>
<ul class="simple">
<li><p>灵活的容量: 使用逻辑卷时，文件系统可以跨多个物理磁盘或分区(物理卷, physical volumes, PV)，而且底层物理磁盘添加对上层文件系统无感知，可以实现不停机动态在线扩展 - 很多项目在初步上线的时候，为了节约投资并根据业务扩展情况逐步扩展存储，通过LVM卷管理可以实现动态在线扩容</p></li>
<li><p>调整存储池大小: 可以扩展或减小逻辑卷，无需重新格式化或者重新分区基础磁盘设备</p></li>
<li><p>在线数据重定位( <code class="docutils literal notranslate"><span class="pre">需要实践</span></code> ): 可以在系统在线使用时移动数据，重新分配磁盘，清空热插拔磁盘(维护)，对运维硬件替换具有极大用途</p></li>
<li><p>方便的设备命名: 可以使用用户自己定义的设备命名</p></li>
<li><p>条带化: 通过条带化在多个磁盘(PV)上构建条带化分布数据的逻辑卷，可以显著提高吞吐量 - 类似 <code class="docutils literal notranslate"><span class="pre">RAID</span> <span class="pre">0</span></code></p></li>
<li><p>镜像: 通过数据镜像提供硬件故障防范 - 类似 <code class="docutils literal notranslate"><span class="pre">RAID</span> <span class="pre">1</span></code></p></li>
<li><p>快照: 设备快照可以用于数据备份以及测试更改对系统的影响 - LVM快照可以在秒级完成超大容量存储瞬间clone，从而为后续备份提供支持</p></li>
<li><p>精简卷(Thin volumes): LVM的精简模式配置，可以创建大于实际硬件容量的逻辑卷 - 这个功能在虚拟化 <code class="docutils literal notranslate"><span class="pre">存储超买</span></code> 上有很大用途，可以快速创建极大的卷并在逻辑上分配超过物理存储的容量，随着业务发展可以逐步扩容</p></li>
<li><p>缓存卷(Cache volumes) <a class="reference internal" href="lvmcache.html#lvmcache"><span class="std std-ref">LVM卷缓存</span></a> : 缓存逻辑卷使用更快的块设备(如SSD)组成小型逻辑卷，通过将热点数据存储在快速的缓存卷来提高较慢的大容量存储(如机械硬盘)的性能</p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">备注</p>
<p>LVM已经支持多种RAID模式，通过 <a class="reference internal" href="lvmraid.html#lvmraid"><span class="std std-ref">LVM RAID( lvmraid )</span></a> 实现了和 <a class="reference internal" href="../software_raid/mdadm.html#mdadm"><span class="std std-ref">mdadm 软RAID构建</span></a> 相似的 <a class="reference internal" href="../software_raid/index.html#linux-software-raid"><span class="std std-ref">Linux 软RAID</span></a> ， <a class="reference internal" href="lvmraid_vs_mdadm.html#lvmraid-vs-mdadm"><span class="std std-ref">lvmraid vs. mdadm</span></a></p>
</div>
<div class="admonition note">
<p class="admonition-title">备注</p>
<p>在 AMD, Intel, ARM 和 IBM Power Systems服务器中，引导装载程序(boot loader)不能读取LVM卷，所以必须将 <code class="docutils literal notranslate"><span class="pre">/boot</span></code> 分区创在在标准的非LVM磁盘分区。</p>
</div>
</section>
<section id="id2">
<h2>LVM架构<a class="headerlink" href="#id2" title="Link to this heading"></a></h2>
<ul class="simple">
<li><p>LVM在每个物理卷( <code class="docutils literal notranslate"><span class="pre">PV</span></code> )的开头部分维护一个 <code class="docutils literal notranslate"><span class="pre">metadata</span></code> 头，每个 <code class="docutils literal notranslate"><span class="pre">metadata</span></code> 头通过UUID来唯一标识。</p></li>
<li><p>每个 <code class="docutils literal notranslate"><span class="pre">PV</span></code> 头部包含一个完整的整个卷组( <code class="docutils literal notranslate"><span class="pre">VG</span></code> )布局副本，包括所有其他 <code class="docutils literal notranslate"><span class="pre">PV</span></code> 的 <code class="docutils literal notranslate"><span class="pre">UUID</span></code> ，以及所有逻辑卷( <code class="docutils literal notranslate"><span class="pre">LV</span></code> )的 <code class="docutils literal notranslate"><span class="pre">UUID</span></code> 和 <code class="docutils literal notranslate"><span class="pre">PE</span></code> 至 <code class="docutils literal notranslate"><span class="pre">LE</span></code> 的分配映射关系表。这实现了当 <code class="docutils literal notranslate"><span class="pre">PV</span></code> 损坏时候可以实现简单的数据恢复。</p></li>
<li><p>LVM实现是通过一个 <code class="docutils literal notranslate"><span class="pre">device</span> <span class="pre">mapper</span></code> 概念来实现的，这是一个简单的基于块级别的方案，实现通过创建虚拟块设备和映射这些块内容到另外其他块设备。LVM的这种 <code class="docutils literal notranslate"><span class="pre">device</span> <span class="pre">mapper</span></code> 也允许 <code class="docutils literal notranslate"><span class="pre">I/O</span></code> 重定向服务，这样可以和其他卷管理共享（如 <code class="docutils literal notranslate"><span class="pre">EVMS</span></code> ）。</p></li>
</ul>
<p>下图是 LVM 逻辑卷组件，可以看到 <code class="docutils literal notranslate"><span class="pre">PV</span> <span class="pre">=&gt;</span> <span class="pre">VG</span> <span class="pre">=&gt;</span> <span class="pre">LV</span></code> 的层次结构:</p>
<figure class="align-default" id="id8">
<img alt="../../../_images/basic-lvm-volume.png" src="../../../_images/basic-lvm-volume.png" />
<figcaption>
<p><span class="caption-text">LVM逻辑卷组件</span><a class="headerlink" href="#id8" title="Link to this image"></a></p>
</figcaption>
</figure>
<p>逻辑卷管理提供了磁盘存储的高层视图，以便管理员能够灵活分配存储给应用程序和用户。逻辑卷管理允许以用户定义组来分配存储卷，允许将存储设置为卷组名如&quot;development&quot;和&quot;sales&quot;，而不用使用设备名，如&quot;sda&quot;和&quot;sdb&quot;。</p>
<section id="id3">
<h3>定义<a class="headerlink" href="#id3" title="Link to this heading"></a></h3>
<table class="docutils align-default" id="id9">
<caption><span class="caption-text">LVM概念表</span><a class="headerlink" href="#id9" title="Link to this table"></a></caption>
<colgroup>
<col style="width: 40.0%" />
<col style="width: 60.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>术语</p></th>
<th class="head"><p>说明</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>physical volume <code class="docutils literal notranslate"><span class="pre">PV</span></code></p></td>
<td><p>物理卷通常指硬盘，但也可能指已经建立底层RAID的设备（包括软RAID和硬RAID）</p></td>
</tr>
<tr class="row-odd"><td><p>physical extent <code class="docutils literal notranslate"><span class="pre">PE</span></code></p></td>
<td><p>每个物理卷被划分为数据集，称为physical extents，这些扩展在VG中大小相同。</p></td>
</tr>
<tr class="row-even"><td><p>volume group <code class="docutils literal notranslate"><span class="pre">VG</span></code></p></td>
<td><p>卷组是LVM中的最高抽象层，将一组逻辑卷和物理卷包含到一个管理单元。</p></td>
</tr>
<tr class="row-odd"><td><p>logical volume <code class="docutils literal notranslate"><span class="pre">LV</span></code></p></td>
<td><p>相当于磁盘分区，LV可以被视为标准的块设备。</p></td>
</tr>
<tr class="row-even"><td><p>logical extent <code class="docutils literal notranslate"><span class="pre">LE</span></code></p></td>
<td><p>每个逻辑卷被分割为数据块，视为logical extent。这个逻辑扩展大小在相同的逻辑卷组中的所有逻辑卷相同。</p></td>
</tr>
</tbody>
</table>
</section>
<section id="physical-volumes-pv">
<h3>物理卷(Physical Volumes, PV)<a class="headerlink" href="#physical-volumes-pv" title="Link to this heading"></a></h3>
<p>卷管理在物理存储之上创建了一个抽象层，允许创建逻辑存储卷。逻辑卷功能比直接使用物理存储提供一系列更具伸缩性。当使用逻辑卷，可以不受到物理磁盘大小的限制。并且，由于物理存储的配置被软件所隐蔽，所以可以不停止应用程序或不unmount文件系统进行卷扩展或移动。物理卷可以是分区也可以是整个磁盘，不过从实践上来说，推荐采用整个磁盘:</p>
<ul class="simple">
<li><p>因为当磁盘损坏时，很大概率是整个磁盘上多个分区同时无法使用；通常我们使用LVM卷是希望获得数据冗余来保障数据安全，如果使用了同一个物理磁盘上的多个分区来构建一个LVM，则有可能出现多副本同时毁坏。</p></li>
<li><p>LVM并不知晓两个物理卷位于同一个物理磁盘，此时组建的条代化逻辑卷的性能会降低(因为两个逻辑分区读写实际上位于同一个物理磁盘，带来读写带宽争抢)</p></li>
</ul>
<p>在构建LVM卷时，物理卷是首先创建的，也就是要使用磁盘，必先初始化成物理卷(PV)。这个快设备初始化为物理卷时，会在接近设备起始的位置放一个标签。默认情况下，LVM标签存放在物理设备的 <code class="docutils literal notranslate"><span class="pre">第二个512字节扇区</span></code> 。在创建物理卷时候，可以通过将标签放在 <code class="docutils literal notranslate"><span class="pre">任何前4个扇区</span></code> 来覆盖此默认值。如果需要，LVM卷可以与其他使用这些扇区的用户共同存在。</p>
<ul class="simple">
<li><p>LVM标签为物理设备提供正确标识和设备顺序: 需要注意，物理主机启动时，磁盘识别顺序是不能保证顺序的(加电初始化时间不固定导致识别顺序随机)，所以必须使用唯一的UUID来识别设备。LVM标签可以在主机重启后保持持久性并且在整个集群中可用</p></li>
<li><p>LVM标签可以将设备识别为LVM物理卷，包含物理卷的随机 唯一识别符(UUID)；同时LVM标签还以字节为单位保存块设备的大小，并记录LVM元数据存储在该设备中的位置</p></li>
<li><p>LVM元数据包含系统中LVM卷组的配置详情，默认情况下，卷组中每个物理卷的元数据区域都会保留一个一样的元数据副本，这为磁盘故障时回复LVM卷组提供依据。LVM元数据很小，以ASCII格式保存</p></li>
<li><p>LVM允许每个物理卷中保存0, 1 或者 2个元数据副本。默认为1个副本，当在物理卷中配置元数据副本数量之后，无法再更改该号码。如果不小心覆盖了磁盘的起始部分，则可以使用设备末尾的元数据的第二个副本来恢复元数据</p></li>
</ul>
<figure class="align-default" id="id10">
<img alt="../../../_images/physvol.png" src="../../../_images/physvol.png" />
<figcaption>
<p><span class="caption-text">LVM物理卷</span><a class="headerlink" href="#id10" title="Link to this image"></a></p>
</figcaption>
</figure>
</section>
<section id="volume-groups-vg">
<h3>卷组(Volume Groups, VG)<a class="headerlink" href="#volume-groups-vg" title="Link to this heading"></a></h3>
<p>物理卷组合成卷组（volume groups, <code class="docutils literal notranslate"><span class="pre">VGs</span></code> ），卷组是准备用于分配逻辑卷的磁盘空间池:</p>
<ul class="simple">
<li><p>在一个卷组，磁盘空间分配是基于划分为一个固定大小的单元extent来实现的。一个extent是磁盘分配的最小空间单元。在一个物理卷中，extent就是物理extent。</p></li>
<li><p>一个逻辑卷所使用的逻辑extent和物理extent的大小相同</p></li>
<li><p>在一个卷组中，所有逻辑卷的extent的大小都是相同的</p></li>
<li><p>卷组把逻辑extent映射到物理extent</p></li>
</ul>
</section>
<section id="lvm-logical-volumes-lv">
<h3>LVM逻辑卷(Logical Volumes, LV)<a class="headerlink" href="#lvm-logical-volumes-lv" title="Link to this heading"></a></h3>
<div class="admonition note">
<p class="admonition-title">备注</p>
<p>在 AMD、Intel、ARM 和 IBM Power Systems 服务器中,引导装载程序无法读取 LVM 卷:</p>
<p>必须将 <code class="docutils literal notranslate"><span class="pre">/boot</span></code> 分区创建为一个标准的非LVM磁盘分区</p>
</div>
<section id="id4">
<h4>LVM逻辑卷分类<a class="headerlink" href="#id4" title="Link to this heading"></a></h4>
<section id="id5">
<h5>线性逻辑卷<a class="headerlink" href="#id5" title="Link to this heading"></a></h5>
<p>线性逻辑卷就是聚合多个物理卷成为一个逻辑卷，目的就是扩展磁盘空间:</p>
<figure class="align-default" id="id11">
<img alt="../../../_images/uneven_vols.png" src="../../../_images/uneven_vols.png" />
<figcaption>
<p><span class="caption-text">线性逻辑卷，卷组VG1上构建LV1和LV2逻辑卷</span><a class="headerlink" href="#id11" title="Link to this image"></a></p>
</figcaption>
</figure>
</section>
<section id="striped-lvm">
<h5>条带化逻辑卷( <a class="reference internal" href="striped_lvm.html#striped-lvm"><span class="std std-ref">条带化逻辑卷管理(LVM)</span></a> )<a class="headerlink" href="#striped-lvm" title="Link to this heading"></a></h5>
<p>当在LVM逻辑卷上写入数据，文件系统把数据分布到底层的物理卷。可以通过创建一个条带化的逻辑卷来控制数据写入到物理卷。对于大型的顺序读写，可以提高数据I/O的效率。</p>
<p>条带化通过 <code class="docutils literal notranslate"><span class="pre">round-robin</span></code> 方式将数据写入不同物理卷，磁盘 <code class="docutils literal notranslate"><span class="pre">I/O</span></code> 是并行的。某些情况下，可以达到物理卷性能的线性叠加。</p>
<figure class="align-default" id="id12">
<img alt="../../../_images/stripedvol.png" src="../../../_images/stripedvol.png" />
<figcaption>
<p><span class="caption-text">条代化逻辑卷: 数据条代1,2,3分别写入3个物理卷，而从条代4～6又分别写入3个磁盘，从而达到并发提高性能</span><a class="headerlink" href="#id12" title="Link to this image"></a></p>
</figcaption>
</figure>
</section>
<section id="raid">
<h5>RAID逻辑卷<a class="headerlink" href="#raid" title="Link to this heading"></a></h5>
<p>LVM 支持 RAID 0、1、4、5、6 和 10：</p>
<blockquote>
<div><ul class="simple">
<li><p>LVM 创建和管理的 RAID 逻辑卷利用多设备（MD）内核驱动程序</p></li>
<li><p>LVM RAID 卷支持快照</p></li>
<li><p>创建 RAID 逻辑卷时，LVM 会为阵列中的每个数据或奇偶校验子卷创建一个元数据子卷</p></li>
</ul>
</div></blockquote>
</section>
<section id="lvmthin">
<h5>精简配置逻辑卷( <a class="reference internal" href="lvmthin.html#lvmthin"><span class="std std-ref">精简模式LVM</span></a> )<a class="headerlink" href="#lvmthin" title="Link to this heading"></a></h5>
<p>精简模式置备的逻辑卷可以创建大于可用扩展的逻辑卷:</p>
<blockquote>
<div><ul class="simple">
<li><p>可过量使用物理存储，从而避免购买额外的存储</p></li>
<li><p>使用精简配置时，存储管理员务必要监控存储池，并在其被完全占用时添加更多容量</p></li>
<li><p>LVM 支持数据丢弃功能。这允许重复使用丢弃文件或其他块范围使用的空间</p></li>
<li><p>精简卷支持新的复制时写入（COW）快照逻辑卷部署，这将允许很多虚拟设备在精简池中共享相同数据</p></li>
</ul>
</div></blockquote>
</section>
<section id="snapshot">
<h5>快照逻辑卷(snapshot)<a class="headerlink" href="#snapshot" title="Link to this heading"></a></h5>
<p><code class="docutils literal notranslate"><span class="pre">snapshot</span></code> 提供了不中断服务的情况下瞬间创建一个设备虚拟映像的方式。如果在一个snapshot执行之后对原始设备进行的修改，则snapshot将生成一个变化数据区域的副本，这样可以用来重构设备的状态。</p>
<blockquote>
<div><ul class="simple">
<li><p>由于一个snapshot副本只是snapshot创建后数据变化的区域，所以snapshot功能只要求最少的存储。例如，对于一个很少修改的系统，3-5%的空间就能够满足维护snapshot。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">snapshot</span></code> 只是一个文件系统的虚拟copy，并不是实际备份文件系统，所以不能作为备份手段。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">snapshot</span></code></p></li>
</ul>
</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">snapshot</span></code> 提供了不中断服务的情况下瞬间创建一个设备虚拟映像的方式。如果在一个snapshot执行之后对原始设备进行的修改，则snapshot将生成一个变化数据区域的副本，这样可以用来重构设备的状态。</p>
<blockquote>
<div><ul class="simple">
<li><p>由于一个snapshot副本只是snapshot创建后数据变化的区域，所以snapshot功能只要求最少的存储。例如，对于一个很少修改的系统，3-5%的空间就能够满足维护snapshot。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">snapshot</span></code> 只是一个文件系统的虚拟copy，并不是实际备份文件系统，所以不能作为备份手段。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">snapshot</span></code> 占用的磁盘空间大小取决于原始卷的数据变化: 如果被填满，则该 <code class="docutils literal notranslate"><span class="pre">snapshot</span></code> 将损坏，此时这个 <code class="docutils literal notranslate"><span class="pre">snapshot</span></code> 将不能跟踪原始卷的变化。需要经常监控 <code class="docutils literal notranslate"><span class="pre">snapshot</span></code> 的大小。 <code class="docutils literal notranslate"><span class="pre">snapshot</span></code> 支持完善的重定义大小，所以，如果存储空间充足可以增加 <code class="docutils literal notranslate"><span class="pre">snapshot</span></code> 的大小来避免该snapshot被破坏。相反，如果发现 <code class="docutils literal notranslate"><span class="pre">snapshot</span></code> 比需要的大，则可以缩减 <code class="docutils literal notranslate"><span class="pre">snapshot</span></code> 的大小。</p></li>
</ul>
</div></blockquote>
<p>有关 <code class="docutils literal notranslate"><span class="pre">snapshot</span></code> 的一些有用的特性：</p>
<blockquote>
<div><ul class="simple">
<li><p>多数情况下，一个 <code class="docutils literal notranslate"><span class="pre">snapshot</span></code> 可以用来执行原始逻辑卷的备份，而不需要停止在线系统。</p></li>
<li><p>可以在一个 <code class="docutils literal notranslate"><span class="pre">snapshot</span></code> 文件系统上执行 <code class="docutils literal notranslate"><span class="pre">fsck</span></code> 命令来检查文件系统的完整性和检查是否需要修复系统。</p></li>
<li><p>由于 <code class="docutils literal notranslate"><span class="pre">snapshot</span></code> 是可以读写的，可以在 <code class="docutils literal notranslate"><span class="pre">snapshot</span></code> 上测试生产环境数据的应用程序，运行在线测试，而不会影响真实的生产数据。</p></li>
<li><p>LVM 快照可用来创建虚拟客体镜像的快照。这些快照可方便修改现有客户虚拟机或者使用最小附加存储创建新客户虚拟机。</p></li>
<li><p>可以使用 <code class="docutils literal notranslate"><span class="pre">lvconvert</span></code> 的 <code class="docutils literal notranslate"><span class="pre">--merge</span></code> 选项将快照合并到原始卷中。这个功能的一个作用是在丢失数据或者文件或者需要将系统恢复到之前的状态时执行系统恢复。</p></li>
</ul>
</div></blockquote>
</section>
<section id="id6">
<h5>精简配置的快照逻辑卷<a class="headerlink" href="#id6" title="Link to this heading"></a></h5>
<p>精简配置的快照逻辑卷(精简快照卷)可以将很多虚拟设备保存在同一个数据卷，这不仅简化了管理过程，也允许在快照卷之间共享数据:</p>
<ul class="simple">
<li><p>使用相同原始卷的多个快照时，精简快照卷可以减少磁盘用量</p></li>
<li><p>对于同一个来源的多个快照，对原始卷的写入采用COW操作保留数据。增加原始卷的快照数量应该不会导致很大的性能下降(我理解对于大量的快照，写时复制特性就是只有快照也有写入操作才会叠加原始卷的数据修改，否则理论上只有一个原始卷有数据变动，而快照卷只读情况下几乎不会触发数据写)</p></li>
<li><p>精简快照卷可以作为另一个快照的逻辑卷来源，也就是任意深度的递归快照(一个快好的快照的快照...)</p></li>
<li><p>精简逻辑卷的快照也是一个精简逻辑卷。在有求COW操作前，或者到快照已写入前，不会消耗数据空间</p></li>
<li><p>当删除精简配置快照卷的原始卷是，该原始卷的每个快照都会变成独立的精简卷。</p></li>
</ul>
<p>精简快照卷的限制:</p>
<ul class="simple">
<li><p>不能更改精简卷的快大小: 如果精简卷的快大小较大(例如，1MB)，并且需要一个短期存在的快照且使用大块的效率不高时，建议使用旧的快照功能</p></li>
<li><p>不能限制精简快照卷的大小: 如果需要，快照将使用完精简池中所有空间，这可能不适合某些业务场景</p></li>
</ul>
<div class="admonition warning">
<p class="admonition-title">警告</p>
<p>在使用精简配置时，存储管理员 <code class="docutils literal notranslate"><span class="pre">必须</span></code> 监控存储池，并且在存储池被完全耗尽前添加更多存储容量!!!</p>
</div>
</section>
<section id="lvmcache">
<h5><a class="reference internal" href="lvmcache.html#lvmcache"><span class="std std-ref">LVM卷缓存</span></a><a class="headerlink" href="#lvmcache" title="Link to this heading"></a></h5>
<p>LVM支持在较慢的块设备中使用快速快设备(例如SSD驱动器)作为写入或写入缓存。可以通过创建缓存逻辑池来提高现有逻辑卷的性能，或者创建新的缓存逻辑卷。这种解决方案通过小的、快速设备结合大型且缓慢的存储，可以经济地实现海量存储。</p>
</section>
</section>
</section>
</section>
<section id="id7">
<h2>参考<a class="headerlink" href="#id7" title="Link to this heading"></a></h2>
<ul class="simple">
<li><p><a class="reference external" href="http://en.wikipedia.org/wiki/Logical_Volume_Manager_(Linux)">Logical Volume Manager (Linux)</a></p></li>
<li><p><a class="reference external" href="http://www.howtoforge.com/linux_lvm">A Beginner's Guide To LVM</a></p></li>
<li><p><a class="reference external" href="https://access.redhat.com/documentation/zh-cn/red_hat_enterprise_linux/8/html/configuring_and_managing_logical_volumes">Red Hat Enterprise Linux 8.0 &gt; 配置和管理逻辑卷</a></p></li>
<li><p><a class="reference external" href="http://aplawrence.com/Linux/lvm.html">Linux Logical Volume Manager (LVM) on Software RAID</a></p></li>
<li><p><a class="reference external" href="http://www.gagme.com/greg/linux/raid-lvm.php">Managing RAID and LVM with Linux (v0.5)</a></p></li>
<li><p><a class="reference external" href="http://www.ibiblio.org/pub/Linux/docs/HOWTO/other-formats/html_single/LVM-HOWTO.html">LVM HOWTO</a></p></li>
<li><p><a class="reference external" href="http://www.ibm.com/developerworks/cn/linux/filesystem/lvm/lvm-1/index.htm">学习Linux LVM</a></p></li>
<li><p><a class="reference external" href="http://www.ibm.com/developerworks/cn/linux/l-lvm2/">逻辑卷管理-使用 LVM2 工具执行卷的构建和管理、建立备份快照等各种功能</a></p></li>
</ul>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="页脚">
        <a href="index.html" class="btn btn-neutral float-left" title="Linux LVM逻辑卷管理" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> 上一页</a>
        <a href="lvmraid_vs_mdadm.html" class="btn btn-neutral float-right" title="lvmraid vs. mdadm" accesskey="n" rel="next">下一页 <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; <a href="../../../copyright.html">版权所有</a> 2018 - now, Huatai Huang。</p>
  </div>

  利用 <a href="https://www.sphinx-doc.org/">Sphinx</a> 构建，使用的 
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">主题</a>
    由 <a href="https://readthedocs.org">Read the Docs</a> 开发.
  
    <!-- your html code here -->
    <br>
    <p><a href="https://github.com/huataihuang/cloud-atlas/issues">留言和讨论</a>|<a href="https://github.com/huataihuang/cloud-atlas/blob/master/source/donate.rst">请我喝一杯咖啡 👈</a></p>
    <br>
    <p>网站采用 <a href="https://utteranc.es/">utterances</a> 评论系统，所有评论存储在<a href="https://github.com/huataihuang/cloud-atlas/issues">GitHub issues</a> 中，如果你看不到下方的评论框，那么可能需要<a href="https://cloud-atlas.readthedocs.io/zh-cn/latest/linux/security/vpn/index.html">自备梯子</a> 👈</p>
    <div class="articleComments">
        <comments>
  <script src="https://utteranc.es/client.js"
    repo="huataihuang/cloud-atlas"
    issue-term="pathname"
    theme="github-light"
    crossorigin="anonymous"
    async>
  </script>
</comments>
    </div>


</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>