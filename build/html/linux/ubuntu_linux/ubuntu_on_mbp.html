<!DOCTYPE html>
<html class="writer-html5" lang="zh" data-content_root="../../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>MacBook Pro上运行Ubuntu &mdash; Cloud Atlas: Discovery beta 文档</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/theme.css?v=19f00094" />
      <link rel="stylesheet" type="text/css" href="../../_static/graphviz.css?v=fd3f3429" />

  
    <link rel="shortcut icon" href="../../_static/favicon.png"/>
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../../_static/jquery.js?v=5d32c60e"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../../_static/documentation_options.js?v=8534f863"></script>
        <script src="../../_static/doctools.js?v=9a2dae69"></script>
        <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="索引" href="../../genindex.html" />
    <link rel="search" title="搜索" href="../../search.html" />
    <link rel="copyright" title="版权所有" href="../../copyright.html" />
    <link rel="next" title="ThinkPad X220上运行Ubuntu" href="ubuntu_on_thinkpad_x220.html" />
    <link rel="prev" title="Ubuntu Linux" href="index.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            Cloud Atlas: Discovery
          </a>
              <div class="version">
                1.1
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="搜索文档" aria-label="搜索文档" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="导航菜单">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../studio/index.html">Studio</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../infrastructure/index.html">Infrastructure</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../devops/index.html">DevOps</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../kvm/index.html">KVM</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ceph/index.html">Ceph</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../gluster/index.html">Gluster</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ovirt/index.html">oVirt</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../openstack/index.html">OpenStack</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../docker/index.html">Docker</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../kubernetes/index.html">Kubernetes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../k8s_dev/index.html">Kubernetes Develop</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../rancher/index.html">Rancher</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../openshift/index.html">OpenShift</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../sql/index.html">SQL</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../sqlite/index.html">SQLite</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../mysql/index.html">MySQL</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../pgsql/index.html">PostgreSQL</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../nosql/index.html">NoSQL</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../network/index.html">Network</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../infra_service/index.html">Infra-Service</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../infra_search/index.html">Infra-Search</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../web/index.html">Web</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../info_service/index.html">Info-Service</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../big_data/index.html">Big Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../machine_learning/index.html">Machine Learning</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../drone/index.html">Drone</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">Linux</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../best_linux.html">最佳Linux</a></li>
<li class="toctree-l2"><a class="reference internal" href="../admin/index.html">Linux系统管理</a></li>
<li class="toctree-l2"><a class="reference internal" href="../redhat_linux/index.html">RedHat Linux</a></li>
<li class="toctree-l2"><a class="reference internal" href="../arch_linux/index.html">Arch Linux</a></li>
<li class="toctree-l2"><a class="reference internal" href="../asahi_linux/index.html">Asahi Linux</a></li>
<li class="toctree-l2"><a class="reference internal" href="../gentoo_linux/index.html">Gentoo Linux</a></li>
<li class="toctree-l2"><a class="reference internal" href="../lfs/index.html">LFS(Linux from scratch)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../blfs/index.html">BLFS(Beyond Linux from scratch)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../alfs/index.html">ALFS(Automated Linux from scratch)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pilfs/index.html">PiLFS(Automated Linux from scratch on the Raspberry Pi)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../yocto/index.html">Yocto</a></li>
<li class="toctree-l2"><a class="reference internal" href="../debian/index.html">Debian</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html">Ubuntu Linux</a><ul class="current">
<li class="toctree-l3 current"><a class="current reference internal" href="#">MacBook Pro上运行Ubuntu</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id1">安装</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id3">安装后升级系统</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id4">安装显卡驱动</a></li>
<li class="toctree-l4"><a class="reference internal" href="#set-ubuntu-wifi">设置无线网络</a></li>
<li class="toctree-l4"><a class="reference internal" href="#studio-ubuntu-setup">配置</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="ubuntu_on_thinkpad_x220.html">ThinkPad X220上运行Ubuntu</a></li>
<li class="toctree-l3"><a class="reference internal" href="ubuntu_server.html">Ubuntu Server</a></li>
<li class="toctree-l3"><a class="reference internal" href="ubuntu_server_init.html">Ubuntu服务器初始化</a></li>
<li class="toctree-l3"><a class="reference internal" href="ubuntu_desktop.html">Ubuntu Desktop</a></li>
<li class="toctree-l3"><a class="reference internal" href="upgrade_ubuntu.html">升级Ubuntu</a></li>
<li class="toctree-l3"><a class="reference internal" href="ubuntu_hibernate.html">Ubuntu Hibernate休眠</a></li>
<li class="toctree-l3"><a class="reference internal" href="ubuntu_hibernate_old.html">Ubuntu Hibernate休眠(旧实践归档)</a></li>
<li class="toctree-l3"><a class="reference internal" href="admin/index.html">Ubuntu系统管理</a></li>
<li class="toctree-l3"><a class="reference internal" href="cgroup/index.html">Ubuntu Cgroup</a></li>
<li class="toctree-l3"><a class="reference internal" href="network/index.html">Ubuntu网络</a></li>
<li class="toctree-l3"><a class="reference internal" href="storage/index.html">Ubuntu存储管理</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../suse_linux/index.html">SUSE Linux</a></li>
<li class="toctree-l2"><a class="reference internal" href="../kali_linux/index.html">Kali Linux</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tails_linux/index.html">Tails Linux</a></li>
<li class="toctree-l2"><a class="reference internal" href="../qubes_os/index.html">Qubes OS</a></li>
<li class="toctree-l2"><a class="reference internal" href="../postmarketos/index.html">postmarketOS</a></li>
<li class="toctree-l2"><a class="reference internal" href="../container_os/index.html">容器化操作系统(Container OS)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../fedora_coreos/index.html">Fedora CoreOS容器操作系统</a></li>
<li class="toctree-l2"><a class="reference internal" href="../chromeos/index.html">ChromeOS</a></li>
<li class="toctree-l2"><a class="reference internal" href="../alpine_linux/index.html">Alpine Linux</a></li>
<li class="toctree-l2"><a class="reference internal" href="../subgraph_os/index.html">Subgraph OS</a></li>
<li class="toctree-l2"><a class="reference internal" href="../kaios/index.html">KaiOS - 世界第三手机操作系统</a></li>
<li class="toctree-l2"><a class="reference internal" href="../compute/index.html">Linux计算</a></li>
<li class="toctree-l2"><a class="reference internal" href="../storage/index.html">Linux存储</a></li>
<li class="toctree-l2"><a class="reference internal" href="../network/index.html">Linux网络</a></li>
<li class="toctree-l2"><a class="reference internal" href="../server/index.html">Linux服务器</a></li>
<li class="toctree-l2"><a class="reference internal" href="../security/index.html">Linux安全</a></li>
<li class="toctree-l2"><a class="reference internal" href="../desktop/index.html">Linux桌面</a></li>
<li class="toctree-l2"><a class="reference internal" href="../linux_tablet/index.html">Linux平板</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../kernel/index.html">Kernel</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../performance/index.html">Performance</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../distributed_system/index.html">Distributed System</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../shell/index.html">Shell</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../python/index.html">Python</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../django/index.html">Django</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../javascript/index.html">JavaScript</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../nodejs/index.html">Node.js</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../clang/index.html">C</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../golang/index.html">Go</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../swift/index.html">Swift</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../rust/index.html">Rust</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ruby/index.html">Ruby</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../lua/index.html">Lua</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../arm/index.html">ARM</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../raspberry_pi/index.html">Raspberry Pi</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../android/index.html">Android</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../bsd/index.html">BSD</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../freebsd/index.html">FreeBSD</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../apple/index.html">Apple</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../windows/index.html">Windows</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../real/index.html">Real</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../management/index.html">Management</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../life/index.html">Life</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../copyright.html">Copyright</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../aboutme.html">关于作者</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../donate.html">捐赠</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../thanks.html">感谢</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../roadmap.html">Roadmap</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../appendix/index.html">附录</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="移动版导航菜单" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Cloud Atlas: Discovery</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="页面导航">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../index.html">Linux</a></li>
          <li class="breadcrumb-item"><a href="index.html">Ubuntu Linux</a></li>
      <li class="breadcrumb-item active">MacBook Pro上运行Ubuntu</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../_sources/linux/ubuntu_linux/ubuntu_on_mbp.rst.txt" rel="nofollow"> 查看页面源码</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="macbook-proubuntu">
<span id="ubuntu-on-mbp"></span><h1>MacBook Pro上运行Ubuntu<a class="headerlink" href="#macbook-proubuntu" title="Link to this heading"></a></h1>
<section id="id1">
<h2>安装<a class="headerlink" href="#id1" title="Link to this heading"></a></h2>
<p>现代的Linux操作系统对于硬件的支持较好，除了由于Licence限制无法直接加入私有软件需要特别处理，几乎可以平滑运行在常用的电脑设备上。不过，对于MacBook Pro支持也相对差一些，需要小心调整。</p>
<p>如果你参考我的 <a class="reference internal" href="../../studio/base_os.html#base-os"><span class="std std-ref">基础操作系统</span></a> 选择，详细的安装如下：</p>
<ul class="simple">
<li><p><a class="reference internal" href="ubuntu_server.html#ubuntu-server"><span class="std std-ref">Ubuntu Server</span></a></p></li>
<li><p><a class="reference internal" href="ubuntu_desktop.html#ubuntu-desktop"><span class="std std-ref">Ubuntu Desktop</span></a></p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">备注</p>
<p>推荐阅读 <a class="reference external" href="https://wiki.archlinux.org/index.php/MacBookPro11,x">archlinux的MacBookPro11,x文档</a></p>
</div>
<ul class="simple">
<li><p>准备安装U盘</p></li>
</ul>
<p>下载iso镜像之后，可以在macOS上转换成安装U盘镜像:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">hdiutil</span> <span class="n">convert</span> <span class="o">-</span><span class="nb">format</span> <span class="n">UDRW</span> <span class="o">-</span><span class="n">o</span> <span class="n">ubuntu</span><span class="o">-</span><span class="mf">18.04.2</span><span class="o">-</span><span class="n">live</span><span class="o">-</span><span class="n">server</span><span class="o">-</span><span class="n">amd64</span><span class="o">.</span><span class="n">img</span> <span class="n">ubuntu</span><span class="o">-</span><span class="mf">18.04.2</span><span class="o">-</span><span class="n">live</span><span class="o">-</span><span class="n">server</span><span class="o">-</span><span class="n">amd64</span><span class="o">.</span><span class="n">iso</span>
</pre></div>
</div>
<p>卸载U盘:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">diskutil</span> <span class="n">umountDisk</span> <span class="o">/</span><span class="n">Volumes</span><span class="o">/</span><span class="n">U</span>
</pre></div>
</div>
<p>将镜像写入U盘:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">dd</span> <span class="k">if</span><span class="o">=</span><span class="n">ubuntu</span><span class="o">-</span><span class="mf">18.04.2</span><span class="o">-</span><span class="n">live</span><span class="o">-</span><span class="n">server</span><span class="o">-</span><span class="n">amd64</span><span class="o">.</span><span class="n">img</span><span class="o">.</span><span class="n">dmg</span> <span class="n">of</span><span class="o">=/</span><span class="n">dev</span><span class="o">/</span><span class="n">rdisk2</span> <span class="n">bs</span><span class="o">=</span><span class="mi">10</span><span class="n">m</span>
</pre></div>
</div>
<p>然后就可以把U盘拿到目标主机上进行安装</p>
<section id="id2">
<h3>安装提示<a class="headerlink" href="#id2" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p>MacBook Pro/Air使用了UEFI（取代了传统的BIOS），这要求硬盘上必须有一个FAT32分区，标记为EFI分区</p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">备注</p>
<p>在Ubuntu安装过程中，磁盘分区中需要先划分的primary分区，标记为EFI分区。这步骤必须执行，否则安装后MacBook Pro无法从没有EFI分区的磁盘启动。</p>
<p>Ubuntu Desktop版本安装比较灵活，可以自定义EFI分区大小，例如，可以设置200MB。但是，如果使用Ubuntu Server版本，则会强制设置512MB（大小不可调整），而且是系统自动选择创建在 <code class="docutils literal notranslate"><span class="pre">/dev/sda1</span></code> 。</p>
</div>
<ul class="simple">
<li><p>Ubuntu操作系统 <code class="docutils literal notranslate"><span class="pre">/</span></code> 分区默认采用 <code class="docutils literal notranslate"><span class="pre">Ext4</span></code> 文件系统
- 设置了 50G 空间，这样其余的空间预留给 <a class="reference internal" href="../storage/btrfs/btrfs_in_studio.html#btrfs-in-studio"><span class="std std-ref">Studio环境的Btrfs存储</span></a> (提供灵活的卷管理以及磁盘压缩功能) 和 <a class="reference internal" href="../../ceph/ceph_docker_in_studio.html#ceph-docker-in-studio"><span class="std std-ref">Stuido环境Docker容器运行Ceph</span></a> (通过LVM卷模拟多块磁盘)</p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">备注</p>
<p>在UEFI系统中，使用XFS系统分区无法启动Ubuntu，这是因为GRUB的XFS支持的bug。变通的方法是：</p>
<ul class="simple">
<li><p>创建独立的 <code class="docutils literal notranslate"><span class="pre">/boot</span></code> 分区使用ext4文件系统，这样就避免了GRUB读取XFS，可以绕过这个问题。建议 <code class="docutils literal notranslate"><span class="pre">/boot</span></code> 分区至少500MB。</p></li>
<li><p>挂在ESP到 <code class="docutils literal notranslate"><span class="pre">/boot</span></code> : 这个变通类似前一个方法，但是Ubuntu
installer会拒绝这个磁盘划分方法，需要采用其他变通方法安装，然后在emergency启动系统后调整为这个配置。警告：Ubuntu有时候(但不总是)在安装新内核时候会临时创建软连接，而FAT文件系统(在ESP中使用FAT)不支持软链接，就会导致失败。对于使用Mac，可以在ESP上使用HFS+文件系统，即如果在MacBook笔记本上安装双系统启动Linux，可以直接采用macOS使用的HFS+作为ESP文件系统，这样再将这个文件系统挂载到
<code class="docutils literal notranslate"><span class="pre">/boot</span></code> 就可以同时满足条件来使用XFS作为Ubuntu的rootfs。</p></li>
<li><p>使用rEFInd作为boot loader : 实际上GRUB不是Linux唯一的EFI boot loader，可以使用 <a class="reference external" href="http://efi.akeo.ie/">efifs</a> 提供的XFS驱动，即同时安装rEFInd和efifs的XFS驱动就可以工作。</p></li>
</ul>
<p>以上解决方案参考 <a class="reference external" href="https://askubuntu.com/questions/945337/ubuntu-17-04-will-not-boot-on-uefi-system-with-xfs-system-partition">Ubuntu 17.04 will not boot on UEFI system with XFS system partition</a> ，我觉得在MacBook上可以采用方案二，在ThinkPad X220上则可以采用方案一。</p>
</div>
<div class="admonition note">
<p class="admonition-title">备注</p>
<p>实践发现和Fedora不同，采用 Btrfs 作为根文件系统（ 特别配置了 <code class="docutils literal notranslate"><span class="pre">XFS</span></code> 的 <code class="docutils literal notranslate"><span class="pre">/boot</span></code> 分区）无法启动Ubuntu。</p>
</div>
<div class="admonition note">
<p class="admonition-title">备注</p>
<p>MacBook Pro笔记本（物理主机）上安装的Host操作系统，我命名为 <code class="docutils literal notranslate"><span class="pre">xcloud</span></code> ，后续文档中会引用这个Host主机名。</p>
</div>
</section>
</section>
<section id="id3">
<h2>安装后升级系统<a class="headerlink" href="#id3" title="Link to this heading"></a></h2>
<p>初次安装完操作系统，请务必先做系统更新，确保所有软件都保持最新:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">apt</span> <span class="n">update</span>
<span class="n">sudo</span> <span class="n">apt</span> <span class="n">upgrade</span>
</pre></div>
</div>
</section>
<section id="id4">
<h2>安装显卡驱动<a class="headerlink" href="#id4" title="Link to this heading"></a></h2>
<p>MacBook Pro使用的显卡是NVIDIA GeForce GT 750M Mac Edition ，默认安装的显卡驱动是开源的 <code class="docutils literal notranslate"><span class="pre">nouveau</span></code> ，但是开源驱动一方面性能较差，另一方面我希望在 <a class="reference internal" href="../../docker/gpu/nvidia-docker.html#nvidia-docker"><span class="std std-ref">Docker运行NVIDIA容器</span></a> 以便能够支持 <a class="reference internal" href="../../machine_learning/tensorflow/build_tensorflow.html#build-tensorflow"><span class="std std-ref">源代码编译安装TensorFlow</span></a> 进行机器学习。所以，安装完基础操作系统之后，将开源显卡驱动替换成Nvidia官方的GPU驱动。</p>
<ul>
<li><p>安装 <code class="docutils literal notranslate"><span class="pre">ubuntu-drivers</span></code> 工具包:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">apt</span> <span class="n">install</span> <span class="n">ubuntu</span><span class="o">-</span><span class="n">drivers</span><span class="o">-</span><span class="n">common</span>
</pre></div>
</div>
</li>
<li><p>列出建议驱动版本:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ubuntu</span><span class="o">-</span><span class="n">drivers</span> <span class="n">devices</span>
</pre></div>
</div>
</li>
</ul>
<p>输出:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">==</span> <span class="o">/</span><span class="n">sys</span><span class="o">/</span><span class="n">devices</span><span class="o">/</span><span class="n">pci0000</span><span class="p">:</span><span class="mi">00</span><span class="o">/</span><span class="mi">0000</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mf">01.0</span><span class="o">/</span><span class="mi">0000</span><span class="p">:</span><span class="mi">01</span><span class="p">:</span><span class="mf">00.0</span> <span class="o">==</span>
<span class="n">modalias</span> <span class="p">:</span> <span class="n">pci</span><span class="p">:</span><span class="n">v000010DEd00000FE9sv0000106Bsd00000130bc03sc00i00</span>
<span class="n">vendor</span>   <span class="p">:</span> <span class="n">NVIDIA</span> <span class="n">Corporation</span>
<span class="n">model</span>    <span class="p">:</span> <span class="n">GK107M</span> <span class="p">[</span><span class="n">GeForce</span> <span class="n">GT</span> <span class="mi">750</span><span class="n">M</span> <span class="n">Mac</span> <span class="n">Edition</span><span class="p">]</span>
<span class="n">driver</span>   <span class="p">:</span> <span class="n">nvidia</span><span class="o">-</span><span class="mi">340</span> <span class="o">-</span> <span class="n">distro</span> <span class="n">non</span><span class="o">-</span><span class="n">free</span>
<span class="n">driver</span>   <span class="p">:</span> <span class="n">nvidia</span><span class="o">-</span><span class="n">driver</span><span class="o">-</span><span class="mi">390</span> <span class="o">-</span> <span class="n">distro</span> <span class="n">non</span><span class="o">-</span><span class="n">free</span> <span class="n">recommended</span>
<span class="n">driver</span>   <span class="p">:</span> <span class="n">xserver</span><span class="o">-</span><span class="n">xorg</span><span class="o">-</span><span class="n">video</span><span class="o">-</span><span class="n">nouveau</span> <span class="o">-</span> <span class="n">distro</span> <span class="n">free</span> <span class="n">builtin</span>

<span class="o">==</span> <span class="o">/</span><span class="n">sys</span><span class="o">/</span><span class="n">devices</span><span class="o">/</span><span class="n">pci0000</span><span class="p">:</span><span class="mi">00</span><span class="o">/</span><span class="mi">0000</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">1</span><span class="n">c</span><span class="mf">.2</span><span class="o">/</span><span class="mi">0000</span><span class="p">:</span><span class="mi">03</span><span class="p">:</span><span class="mf">00.0</span> <span class="o">==</span>
<span class="n">modalias</span> <span class="p">:</span> <span class="n">pci</span><span class="p">:</span><span class="n">v000014E4d000043A0sv0000106Bsd00000134bc02sc80i00</span>
<span class="n">vendor</span>   <span class="p">:</span> <span class="n">Broadcom</span> <span class="n">Limited</span>
<span class="n">model</span>    <span class="p">:</span> <span class="n">BCM4360</span> <span class="mf">802.11</span><span class="n">ac</span> <span class="n">Wireless</span> <span class="n">Network</span> <span class="n">Adapter</span>
<span class="n">driver</span>   <span class="p">:</span> <span class="n">bcmwl</span><span class="o">-</span><span class="n">kernel</span><span class="o">-</span><span class="n">source</span> <span class="o">-</span> <span class="n">distro</span> <span class="n">non</span><span class="o">-</span><span class="n">free</span>
</pre></div>
</div>
<p>这里可以看到默认推荐驱动 <code class="docutils literal notranslate"><span class="pre">nvidia-driver-390</span></code> ，现在我们来安装:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">ubuntu</span><span class="o">-</span><span class="n">drivers</span> <span class="n">autoinstall</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">备注</p>
<p>稳定版本 <code class="docutils literal notranslate"><span class="pre">nvidia-driver-390</span></code> 不支持 DPMS ，会导致 <code class="docutils literal notranslate"><span class="pre">vbetool</span> <span class="pre">dpms</span> <span class="pre">off</span></code> 关闭屏幕命令无效，所以，我采用添加图形驱动仓库(也是Ubuntu维护)以便安装最新图形驱动(418):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">add</span><span class="o">-</span><span class="n">apt</span><span class="o">-</span><span class="n">repository</span> <span class="n">ppa</span><span class="p">:</span><span class="n">graphics</span><span class="o">-</span><span class="n">drivers</span><span class="o">/</span><span class="n">ppa</span>
<span class="n">ubuntu</span><span class="o">-</span><span class="n">drivers</span> <span class="n">devices</span>
<span class="n">sudo</span> <span class="n">ubuntu</span><span class="o">-</span><span class="n">drivers</span> <span class="n">autoinstall</span>
</pre></div>
</div>
<p>不过，目前测试 <code class="docutils literal notranslate"><span class="pre">418</span></code> 版本的Nvidia驱动，依然没有实现 <code class="docutils literal notranslate"><span class="pre">vbetool</span> <span class="pre">dpms</span> <span class="pre">off</span></code> ，这个问题待解决。</p>
</div>
</section>
<section id="set-ubuntu-wifi">
<span id="id5"></span><h2>设置无线网络<a class="headerlink" href="#set-ubuntu-wifi" title="Link to this heading"></a></h2>
<div class="admonition note">
<p class="admonition-title">备注</p>
<p>由于版权原因，默认安装的Ubuntu Server/Desktop都没有安装Broadcom无线网卡驱动</p>
</div>
<ul>
<li><p>安装wifi驱动:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">apt</span><span class="o">-</span><span class="n">get</span> <span class="o">--</span><span class="n">reinstall</span> <span class="n">install</span> <span class="n">bcmwl</span><span class="o">-</span><span class="n">kernel</span><span class="o">-</span><span class="n">source</span>
</pre></div>
</div>
</li>
</ul>
<p>推荐使用NetworkManager管理无线网络，现代主流Linux发行版，不论是 CentOS 7 还是 Ubuntu 18.0.4，默认都采用了NetworkManager来管理网络。详情请参考 <a class="reference external" href="https://github.com/huataihuang/cloud-atlas-draft/blob/master/os/linux/redhat/system_administration/network/networkmanager_nmcli.md">NetworkManager命令行nmcli</a> 。</p>
<ul>
<li><p>安装NetworkManager:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">apt</span> <span class="n">install</span> <span class="n">network</span><span class="o">-</span><span class="n">manager</span>
</pre></div>
</div>
</li>
<li><p>启动NetworkManager:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">systemctl</span> <span class="n">start</span> <span class="n">NetworkManager</span>
<span class="n">sudo</span> <span class="n">systemctl</span> <span class="n">enable</span> <span class="n">NetworkManager</span>
</pre></div>
</div>
</li>
<li><p>显示所有可以连接的访问热点（AP）:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">nmcli</span> <span class="n">device</span> <span class="n">wifi</span> <span class="nb">list</span>
</pre></div>
</div>
</li>
<li><p>新增加一个wifi类型连接，连接到名为 <code class="docutils literal notranslate"><span class="pre">HOME</span></code> 的AP上（配置设置成名为 <code class="docutils literal notranslate"><span class="pre">MYHOME</span></code> ）:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">nmcli</span> <span class="n">con</span> <span class="n">add</span> <span class="n">con</span><span class="o">-</span><span class="n">name</span> <span class="n">MYHOME</span> <span class="n">ifname</span> <span class="n">wlp3s0</span> <span class="nb">type</span> <span class="n">wifi</span> <span class="n">ssid</span> <span class="n">HOME</span> \
<span class="n">wifi</span><span class="o">-</span><span class="n">sec</span><span class="o">.</span><span class="n">key</span><span class="o">-</span><span class="n">mgmt</span> <span class="n">wpa</span><span class="o">-</span><span class="n">psk</span> <span class="n">wifi</span><span class="o">-</span><span class="n">sec</span><span class="o">.</span><span class="n">psk</span> <span class="n">MYPASSWORD</span>
</pre></div>
</div>
</li>
<li><p>指定配置 <code class="docutils literal notranslate"><span class="pre">MYHOME</span></code> 进行连接:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">nmcli</span> <span class="n">con</span> <span class="n">up</span> <span class="n">MYHOME</span>
</pre></div>
</div>
</li>
<li><p>新增加一个公司所用的802.1x认证的无线网络连接，连接到名为 <code class="docutils literal notranslate"><span class="pre">OFFICE</span></code> 的AP上（配置设置成 <code class="docutils literal notranslate"><span class="pre">MYOFFICE</span></code> ）:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">nmcli</span> <span class="n">con</span> <span class="n">add</span> <span class="n">con</span><span class="o">-</span><span class="n">name</span> <span class="n">MYOFFICE</span> <span class="n">ifname</span> <span class="n">wlp3s0</span> <span class="nb">type</span> <span class="n">wifi</span> <span class="n">ssid</span> <span class="n">OFFICE</span> \
<span class="n">wifi</span><span class="o">-</span><span class="n">sec</span><span class="o">.</span><span class="n">key</span><span class="o">-</span><span class="n">mgmt</span> <span class="n">wpa</span><span class="o">-</span><span class="n">eap</span> <span class="mi">802</span><span class="o">-</span><span class="mi">1</span><span class="n">x</span><span class="o">.</span><span class="n">eap</span> <span class="n">peap</span> <span class="mi">802</span><span class="o">-</span><span class="mi">1</span><span class="n">x</span><span class="o">.</span><span class="n">phase2</span><span class="o">-</span><span class="n">auth</span> <span class="n">mschapv2</span> \
<span class="mi">802</span><span class="o">-</span><span class="mi">1</span><span class="n">x</span><span class="o">.</span><span class="n">identity</span> <span class="s2">&quot;USERNAME&quot;</span> <span class="mi">802</span><span class="o">-</span><span class="mi">1</span><span class="n">x</span><span class="o">.</span><span class="n">password</span> <span class="s2">&quot;MYPASSWORD&quot;</span>
</pre></div>
</div>
</li>
<li><p>执行连接（例如，使用配置 <code class="docutils literal notranslate"><span class="pre">MYOFFICE</span></code> ）:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">nmcli</span> <span class="n">con</span> <span class="n">up</span> <span class="n">MYOFFICE</span>
</pre></div>
</div>
</li>
<li><p>开启或关闭wifi:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">nmcli</span> <span class="n">radio</span> <span class="n">wifi</span> <span class="o">&lt;</span><span class="n">on</span><span class="o">|</span><span class="n">off</span><span class="o">&gt;</span>
</pre></div>
</div>
</li>
</ul>
<div class="admonition note">
<p class="admonition-title">备注</p>
<p><code class="docutils literal notranslate"><span class="pre">nmcli</span></code> 指令有很多缩写的方法，只要命令不重合能够区分，例如 <code class="docutils literal notranslate"><span class="pre">connection</span></code> 可以缩写成 <code class="docutils literal notranslate"><span class="pre">con</span></code> 。</p>
</div>
<div class="admonition note">
<p class="admonition-title">备注</p>
<p>详细请参考 <a class="reference external" href="https://github.com/huataihuang/cloud-atlas-draft/blob/master/os/linux/ubuntu/install/ubuntu_on_macbook_pro_with_wifi.md">Ubuntu在MacBook Pro上WIFI</a></p>
</div>
</section>
<section id="studio-ubuntu-setup">
<span id="id6"></span><h2>配置<a class="headerlink" href="#studio-ubuntu-setup" title="Link to this heading"></a></h2>
<section id="sudo">
<h3>sudo设置<a class="headerlink" href="#sudo" title="Link to this heading"></a></h3>
<ul>
<li><p>由于长期使用Fedora/CentOS，默认自己的各平台都使用 <code class="docutils literal notranslate"><span class="pre">uid=501,gid=20</span></code> ，所以也修订服务器的用户账号 <code class="docutils literal notranslate"><span class="pre">huatai</span></code> 确保多平台一致</p></li>
<li><p>设置账号 huatai 无需密码就可以执行 root 账号命令:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">echo</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">udo   ALL=(ALL:ALL) NOPASSWD:ALL&quot;</span> <span class="o">&gt;&gt;</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">sudoers</span>
</pre></div>
</div>
</li>
</ul>
</section>
<section id="ipv6">
<h3>IPv6设置<a class="headerlink" href="#ipv6" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p>由于不使用IPv6，所以安装后内核配置参数关闭IPv6；另外，为避免Mac硬件的BIOS默认访问macOS特性，需要在内核参数重添加 <code class="docutils literal notranslate"><span class="pre">acpi_osi=!Darwin</span></code></p></li>
</ul>
<p>编辑 <code class="docutils literal notranslate"><span class="pre">/etc/default/grub</span></code> 设置:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">GRUB_CMDLINE_LINUX</span><span class="o">=</span><span class="s2">&quot;ipv6.disable=1 acpi_osi=!Darwin&quot;</span>
</pre></div>
</div>
<p>然后执行 <code class="docutils literal notranslate"><span class="pre">update-grub</span></code> 并重启系统来关闭IPv6</p>
</section>
<section id="id7">
<h3>电源管理设置<a class="headerlink" href="#id7" title="Link to this heading"></a></h3>
<ul>
<li><p>设置笔记本屏幕合上时不进入休眠（以便能够作为服务器运行），需要修改 <code class="docutils literal notranslate"><span class="pre">/etc/systemd/logind.conf</span></code> 配置如下:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">HandleLidSwitch</span><span class="o">=</span><span class="n">ignore</span>
<span class="n">HandleLidSwitchDocked</span><span class="o">=</span><span class="n">ignore</span>
</pre></div>
</div>
</li>
</ul>
<p>然后重启 <code class="docutils literal notranslate"><span class="pre">logind</span></code> 服务:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">systemctl</span> <span class="n">restart</span> <span class="n">systemd</span><span class="o">-</span><span class="n">logind</span>
</pre></div>
</div>
<p>此时合上笔记本屏幕，就可以放在角落里静静工作。</p>
<ul>
<li><p>安装cpupower工具:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">apt</span><span class="o">-</span><span class="n">get</span> <span class="n">install</span> <span class="n">linux</span><span class="o">-</span><span class="n">tools</span><span class="o">-</span><span class="n">common</span> <span class="n">linux</span><span class="o">-</span><span class="n">tools</span><span class="o">-</span><span class="n">generic</span>
</pre></div>
</div>
</li>
</ul>
<p>检查确认处理器默认采用 <code class="docutils literal notranslate"><span class="pre">powersave</span></code> 模式，以便能够降低能耗和温度，详细请参考 <a class="reference internal" href="../../appendix/reduce_laptop_overheat.html#reduce-laptop-overheat"><span class="std std-ref">降低笔记本温度过热</span></a></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">cpupower</span> <span class="n">frequency</span><span class="o">-</span><span class="n">info</span>
</pre></div>
</div>
<p>输出应该类似:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">analyzing</span> <span class="n">CPU</span> <span class="mi">0</span><span class="p">:</span>
  <span class="n">driver</span><span class="p">:</span> <span class="n">intel_pstate</span>
  <span class="n">CPUs</span> <span class="n">which</span> <span class="n">run</span> <span class="n">at</span> <span class="n">the</span> <span class="n">same</span> <span class="n">hardware</span> <span class="n">frequency</span><span class="p">:</span> <span class="mi">0</span>
  <span class="n">CPUs</span> <span class="n">which</span> <span class="n">need</span> <span class="n">to</span> <span class="n">have</span> <span class="n">their</span> <span class="n">frequency</span> <span class="n">coordinated</span> <span class="n">by</span> <span class="n">software</span><span class="p">:</span> <span class="mi">0</span>
  <span class="n">maximum</span> <span class="n">transition</span> <span class="n">latency</span><span class="p">:</span>  <span class="n">Cannot</span> <span class="n">determine</span> <span class="ow">or</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">supported</span><span class="o">.</span>
  <span class="n">hardware</span> <span class="n">limits</span><span class="p">:</span> <span class="mi">800</span> <span class="n">MHz</span> <span class="o">-</span> <span class="mf">3.50</span> <span class="n">GHz</span>
  <span class="n">available</span> <span class="n">cpufreq</span> <span class="n">governors</span><span class="p">:</span> <span class="n">performance</span> <span class="n">powersave</span>
  <span class="n">current</span> <span class="n">policy</span><span class="p">:</span> <span class="n">frequency</span> <span class="n">should</span> <span class="n">be</span> <span class="n">within</span> <span class="mi">800</span> <span class="n">MHz</span> <span class="ow">and</span> <span class="mf">3.50</span> <span class="n">GHz</span><span class="o">.</span>
                  <span class="n">The</span> <span class="n">governor</span> <span class="s2">&quot;powersave&quot;</span> <span class="n">may</span> <span class="n">decide</span> <span class="n">which</span> <span class="n">speed</span> <span class="n">to</span> <span class="n">use</span>
                  <span class="n">within</span> <span class="n">this</span> <span class="nb">range</span><span class="o">.</span>
  <span class="n">current</span> <span class="n">CPU</span> <span class="n">frequency</span><span class="p">:</span> <span class="n">Unable</span> <span class="n">to</span> <span class="n">call</span> <span class="n">hardware</span>
  <span class="n">current</span> <span class="n">CPU</span> <span class="n">frequency</span><span class="p">:</span> <span class="mf">1.81</span> <span class="n">GHz</span> <span class="p">(</span><span class="n">asserted</span> <span class="n">by</span> <span class="n">call</span> <span class="n">to</span> <span class="n">kernel</span><span class="p">)</span>
  <span class="n">boost</span> <span class="n">state</span> <span class="n">support</span><span class="p">:</span>
    <span class="n">Supported</span><span class="p">:</span> <span class="n">yes</span>
    <span class="n">Active</span><span class="p">:</span> <span class="n">yes</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">备注</p>
<p>请确保系统采用了 <code class="docutils literal notranslate"><span class="pre">intel_pstate</span></code> 内核驱动来管理处理器主频动态调整，并且默认设置 <code class="docutils literal notranslate"><span class="pre">powersave</span></code> 。</p>
</div>
<p>关闭显示器节约电能，设置 <code class="docutils literal notranslate"><span class="pre">~/bin/screenoff</span></code> 脚本:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">sh</span> <span class="o">-</span><span class="n">c</span> <span class="s1">&#39;vbetool dpms off; read ans; vbetool dpms on&#39;</span>
</pre></div>
</div>
<p>在合上屏幕之前，先执行这个脚本命令关闭屏幕，这样也能降低笔记本温度。</p>
<div class="admonition note">
<p class="admonition-title">备注</p>
<p>测试发现 <code class="docutils literal notranslate"><span class="pre">vbetool</span> <span class="pre">dpms</span> <span class="pre">off</span></code> 可以关闭 <a class="reference internal" href="ubuntu_on_thinkpad_x220.html#ubuntu-on-thinkpad-x220"><span class="std std-ref">ThinkPad X220上运行Ubuntu</span></a> 的显示屏幕，但是对于MacBook笔记本运行的Ubuntu无效。</p>
<p>参考 <a class="reference external" href="https://unix.stackexchange.com/questions/433452/turning-off-screen">Turning off screen</a> 似乎可以通过设置:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">echo</span> <span class="mi">0</span> <span class="o">|</span> <span class="n">sudo</span> <span class="n">tee</span> <span class="o">/</span><span class="n">sys</span><span class="o">/</span><span class="n">class</span><span class="o">/</span><span class="n">backlight</span><span class="o">/</span><span class="n">acpi_video0</span><span class="o">/</span><span class="n">brightness</span>
</pre></div>
</div>
<p>来修改亮度。但是我测试没有效果。这个问题似乎和Nvidia显卡驱动有关 <a class="reference external" href="https://devtalk.nvidia.com/default/topic/968059/linux/dpms-not-working-with-displayport-monitor/1">DPMS not working with DisplayPort monitor</a> 例如，Nvidia驱动 375.10 不支持DPMS，</p>
<p>不过，根据最新反馈 <a class="reference external" href="https://devtalk.nvidia.com/default/topic/968059/linux/dpms-not-working-with-displayport-monitor/5">Nvidia v415.22驱动+Kernel 4.19.8可能支持 HardDPMS</a> ，或许可以尝试一下。</p>
</div>
</section>
<section id="ssh">
<h3>ssh设置<a class="headerlink" href="#ssh" title="Link to this heading"></a></h3>
<ul>
<li><p>将自己的密钥对复制到 xcloud 服务器上，确保后续能够免密码登陆各个虚拟机</p></li>
<li><p>由于我需要在 xcloud 这台物理主机上作为管理堡垒机来管理整个模拟的计算机集群虚拟机，虽然可以通过密钥登陆，但是每次输入密钥保护密码是非常麻烦的。所以按照之前工作经验 <a class="reference external" href="https://github.com/huataihuang/cloud-atlas-draft/blob/master/service/ssh/ssh_key.md">ssh密钥认证</a> 中的 ssh-agent 方法，在个人目录下 <code class="docutils literal notranslate"><span class="pre">~/.profile</span></code> 中添加:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>if [ -f ~/.agent.env ]; then
  . ~/.agent.env -s &gt; /dev/null

  if ! kill -0 $SSH_AGENT_PID &gt; /dev/null 2&gt;&amp;1; then
    echo
    echo &quot;Stale agent file found.  Spawning new agent...&quot;
    eval `ssh-agent -s | tee ~/.agent.env`
    ssh-add
  fi
else
  echo &quot;Starting ssh-agent...&quot;
  eval `ssh-agent -s | tee ~/.agent.env`
  ssh-add
fi
</pre></div>
</div>
</li>
</ul>
<p>这样首次登陆系统会自动加载 <code class="docutils literal notranslate"><span class="pre">ssh-agent</span></code> ，只需要输入一次密钥保护密码就可以免密码登陆需要维护的集群虚拟机。</p>
<ul>
<li><p>SSH提供了一种 <code class="docutils literal notranslate"><span class="pre">multiplexing</span></code> （多路传输）机制，可以重用已有的TCP连接，在维护系统时非常方便，加速了ssh登陆，推荐在 <code class="docutils literal notranslate"><span class="pre">xcloud</span></code> Host主机上配置客户端，方便登陆各个虚拟机操作。即设置 <code class="docutils literal notranslate"><span class="pre">~/.ssh/config</span></code> 配置如下:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Host</span> <span class="o">*</span>
    <span class="n">ServerAliveInterval</span> <span class="mi">60</span>
    <span class="n">ControlMaster</span> <span class="n">auto</span>
    <span class="n">ControlPath</span> <span class="o">~/.</span><span class="n">ssh</span><span class="o">/%</span><span class="n">h</span><span class="o">-%</span><span class="n">p</span><span class="o">-%</span><span class="n">r</span>
    <span class="n">ControlPersist</span> <span class="n">yes</span>

<span class="n">Host</span> <span class="n">ubuntu18</span><span class="o">-</span><span class="mi">04</span>
    <span class="n">HostName</span> <span class="mf">192.168.122.2</span>
    <span class="n">User</span> <span class="n">huatai</span>
</pre></div>
</div>
</li>
</ul>
<div class="admonition note">
<p class="admonition-title">备注</p>
<p>详细请参考 <a class="reference external" href="https://github.com/huataihuang/cloud-atlas-draft/blob/master/service/ssh/multiplexing.md">ssh多路传输multiplexing加速</a></p>
</div>
</section>
<section id="screen">
<h3>screen设置<a class="headerlink" href="#screen" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p>在服务器维护过程中，经常需要启用 <code class="docutils literal notranslate"><span class="pre">screen</span></code> 以便在服务器端保持工作状态，建议在 <code class="docutils literal notranslate"><span class="pre">xcloud</span></code> 主机上添加 <code class="docutils literal notranslate"><span class="pre">~/.screenrc</span></code> :</p></li>
</ul>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="nb">source</span><span class="w"> </span>/etc/screenrc
<span class="linenos"> 2</span>altscreen<span class="w"> </span>off
<span class="linenos"> 3</span>hardstatus<span class="w"> </span>none
<span class="linenos"> 4</span>caption<span class="w"> </span>always<span class="w"> </span><span class="s2">&quot;%{= wk}%{wk}%-Lw%{rw} %n+%f %t %{wk}%+Lw %=%c%{= R}%{-}&quot;</span>
<span class="linenos"> 5</span>
<span class="linenos"> 6</span>shelltitle<span class="w"> </span><span class="s2">&quot;</span>$<span class="s2"> |bash&quot;</span>
<span class="linenos"> 7</span>defscrollback<span class="w"> </span><span class="m">50000</span>
<span class="linenos"> 8</span>startup_message<span class="w"> </span>off
<span class="linenos"> 9</span>escape<span class="w"> </span>^aa
<span class="linenos">10</span>
<span class="linenos">11</span>termcapinfo<span class="w"> </span>xterm<span class="p">|</span>xterms<span class="p">|</span>xs<span class="p">|</span>rxvt<span class="w"> </span>ti@:te@<span class="w"> </span><span class="c1"># scroll bar support</span>
<span class="linenos">12</span>term<span class="w"> </span>rxvt<span class="w"> </span><span class="c1"># mouse support</span>
<span class="linenos">13</span>
<span class="linenos">14</span>bindkey<span class="w"> </span>-k<span class="w"> </span>k<span class="p">;</span><span class="w"> </span>screen
<span class="linenos">15</span>bindkey<span class="w"> </span>-k<span class="w"> </span>F1<span class="w"> </span>prev
<span class="linenos">16</span>bindkey<span class="w"> </span>-k<span class="w"> </span>F2<span class="w"> </span>next
<span class="linenos">17</span>bindkey<span class="w"> </span>-d<span class="w"> </span>-k<span class="w"> </span>kb<span class="w"> </span>stuff<span class="w"> </span>^H
<span class="linenos">18</span><span class="nb">bind</span><span class="w"> </span>x<span class="w"> </span>remove
<span class="linenos">19</span><span class="nb">bind</span><span class="w"> </span>j<span class="w"> </span><span class="nb">eval</span><span class="w"> </span><span class="s2">&quot;focus down&quot;</span>
<span class="linenos">20</span><span class="nb">bind</span><span class="w"> </span>k<span class="w"> </span><span class="nb">eval</span><span class="w"> </span><span class="s2">&quot;focus up&quot;</span>
<span class="linenos">21</span><span class="nb">bind</span><span class="w"> </span>s<span class="w"> </span><span class="nb">eval</span><span class="w"> </span><span class="s2">&quot;split&quot;</span><span class="w"> </span><span class="s2">&quot;focus down&quot;</span><span class="w"> </span><span class="s2">&quot;prev&quot;</span>
<span class="linenos">22</span>vbell<span class="w"> </span>off
<span class="linenos">23</span>shell<span class="w"> </span>-bash
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">备注</p>
<p>详细使用screen工具来帮助维护服务器，请参考 <a class="reference external" href="https://github.com/huataihuang/cloud-atlas-draft/blob/master/develop/shell/utilities/screen.md">screen</a></p>
</div>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="页脚">
        <a href="index.html" class="btn btn-neutral float-left" title="Ubuntu Linux" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> 上一页</a>
        <a href="ubuntu_on_thinkpad_x220.html" class="btn btn-neutral float-right" title="ThinkPad X220上运行Ubuntu" accesskey="n" rel="next">下一页 <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; <a href="../../copyright.html">版权所有</a> 2018 - now, Huatai Huang。</p>
  </div>

  利用 <a href="https://www.sphinx-doc.org/">Sphinx</a> 构建，使用的 
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">主题</a>
    由 <a href="https://readthedocs.org">Read the Docs</a> 开发.
  
    <!-- your html code here -->
    <br>
    <p><a href="https://github.com/huataihuang/cloud-atlas/issues">留言和讨论</a>|<a href="https://github.com/huataihuang/cloud-atlas/blob/master/source/donate.rst">请我喝一杯咖啡 👈</a></p>
    <br>
    <p>网站采用 <a href="https://utteranc.es/">utterances</a> 评论系统，所有评论存储在<a href="https://github.com/huataihuang/cloud-atlas/issues">GitHub issues</a> 中，如果你看不到下方的评论框，那么可能需要<a href="https://cloud-atlas.readthedocs.io/zh-cn/latest/linux/security/vpn/index.html">自备梯子</a> 👈</p>
    <div class="articleComments">
        <comments>
  <script src="https://utteranc.es/client.js"
    repo="huataihuang/cloud-atlas"
    issue-term="pathname"
    theme="github-light"
    crossorigin="anonymous"
    async>
  </script>
</comments>
    </div>


</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>