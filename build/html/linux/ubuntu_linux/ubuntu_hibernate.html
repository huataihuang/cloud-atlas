<!DOCTYPE html>
<html class="writer-html5" lang="zh" data-content_root="../../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Ubuntu Hibernate休眠 &mdash; Cloud Atlas: Discovery beta 文档</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/theme.css?v=19f00094" />
      <link rel="stylesheet" type="text/css" href="../../_static/graphviz.css?v=fd3f3429" />

  
    <link rel="shortcut icon" href="../../_static/favicon.png"/>
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../../_static/jquery.js?v=5d32c60e"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../../_static/documentation_options.js?v=8534f863"></script>
        <script src="../../_static/doctools.js?v=9a2dae69"></script>
        <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="索引" href="../../genindex.html" />
    <link rel="search" title="搜索" href="../../search.html" />
    <link rel="copyright" title="版权所有" href="../../copyright.html" />
    <link rel="next" title="Ubuntu Hibernate休眠(旧实践归档)" href="ubuntu_hibernate_old.html" />
    <link rel="prev" title="升级Ubuntu" href="upgrade_ubuntu.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            Cloud Atlas: Discovery
          </a>
              <div class="version">
                1.1
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="搜索文档" aria-label="搜索文档" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="导航菜单">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../studio/index.html">Studio</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../infrastructure/index.html">Infrastructure</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../devops/index.html">DevOps</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../kvm/index.html">KVM</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ceph/index.html">Ceph</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../gluster/index.html">Gluster</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ovirt/index.html">oVirt</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../openstack/index.html">OpenStack</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../docker/index.html">Docker</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../kubernetes/index.html">Kubernetes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../k8s_dev/index.html">Kubernetes Develop</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../rancher/index.html">Rancher</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../openshift/index.html">OpenShift</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../sql/index.html">SQL</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../sqlite/index.html">SQLite</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../mysql/index.html">MySQL</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../pgsql/index.html">PostgreSQL</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../nosql/index.html">NoSQL</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../network/index.html">Network</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../infra_service/index.html">Infra-Service</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../infra_search/index.html">Infra-Search</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../web/index.html">Web</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../info_service/index.html">Info-Service</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../big_data/index.html">Big Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../machine_learning/index.html">Machine Learning</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../drone/index.html">Drone</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">Linux</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../best_linux.html">最佳Linux</a></li>
<li class="toctree-l2"><a class="reference internal" href="../admin/index.html">Linux系统管理</a></li>
<li class="toctree-l2"><a class="reference internal" href="../redhat_linux/index.html">RedHat Linux</a></li>
<li class="toctree-l2"><a class="reference internal" href="../arch_linux/index.html">Arch Linux</a></li>
<li class="toctree-l2"><a class="reference internal" href="../asahi_linux/index.html">Asahi Linux</a></li>
<li class="toctree-l2"><a class="reference internal" href="../gentoo_linux/index.html">Gentoo Linux</a></li>
<li class="toctree-l2"><a class="reference internal" href="../lfs/index.html">LFS(Linux from scratch)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../blfs/index.html">BLFS(Beyond Linux from scratch)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../alfs/index.html">ALFS(Automated Linux from scratch)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pilfs/index.html">PiLFS(Automated Linux from scratch on the Raspberry Pi)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../yocto/index.html">Yocto</a></li>
<li class="toctree-l2"><a class="reference internal" href="../debian/index.html">Debian</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html">Ubuntu Linux</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="ubuntu_on_mbp.html">MacBook Pro上运行Ubuntu</a></li>
<li class="toctree-l3"><a class="reference internal" href="ubuntu_on_thinkpad_x220.html">ThinkPad X220上运行Ubuntu</a></li>
<li class="toctree-l3"><a class="reference internal" href="ubuntu_server.html">Ubuntu Server</a></li>
<li class="toctree-l3"><a class="reference internal" href="ubuntu_server_init.html">Ubuntu服务器初始化</a></li>
<li class="toctree-l3"><a class="reference internal" href="ubuntu_desktop.html">Ubuntu Desktop</a></li>
<li class="toctree-l3"><a class="reference internal" href="upgrade_ubuntu.html">升级Ubuntu</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Ubuntu Hibernate休眠</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#swap">准备swap分区</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id2">配置内核参数</a></li>
<li class="toctree-l4"><a class="reference internal" href="#root">非root用户</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id3">异常排查</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id4">参考</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="ubuntu_hibernate_old.html">Ubuntu Hibernate休眠(旧实践归档)</a></li>
<li class="toctree-l3"><a class="reference internal" href="admin/index.html">Ubuntu系统管理</a></li>
<li class="toctree-l3"><a class="reference internal" href="cgroup/index.html">Ubuntu Cgroup</a></li>
<li class="toctree-l3"><a class="reference internal" href="network/index.html">Ubuntu网络</a></li>
<li class="toctree-l3"><a class="reference internal" href="storage/index.html">Ubuntu存储管理</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../suse_linux/index.html">SUSE Linux</a></li>
<li class="toctree-l2"><a class="reference internal" href="../kali_linux/index.html">Kali Linux</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tails_linux/index.html">Tails Linux</a></li>
<li class="toctree-l2"><a class="reference internal" href="../qubes_os/index.html">Qubes OS</a></li>
<li class="toctree-l2"><a class="reference internal" href="../postmarketos/index.html">postmarketOS</a></li>
<li class="toctree-l2"><a class="reference internal" href="../container_os/index.html">容器化操作系统(Container OS)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../fedora_coreos/index.html">Fedora CoreOS容器操作系统</a></li>
<li class="toctree-l2"><a class="reference internal" href="../chromeos/index.html">ChromeOS</a></li>
<li class="toctree-l2"><a class="reference internal" href="../alpine_linux/index.html">Alpine Linux</a></li>
<li class="toctree-l2"><a class="reference internal" href="../subgraph_os/index.html">Subgraph OS</a></li>
<li class="toctree-l2"><a class="reference internal" href="../kaios/index.html">KaiOS - 世界第三手机操作系统</a></li>
<li class="toctree-l2"><a class="reference internal" href="../compute/index.html">Linux计算</a></li>
<li class="toctree-l2"><a class="reference internal" href="../storage/index.html">Linux存储</a></li>
<li class="toctree-l2"><a class="reference internal" href="../network/index.html">Linux网络</a></li>
<li class="toctree-l2"><a class="reference internal" href="../server/index.html">Linux服务器</a></li>
<li class="toctree-l2"><a class="reference internal" href="../security/index.html">Linux安全</a></li>
<li class="toctree-l2"><a class="reference internal" href="../desktop/index.html">Linux桌面</a></li>
<li class="toctree-l2"><a class="reference internal" href="../linux_tablet/index.html">Linux平板</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../kernel/index.html">Kernel</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../performance/index.html">Performance</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../distributed_system/index.html">Distributed System</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../shell/index.html">Shell</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../python/index.html">Python</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../django/index.html">Django</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../javascript/index.html">JavaScript</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../nodejs/index.html">Node.js</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../clang/index.html">C</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../golang/index.html">Go</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../swift/index.html">Swift</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../rust/index.html">Rust</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ruby/index.html">Ruby</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../lua/index.html">Lua</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../arm/index.html">ARM</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../raspberry_pi/index.html">Raspberry Pi</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../android/index.html">Android</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../bsd/index.html">BSD</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../freebsd/index.html">FreeBSD</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../apple/index.html">Apple</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../windows/index.html">Windows</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../real/index.html">Real</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../management/index.html">Management</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../life/index.html">Life</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../copyright.html">Copyright</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../aboutme.html">关于作者</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../donate.html">捐赠</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../thanks.html">感谢</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../roadmap.html">Roadmap</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../appendix/index.html">附录</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="移动版导航菜单" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Cloud Atlas: Discovery</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="页面导航">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../index.html">Linux</a></li>
          <li class="breadcrumb-item"><a href="index.html">Ubuntu Linux</a></li>
      <li class="breadcrumb-item active">Ubuntu Hibernate休眠</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../_sources/linux/ubuntu_linux/ubuntu_hibernate.rst.txt" rel="nofollow"> 查看页面源码</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="ubuntu-hibernate">
<span id="id1"></span><h1>Ubuntu Hibernate休眠<a class="headerlink" href="#ubuntu-hibernate" title="Link to this heading"></a></h1>
<p>从Ubuntu 21.04 开始，需要采用 <a class="reference internal" href="../redhat_linux/systemd/index.html#systemd"><span class="std std-ref">Systemd进程管理器</span></a> 结合内核来实现休眠，原先用户端 <code class="docutils literal notranslate"><span class="pre">uswsusp</span></code> 已经不再支持。</p>
<p><code class="docutils literal notranslate"><span class="pre">systemd-hibernate.service</span></code> 直接激活会提示错误:</p>
<div class="literal-block-wrapper docutils container" id="id6">
<div class="code-block-caption"><span class="caption-text">尝试激活 <code class="docutils literal notranslate"><span class="pre">systemd-hibernate.service</span></code></span><a class="headerlink" href="#id6" title="Link to this code"></a></div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">systemctl</span> <span class="n">enable</span> <span class="n">systemd</span><span class="o">-</span><span class="n">hibernate</span><span class="o">.</span><span class="n">service</span>
</pre></div>
</div>
</div>
<p>提示报错:</p>
<div class="literal-block-wrapper docutils container" id="id7">
<div class="code-block-caption"><span class="caption-text">尝试激活 <code class="docutils literal notranslate"><span class="pre">systemd-hibernate.service</span></code> 报错</span><a class="headerlink" href="#id7" title="Link to this code"></a></div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>The unit files have no installation config (WantedBy=, RequiredBy=, Also=,
Alias= settings in the [Install] section, and DefaultInstance= for template
units). This means they are not meant to be enabled using systemctl.

Possible reasons for having this kind of units are:
• A unit may be statically enabled by being symlinked from another unit&#39;s
  .wants/ or .requires/ directory.
• A unit&#39;s purpose may be to act as a helper for some other unit which has
  a requirement dependency on it.
• A unit may be started when needed via activation (socket, path, timer,
  D-Bus, udev, scripted systemctl call, ...).
• In case of template units, the unit is meant to be enabled with some
  instance name specified.
</pre></div>
</div>
</div>
<p>需要向内核传递swap参数，也就是 <code class="docutils literal notranslate"><span class="pre">resume=UUID=</span></code> :</p>
<ul class="simple">
<li><p>当使用 swap 分区时不需要传递 <code class="docutils literal notranslate"><span class="pre">resume_offset</span></code> 参数</p></li>
<li><p>当时用 swap 文件时，则需要参考 <a class="reference internal" href="../arch_linux/archlinux_hibernates.html#archlinux-hibernates"><span class="std std-ref">Arch Linux Hibernates</span></a> 实践中设置传递swap文件的offset参数</p></li>
</ul>
<section id="swap">
<h2>准备swap分区<a class="headerlink" href="#swap" title="Link to this heading"></a></h2>
<p>可以使用 swap 分区，也可以使用 swap 文件: 在提供hibernate的磁盘存储上没有本质区别，只是 swap 分区只需要向内核传递 <code class="docutils literal notranslate"><span class="pre">resume=UUID=</span></code> 参数指向分区即可；而 swap 文件还需要同时传递一个 <code class="docutils literal notranslate"><span class="pre">swap_file_offset</span></code> 参数(见 <a class="reference internal" href="ubuntu_hibernate_old.html#ubuntu-hibernate-old"><span class="std std-ref">Ubuntu Hibernate休眠(旧实践归档)</span></a> )。我在这里的实践采用swap分区:</p>
<ul class="simple">
<li><p>分区准备:</p></li>
</ul>
<div class="literal-block-wrapper docutils container" id="id8">
<div class="code-block-caption"><span class="caption-text">准备swap分区</span><a class="headerlink" href="#id8" title="Link to this code"></a></div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">parted</span> <span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">sda</span> <span class="n">mklabel</span> <span class="n">gpt</span>
<span class="n">parted</span> <span class="o">-</span><span class="n">a</span> <span class="n">optimal</span> <span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">sda</span> <span class="n">mkpart</span> <span class="n">swap</span> <span class="n">linux_swap</span> <span class="mi">0</span><span class="o">%</span> <span class="mi">512</span><span class="n">MB</span>
<span class="n">mkswap</span> <span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">sda1</span>
<span class="n">swapon</span> <span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">sda1</span>
</pre></div>
</div>
</div>
<ul class="simple">
<li><p>检查磁盘分区的uuid:</p></li>
</ul>
<div class="literal-block-wrapper docutils container" id="id9">
<div class="code-block-caption"><span class="caption-text">检查sda1的磁盘uuid</span><a class="headerlink" href="#id9" title="Link to this code"></a></div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">blkid</span> <span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">sda1</span>
</pre></div>
</div>
</div>
<p>显示uuid如下:</p>
<div class="literal-block-wrapper docutils container" id="id10">
<div class="code-block-caption"><span class="caption-text">检查sda1的磁盘uuid</span><a class="headerlink" href="#id10" title="Link to this code"></a></div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">sda1</span><span class="p">:</span> <span class="n">UUID</span><span class="o">=</span><span class="s2">&quot;4525e419-1e24-48e8-9b7c-e03d281d7b41&quot;</span> <span class="n">TYPE</span><span class="o">=</span><span class="s2">&quot;swap&quot;</span> <span class="n">PARTLABEL</span><span class="o">=</span><span class="s2">&quot;swap&quot;</span> <span class="n">PARTUUID</span><span class="o">=</span><span class="s2">&quot;ba7c6674-5d6e-4aa5-a2ed-cb0e265b73b7&quot;</span>
</pre></div>
</div>
</div>
<ul class="simple">
<li><p>对应在 <code class="docutils literal notranslate"><span class="pre">/etc/fstab</span></code> 添加swap配置:</p></li>
</ul>
<div class="literal-block-wrapper docutils container" id="id11">
<div class="code-block-caption"><span class="caption-text">在 <code class="docutils literal notranslate"><span class="pre">/etc/fstab</span></code> 中添加swap配置</span><a class="headerlink" href="#id11" title="Link to this code"></a></div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">disk</span><span class="o">/</span><span class="n">by</span><span class="o">-</span><span class="n">uuid</span><span class="o">/</span><span class="mf">4525e419</span><span class="o">-</span><span class="mf">1e24</span><span class="o">-</span><span class="mf">48e8</span><span class="o">-</span><span class="mi">9</span><span class="n">b7c</span><span class="o">-</span><span class="n">e03d281d7b41</span> <span class="n">none</span> <span class="n">swap</span> <span class="n">defaults</span> <span class="mi">0</span> <span class="mi">0</span>
</pre></div>
</div>
</div>
</section>
<section id="id2">
<h2>配置内核参数<a class="headerlink" href="#id2" title="Link to this heading"></a></h2>
<ul class="simple">
<li><p>编辑 <code class="docutils literal notranslate"><span class="pre">/etc/default/grub</span></code> 添加</p></li>
</ul>
<div class="literal-block-wrapper docutils container" id="id12">
<div class="code-block-caption"><span class="caption-text">编辑 <code class="docutils literal notranslate"><span class="pre">/etc/default/grub</span></code> 传递hibernate resume参数</span><a class="headerlink" href="#id12" title="Link to this code"></a></div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">GRUB_CMDLINE_LINUX_DEFAULT</span><span class="o">=</span><span class="s2">&quot;intel_iommu=on iommu=pt intel_pstate=enable processor.max_cstate=1 intel_idle.max_cstate=1 rd.driver.blacklist=nouveau,rivafb,nvidiafb,rivatv resume=UUID=4525e419-1e24-48e8-9b7c-e03d281d7b41&quot;</span>
</pre></div>
</div>
</div>
<ul class="simple">
<li><p>编辑 <code class="docutils literal notranslate"><span class="pre">/etc/initramfs-tools/conf.d/resume</span></code></p></li>
</ul>
<div class="literal-block-wrapper docutils container" id="id13">
<div class="code-block-caption"><span class="caption-text">编辑 <code class="docutils literal notranslate"><span class="pre">/etc/initramfs-tools/conf.d/resume</span></code> 为 initramfs 传递resume参数</span><a class="headerlink" href="#id13" title="Link to this code"></a></div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">RESUME</span><span class="o">=</span><span class="n">UUID</span><span class="o">=</span><span class="mf">4525e419</span><span class="o">-</span><span class="mf">1e24</span><span class="o">-</span><span class="mf">48e8</span><span class="o">-</span><span class="mi">9</span><span class="n">b7c</span><span class="o">-</span><span class="n">e03d281d7b41</span>
</pre></div>
</div>
</div>
<ul class="simple">
<li><p>重建 <code class="docutils literal notranslate"><span class="pre">initramfs</span></code> :</p></li>
</ul>
<div class="literal-block-wrapper docutils container" id="id14">
<div class="code-block-caption"><span class="caption-text">重新生成initramfs</span><a class="headerlink" href="#id14" title="Link to this code"></a></div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">update</span><span class="o">-</span><span class="n">initramfs</span> <span class="o">-</span><span class="n">c</span> <span class="o">-</span><span class="n">k</span> <span class="nb">all</span>
</pre></div>
</div>
</div>
<ul class="simple">
<li><p>重启一次服务器; <code class="docutils literal notranslate"><span class="pre">reboot</span></code></p></li>
<li><p>重启完成后，就可以通过 <a class="reference internal" href="../redhat_linux/systemd/index.html#systemd"><span class="std std-ref">Systemd进程管理器</span></a> 来管理hibernate:</p></li>
</ul>
<div class="literal-block-wrapper docutils container" id="id15">
<div class="code-block-caption"><span class="caption-text">通过 <a class="reference internal" href="../redhat_linux/systemd/index.html#systemd"><span class="std std-ref">Systemd进程管理器</span></a> 管理 hibernate</span><a class="headerlink" href="#id15" title="Link to this code"></a></div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">systemctl</span> <span class="n">hibernate</span>
</pre></div>
</div>
</div>
<p>当完成hibernate存储运行到磁盘之后，服务器就会断电关机。要重新恢复运行状态，则按下电钮即可，在控制台终端最后会看到一段有关image加载的记录:</p>
<figure class="align-default" id="id16">
<img alt="../../_images/hibernage_load.png" src="../../_images/hibernage_load.png" />
<figcaption>
<p><span class="caption-text">操作系统启动时恢复hibernate存储状态</span><a class="headerlink" href="#id16" title="Link to this image"></a></p>
</figcaption>
</figure>
<ul class="simple">
<li><p>系统恢复以后，可以通过以下命令检查 <code class="docutils literal notranslate"><span class="pre">systemd-hibernate</span></code> 服务，可以看到加载是否成功以及出错信息(如果有的话):</p></li>
</ul>
<div class="literal-block-wrapper docutils container" id="id17">
<div class="code-block-caption"><span class="caption-text">检查hibernate恢复状态</span><a class="headerlink" href="#id17" title="Link to this code"></a></div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">systemctl</span> <span class="n">status</span> <span class="n">systemd</span><span class="o">-</span><span class="n">hibernate</span><span class="o">.</span><span class="n">service</span>
</pre></div>
</div>
</div>
<p>输出类似如下:</p>
<div class="literal-block-wrapper docutils container" id="id18">
<div class="code-block-caption"><span class="caption-text">检查hibernate恢复状态信息输出(多次记录)</span><a class="headerlink" href="#id18" title="Link to this code"></a></div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>○ systemd-hibernate.service - Hibernate
     Loaded: loaded (/lib/systemd/system/systemd-hibernate.service; static)
     Active: inactive (dead)
       Docs: man:systemd-hibernate.service(8)

Dec 02 08:03:33 zcloud.staging.huatai.me systemd-sleep[17268]: System returned from sleep state.
Dec 02 08:03:33 zcloud.staging.huatai.me systemd[1]: systemd-hibernate.service: Deactivated successfully.
Dec 02 08:03:33 zcloud.staging.huatai.me systemd[1]: Finished Hibernate.
Dec 02 08:03:33 zcloud.staging.huatai.me systemd[1]: systemd-hibernate.service: Consumed 29.492s CPU time.
Dec 02 08:14:02 zcloud.staging.huatai.me systemd[1]: Starting Hibernate...
Dec 02 08:14:03 zcloud.staging.huatai.me systemd-sleep[50217]: Entering sleep state &#39;hibernate&#39;...
<span class="hll">Dec 02 18:17:09 zcloud.staging.huatai.me systemd-sleep[50217]: System returned from sleep state.
</span><span class="hll">Dec 02 18:17:09 zcloud.staging.huatai.me systemd[1]: systemd-hibernate.service: Deactivated successfully.
</span><span class="hll">Dec 02 18:17:09 zcloud.staging.huatai.me systemd[1]: Finished Hibernate.
</span><span class="hll">Dec 02 18:17:09 zcloud.staging.huatai.me systemd[1]: systemd-hibernate.service: Consumed 29.599s CPU time.
</span></pre></div>
</div>
</div>
</section>
<section id="root">
<h2>非root用户<a class="headerlink" href="#root" title="Link to this heading"></a></h2>
<div class="admonition note">
<p class="admonition-title">备注</p>
<p><a class="reference external" href="https://www.linuxuprising.com/2021/08/how-to-enable-hibernation-on-ubuntu.html">How To Enable Hibernation On Ubuntu (When Using A Swap File)</a> 还提供了一些非root用户使用hibernate的配置方法，我没有实践。如有需要请参考原文</p>
</div>
</section>
<section id="id3">
<h2>异常排查<a class="headerlink" href="#id3" title="Link to this heading"></a></h2>
<p><code class="docutils literal notranslate"><span class="pre">systemctl</span> <span class="pre">hibernate</span></code> 之后，我开启电源，发现服务器确实启动后进行了镜像解压缩，也就是从swap分区中将先前 <code class="docutils literal notranslate"><span class="pre">hibernate</span></code> 的内存中状态恢复过来:</p>
<div class="literal-block-wrapper docutils container" id="id19">
<div class="code-block-caption"><span class="caption-text">从 <code class="docutils literal notranslate"><span class="pre">hibernage</span></code> 状态恢复时控制台输出信息显示保存在磁盘中的镜像已经完全恢复</span><a class="headerlink" href="#id19" title="Link to this code"></a></div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span>   <span class="mf">54.388716</span><span class="p">]</span> <span class="n">PM</span><span class="p">:</span> <span class="n">hibernation</span><span class="p">:</span> <span class="n">resume</span> <span class="kn">from</span> <span class="nn">hibernation</span>
<span class="p">[</span>   <span class="mf">54.419218</span><span class="p">]</span> <span class="n">Freezing</span> <span class="n">user</span> <span class="n">space</span> <span class="n">processes</span> <span class="o">...</span> <span class="p">(</span><span class="n">elapsed</span> <span class="mf">0.001</span> <span class="n">seconds</span><span class="p">)</span> <span class="n">done</span><span class="o">.</span>
<span class="p">[</span>   <span class="mf">54.462750</span><span class="p">]</span> <span class="n">OOM</span> <span class="n">killer</span> <span class="n">disabled</span><span class="o">.</span>
<span class="p">[</span>   <span class="mf">54.482747</span><span class="p">]</span> <span class="n">Freezing</span> <span class="n">remaining</span> <span class="n">freezable</span> <span class="n">tasks</span> <span class="o">...</span> <span class="p">(</span><span class="n">elapsed</span> <span class="mf">0.001</span> <span class="n">seconds</span><span class="p">)</span> <span class="n">done</span><span class="o">.</span>
<span class="p">[</span>   <span class="mf">54.797313</span><span class="p">]</span> <span class="n">PM</span><span class="p">:</span> <span class="n">Using</span> <span class="mi">3</span> <span class="n">thread</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="k">for</span> <span class="n">decompression</span>
<span class="p">[</span>   <span class="mf">54.820978</span><span class="p">]</span> <span class="n">PM</span><span class="p">:</span> <span class="n">Loading</span> <span class="ow">and</span> <span class="n">decompressing</span> <span class="n">image</span> <span class="n">data</span> <span class="p">(</span><span class="mi">4114252</span> <span class="n">pages</span><span class="p">)</span><span class="o">...</span>
<span class="p">[</span>   <span class="mf">54.929475</span><span class="p">]</span> <span class="n">PM</span><span class="p">:</span> <span class="n">Image</span> <span class="n">loading</span> <span class="n">progress</span><span class="p">:</span>   <span class="mi">0</span><span class="o">%</span>
<span class="p">[</span>   <span class="mf">65.625271</span><span class="p">]</span> <span class="n">PM</span><span class="p">:</span> <span class="n">Image</span> <span class="n">loading</span> <span class="n">progress</span><span class="p">:</span>  <span class="mi">10</span><span class="o">%</span>
<span class="p">[</span>   <span class="mf">70.616074</span><span class="p">]</span> <span class="n">PM</span><span class="p">:</span> <span class="n">Image</span> <span class="n">loading</span> <span class="n">progress</span><span class="p">:</span>  <span class="mi">20</span><span class="o">%</span>
<span class="p">[</span>   <span class="mf">75.275002</span><span class="p">]</span> <span class="n">PM</span><span class="p">:</span> <span class="n">Image</span> <span class="n">loading</span> <span class="n">progress</span><span class="p">:</span>  <span class="mi">30</span><span class="o">%</span>
<span class="p">[</span>   <span class="mf">80.097537</span><span class="p">]</span> <span class="n">PM</span><span class="p">:</span> <span class="n">Image</span> <span class="n">loading</span> <span class="n">progress</span><span class="p">:</span>  <span class="mi">40</span><span class="o">%</span>
<span class="p">[</span>   <span class="mf">84.834466</span><span class="p">]</span> <span class="n">PM</span><span class="p">:</span> <span class="n">Image</span> <span class="n">loading</span> <span class="n">progress</span><span class="p">:</span>  <span class="mi">50</span><span class="o">%</span>
<span class="p">[</span>   <span class="mf">89.929866</span><span class="p">]</span> <span class="n">PM</span><span class="p">:</span> <span class="n">Image</span> <span class="n">loading</span> <span class="n">progress</span><span class="p">:</span>  <span class="mi">60</span><span class="o">%</span>
<span class="p">[</span>   <span class="mf">94.942385</span><span class="p">]</span> <span class="n">PM</span><span class="p">:</span> <span class="n">Image</span> <span class="n">loading</span> <span class="n">progress</span><span class="p">:</span>  <span class="mi">70</span><span class="o">%</span>
<span class="p">[</span>   <span class="mf">99.811497</span><span class="p">]</span> <span class="n">PM</span><span class="p">:</span> <span class="n">Image</span> <span class="n">loading</span> <span class="n">progress</span><span class="p">:</span>  <span class="mi">80</span><span class="o">%</span>
<span class="p">[</span>  <span class="mf">104.480920</span><span class="p">]</span> <span class="n">PM</span><span class="p">:</span> <span class="n">Image</span> <span class="n">loading</span> <span class="n">progress</span><span class="p">:</span>  <span class="mi">90</span><span class="o">%</span>
<span class="hll"><span class="p">[</span>  <span class="mf">108.438452</span><span class="p">]</span> <span class="n">PM</span><span class="p">:</span> <span class="n">Image</span> <span class="n">loading</span> <span class="n">progress</span><span class="p">:</span> <span class="mi">100</span><span class="o">%</span>
</span><span class="hll"><span class="p">[</span>  <span class="mf">108.496220</span><span class="p">]</span> <span class="n">PM</span><span class="p">:</span> <span class="n">Image</span> <span class="n">loading</span> <span class="n">done</span>
</span><span class="p">[</span>  <span class="mf">108.514655</span><span class="p">]</span> <span class="n">PM</span><span class="p">:</span> <span class="n">hibernation</span><span class="p">:</span> <span class="n">Read</span> <span class="mi">16457008</span> <span class="n">kbytes</span> <span class="ow">in</span> <span class="mf">53.64</span> <span class="n">seconds</span> <span class="p">(</span><span class="mf">306.80</span> <span class="n">MB</span><span class="o">/</span><span class="n">s</span><span class="p">)</span>
<span class="p">[</span>  <span class="mf">108.555362</span><span class="p">]</span> <span class="n">printk</span><span class="p">:</span> <span class="n">Suspending</span> <span class="n">console</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="p">(</span><span class="n">use</span> <span class="n">no_console_suspend</span> <span class="n">to</span> <span class="n">debug</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>但是稍等几秒钟，出现了 <a class="reference internal" href="../server/hardware/edac.html#mce"><span class="std std-ref">MCE(Machine-Check Exception)</span></a> 错误:</p>
<div class="literal-block-wrapper docutils container" id="id20">
<div class="code-block-caption"><span class="caption-text"><code class="docutils literal notranslate"><span class="pre">hibernage</span></code> 状态恢复后立即出现 <a class="reference internal" href="../server/hardware/edac.html#mce"><span class="std std-ref">MCE(Machine-Check Exception)</span></a> 错误</span><a class="headerlink" href="#id20" title="Link to this code"></a></div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">X64</span> <span class="ne">Exception</span> <span class="n">Type</span> <span class="mi">12</span> <span class="o">-</span> <span class="n">Machine</span><span class="o">-</span><span class="n">Check</span> <span class="ne">Exception</span>
</pre></div>
</div>
</div>
<p>此时服务器自动断电，在控制台吐出如下信息:</p>
<div class="literal-block-wrapper docutils container" id="id21">
<div class="code-block-caption"><span class="caption-text"><code class="docutils literal notranslate"><span class="pre">hibernage</span></code> 恢复时出现 <a class="reference internal" href="../server/hardware/edac.html#mce"><span class="std std-ref">MCE(Machine-Check Exception)</span></a> 错误并自动断电</span><a class="headerlink" href="#id21" title="Link to this code"></a></div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span> <span class="n">HP</span> <span class="n">ProLiant</span> <span class="n">System</span> <span class="n">BIOS</span> <span class="n">P89</span> <span class="n">v2</span><span class="mf">.96</span> <span class="p">(</span><span class="mi">05</span><span class="o">/</span><span class="mi">17</span><span class="o">/</span><span class="mi">2022</span><span class="p">)</span>
<span class="p">(</span><span class="n">C</span><span class="p">)</span> <span class="n">Copyright</span> <span class="mi">1982</span> <span class="o">-</span> <span class="mi">2022</span> <span class="n">Hewlett</span> <span class="n">Packard</span> <span class="n">Enterprise</span> <span class="n">Development</span> <span class="n">LP</span>
<span class="n">Early</span> <span class="n">system</span> <span class="n">initialization</span><span class="p">,</span> <span class="n">please</span> <span class="n">wait</span><span class="o">...</span>

<span class="n">iLO</span> <span class="mi">4</span> <span class="n">IPv4</span><span class="p">:</span> <span class="mf">192.168.7.254</span>
<span class="n">iLO</span> <span class="mi">4</span> <span class="n">IPv6</span><span class="p">:</span> <span class="n">FE80</span><span class="p">::</span><span class="mi">9657</span><span class="p">:</span><span class="n">A5FF</span><span class="p">:</span><span class="n">FE5E</span><span class="p">:</span><span class="mi">7</span><span class="n">F16</span>

  <span class="mi">2</span><span class="o">%</span><span class="p">:</span> <span class="n">System</span> <span class="n">Chipset</span> <span class="n">Initialization</span>
  <span class="mi">4</span><span class="o">%</span><span class="p">:</span> <span class="n">QPI</span> <span class="n">Link</span> <span class="n">Initialization</span> <span class="o">-</span> <span class="n">Start</span>
  <span class="mi">6</span><span class="o">%</span><span class="p">:</span> <span class="n">QPI</span> <span class="n">Link</span> <span class="n">Initialization</span> <span class="o">-</span> <span class="n">Complete</span>
 <span class="n">The</span> <span class="n">server</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">powered</span> <span class="n">on</span><span class="o">.</span>  <span class="n">The</span> <span class="n">Virtual</span> <span class="n">Serial</span> <span class="n">Port</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">available</span><span class="o">.</span>
</pre></div>
</div>
</div>
<p>然后自动重启，重启时控制台输出的自检信息:</p>
<div class="literal-block-wrapper docutils container" id="id22">
<div class="code-block-caption"><span class="caption-text"><code class="docutils literal notranslate"><span class="pre">hibernage</span></code> 恢复时出现 <a class="reference internal" href="../server/hardware/edac.html#mce"><span class="std std-ref">MCE(Machine-Check Exception)</span></a> 错误并自动断电，然后自动启动时控制台显示的自检信息</span><a class="headerlink" href="#id22" title="Link to this code"></a></div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span> <span class="n">HP</span> <span class="n">ProLiant</span> <span class="n">System</span> <span class="n">BIOS</span> <span class="n">P89</span> <span class="n">v2</span><span class="mf">.96</span> <span class="p">(</span><span class="mi">05</span><span class="o">/</span><span class="mi">17</span><span class="o">/</span><span class="mi">2022</span><span class="p">)</span>
<span class="p">(</span><span class="n">C</span><span class="p">)</span> <span class="n">Copyright</span> <span class="mi">1982</span> <span class="o">-</span> <span class="mi">2022</span> <span class="n">Hewlett</span> <span class="n">Packard</span> <span class="n">Enterprise</span> <span class="n">Development</span> <span class="n">LP</span>
<span class="n">Early</span> <span class="n">system</span> <span class="n">initialization</span><span class="p">,</span> <span class="n">please</span> <span class="n">wait</span><span class="o">...</span>

<span class="n">iLO</span> <span class="mi">4</span> <span class="n">IPv4</span><span class="p">:</span> <span class="mf">192.168.7.254</span>
<span class="n">iLO</span> <span class="mi">4</span> <span class="n">IPv6</span><span class="p">:</span> <span class="n">FE80</span><span class="p">::</span><span class="mi">9657</span><span class="p">:</span><span class="n">A5FF</span><span class="p">:</span><span class="n">FE5E</span><span class="p">:</span><span class="mi">7</span><span class="n">F16</span>

  <span class="mi">2</span><span class="o">%</span><span class="p">:</span> <span class="n">System</span> <span class="n">Chipset</span> <span class="n">Initialization</span>
  <span class="mi">4</span><span class="o">%</span><span class="p">:</span> <span class="n">QPI</span> <span class="n">Link</span> <span class="n">Initialization</span> <span class="o">-</span> <span class="n">Start</span>
  <span class="mi">6</span><span class="o">%</span><span class="p">:</span> <span class="n">QPI</span> <span class="n">Link</span> <span class="n">Initialization</span> <span class="o">-</span> <span class="n">Complete</span>
  <span class="mi">9</span><span class="o">%</span><span class="p">:</span> <span class="n">Early</span> <span class="n">Processor</span> <span class="n">Initialization</span>
 <span class="mi">11</span><span class="o">%</span><span class="p">:</span> <span class="n">Memory</span> <span class="n">Initialization</span> <span class="o">-</span> <span class="n">Start</span>
 <span class="mi">24</span><span class="o">%</span><span class="p">:</span> <span class="n">Memory</span> <span class="n">Initialization</span> <span class="o">-</span> <span class="n">Complete</span>

 <span class="mi">27</span><span class="o">%</span><span class="p">:</span> <span class="n">System</span> <span class="n">Security</span> <span class="n">Initialization</span>
 <span class="mi">30</span><span class="o">%</span><span class="p">:</span> <span class="n">HPE</span> <span class="n">SmartMemory</span> <span class="n">Initialization</span>
 <span class="mi">39</span><span class="o">%</span><span class="p">:</span> <span class="n">Loading</span> <span class="n">System</span> <span class="n">Firmware</span> <span class="n">Modules</span> <span class="o">-</span> <span class="n">Start</span>
</pre></div>
</div>
</div>
<p>虽然在 <code class="docutils literal notranslate"><span class="pre">dmesg</span> <span class="pre">-T</span></code> 系统日志中看不到出错信息，也没有在 <a class="reference internal" href="../server/hardware/edac.html#edac"><span class="std std-ref">EDAC 诊断系统硬件故障</span></a> 状态中看出端倪，不过从 <a class="reference internal" href="../server/hardware/hpe/hpe_dl360_gen9.html#hpe-dl360-gen9"><span class="std std-ref">HPE ProLiant DL360 Gen9服务器</span></a> 的 <a class="reference internal" href="../server/hardware/hpe/hp_ilo/index.html#hp-ilo"><span class="std std-ref">HP服务器iLO技术</span></a> WEB控制平台检查 <code class="docutils literal notranslate"><span class="pre">Integrated</span> <span class="pre">Management</span> <span class="pre">Log</span></code> 可以看到如下MCE错误记录:</p>
<table class="docutils align-default" id="id23">
<caption><span class="caption-text">服务器 <code class="docutils literal notranslate"><span class="pre">Integrated</span> <span class="pre">Management</span> <span class="pre">Log</span></code> 中MCE错误记录</span><a class="headerlink" href="#id23" title="Link to this table"></a></caption>
<colgroup>
<col style="width: 10.0%" />
<col style="width: 10.0%" />
<col style="width: 10.0%" />
<col style="width: 10.0%" />
<col style="width: 10.0%" />
<col style="width: 50.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>ID</p></th>
<th class="head"><p>Severity</p></th>
<th class="head"><p>Class</p></th>
<th class="head"><p>Last Update</p></th>
<th class="head"><p>Count</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>300</p></td>
<td><p>Critical</p></td>
<td><p>CPU</p></td>
<td><p>12/19/2024 12:04</p></td>
<td><p>1</p></td>
<td><p>Uncorrectable Machine Check Exception (Board 0, Processor 1, APIC ID 0x00000000, Bank 0x00000012, Status 0xBE200000'000C110A, Address 0x00000000'80210000, Misc 0xB8FC3816'00402086)</p></td>
</tr>
<tr class="row-odd"><td><p>299</p></td>
<td><p>Critical</p></td>
<td><p>PCI Bus</p></td>
<td><p>12/19/2024 12:02</p></td>
<td><p>1</p></td>
<td><p>PCI Bus Error (Slot 0, Bus 0, Device 0, Function 0)</p></td>
</tr>
</tbody>
</table>
<p>昨天和前天的 hibernate 也同样有错误</p>
<table class="docutils align-default" id="id24">
<caption><span class="caption-text">服务器 <code class="docutils literal notranslate"><span class="pre">Integrated</span> <span class="pre">Management</span> <span class="pre">Log</span></code> 中 <strong>昨天</strong> MCE错误记录</span><a class="headerlink" href="#id24" title="Link to this table"></a></caption>
<colgroup>
<col style="width: 10.0%" />
<col style="width: 10.0%" />
<col style="width: 10.0%" />
<col style="width: 10.0%" />
<col style="width: 10.0%" />
<col style="width: 50.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>ID</p></th>
<th class="head"><p>Severity</p></th>
<th class="head"><p>Class</p></th>
<th class="head"><p>Last Update</p></th>
<th class="head"><p>Count</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>298</p></td>
<td><p>Critical</p></td>
<td><p>CPU</p></td>
<td><p>12/18/2024 13:56</p></td>
<td><p>1</p></td>
<td><p>Uncorrectable Machine Check Exception (Board 0, Processor 1, APIC ID 0x00000002, Bank 0x00000012, Status 0xBE200000'000C110A, Address 0x00000000'80210000, Misc 0xB8FC3816'00402086)</p></td>
</tr>
<tr class="row-odd"><td><p>297</p></td>
<td><p>Critical</p></td>
<td><p>CPU</p></td>
<td><p>12/18/2024 13:56</p></td>
<td><p>1</p></td>
<td><p>Uncorrectable Machine Check Exception (Board 0, Processor 1, APIC ID 0x00000002, Bank 0x00000000, Status 0xBD800000'00000006, Address 0x00000000'00000000, Misc 0x000007FA'9A729000)</p></td>
</tr>
<tr class="row-even"><td><p>296</p></td>
<td><p>Critical</p></td>
<td><p>PCI Bus</p></td>
<td><p>12/18/2024 13:54</p></td>
<td><p>1</p></td>
<td><p>PCI Bus Error (Slot 0, Bus 0, Device 0, Function 0)</p></td>
</tr>
</tbody>
</table>
<table class="docutils align-default" id="id25">
<caption><span class="caption-text">服务器 <code class="docutils literal notranslate"><span class="pre">Integrated</span> <span class="pre">Management</span> <span class="pre">Log</span></code> 中 <strong>前天</strong> MCE错误记录</span><a class="headerlink" href="#id25" title="Link to this table"></a></caption>
<colgroup>
<col style="width: 10.0%" />
<col style="width: 10.0%" />
<col style="width: 10.0%" />
<col style="width: 10.0%" />
<col style="width: 10.0%" />
<col style="width: 50.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>ID</p></th>
<th class="head"><p>Severity</p></th>
<th class="head"><p>Class</p></th>
<th class="head"><p>Last Update</p></th>
<th class="head"><p>Count</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>295</p></td>
<td><p>Critical</p></td>
<td><p>CPU</p></td>
<td><p>12/17/2024 10:35</p></td>
<td><p>1</p></td>
<td><p>Uncorrectable Machine Check Exception (Board 0, Processor 2, APIC ID 0x00000020, Bank 0x00000000, Status 0xBD800000'00000006, Address 0x00000000'00000000, Misc 0x000007FA'9A729000)</p></td>
</tr>
<tr class="row-odd"><td><p>294</p></td>
<td><p>Critical</p></td>
<td><p>CPU</p></td>
<td><p>12/17/2024 10:35</p></td>
<td><p>1</p></td>
<td><p>Uncorrectable Machine Check Exception (Board 0, Processor 1, APIC ID 0x00000000, Bank 0x00000012, Status 0xBE200000'000C110A, Address 0x00000000'80210000, Misc 0xB8FC3816'00402086)</p></td>
</tr>
<tr class="row-even"><td><p>293</p></td>
<td><p>Critical</p></td>
<td><p>PCI Bus</p></td>
<td><p>12/17/2024 10:33</p></td>
<td><p>1</p></td>
<td><p>PCI Bus Error (Slot 0, Bus 0, Device 0, Function 0)</p></td>
</tr>
<tr class="row-odd"><td><p>292</p></td>
<td><p>Critical</p></td>
<td><p>CPU</p></td>
<td><p>12/17/2024 09:50</p></td>
<td><p>1</p></td>
<td><p>Uncorrectable Machine Check Exception (Board 0, Processor 1, APIC ID 0x00000006, Bank 0x00000012, Status 0xBE200000'000C110A, Address 0x00000000'80210000, Misc 0xB8FC3816'00402086)</p></td>
</tr>
<tr class="row-even"><td><p>291</p></td>
<td><p>Critical</p></td>
<td><p>CPU</p></td>
<td><p>12/17/2024 09:50</p></td>
<td><p>1</p></td>
<td><p>Uncorrectable Machine Check Exception (Board 0, Processor 1, APIC ID 0x00000006, Bank 0x00000000, Status 0xBD800000'00000006, Address 0x00000000'00000000, Misc 0x000007FA'9A729000)</p></td>
</tr>
<tr class="row-odd"><td><p>290</p></td>
<td><p>Critical</p></td>
<td><p>PCI Bus</p></td>
<td><p>12/17/2024 09:48</p></td>
<td><p>1</p></td>
<td><p>PCI Bus Error (Slot 0, Bus 0, Device 0, Function 0)</p></td>
</tr>
</tbody>
</table>
<p>之前在 <a class="reference internal" href="../server/hardware/hpe/dl360_gen9_pci_bus_error.html#dl360-gen9-pci-bus-error"><span class="std std-ref">HPE DL360 Gen9服务器PCI Bus Error</span></a> 也有PCIe错误，当时通过插拔内存似乎恢复了。</p>
<p>我google一下， <a class="reference external" href="https://community.hpe.com/t5/proliant-servers-ml-dl-sl/uncorrectable-machine-check-exception/td-p/7008326">HP支持论坛的Uncorrectable Machine Check Exception一个帖子提到的情况</a> 启发了我:</p>
<ul class="simple">
<li><p>看起来PCIe错误导致的MCE，而PCIe错误关联的处理器有 Processor 1 也有 Processor 2(两个处理器同时硬件故障可能性极低)</p></li>
<li><p>感觉时PCIe上连接的设备触发的问题，在 <code class="docutils literal notranslate"><span class="pre">hibernate</span></code> 恢复时响应出现了问题导致主机判断为MCE错误</p></li>
<li><p>怀疑 <a class="reference internal" href="../storage/nvme/intel_optane_m10.html#intel-optane-m10"><span class="std std-ref">Intel Optane(傲腾) M10</span></a> 最近添加在PCIe转接卡上，这个设备初始化非常诡异，之前有无法识别的问题，可能会在 <code class="docutils literal notranslate"><span class="pre">hibernate</span></code> 恢复时无法恢复到休眠前状态，导致触发 <a class="reference internal" href="../server/hardware/edac.html#mce"><span class="std std-ref">MCE(Machine-Check Exception)</span></a> 错误</p></li>
</ul>
<p>虽然可以通过硬件替换，逐个排除PCIe上设备是否和 <code class="docutils literal notranslate"><span class="pre">hibernate</span></code> 时 <a class="reference internal" href="../server/hardware/edac.html#mce"><span class="std std-ref">MCE(Machine-Check Exception)</span></a> 错误有关，但是我现在暂时没有时间继续折腾。目前看平时运行时是稳定的，只在 <code class="docutils literal notranslate"><span class="pre">hibernate</span></code> 恢复时触发异常，待后续观察或者有时间再排查。</p>
</section>
<section id="id4">
<h2>参考<a class="headerlink" href="#id4" title="Link to this heading"></a></h2>
<ul class="simple">
<li><p><a class="reference external" href="https://wiki.archlinux.org/index.php/Power_management/Suspend_and_hibernate">archlinux wiki:Power management/Suspend and hibernate</a></p></li>
<li><p><a class="reference external" href="https://www.linuxuprising.com/2021/08/how-to-enable-hibernation-on-ubuntu.html">How To Enable Hibernation On Ubuntu (When Using A Swap File)</a></p></li>
</ul>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="页脚">
        <a href="upgrade_ubuntu.html" class="btn btn-neutral float-left" title="升级Ubuntu" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> 上一页</a>
        <a href="ubuntu_hibernate_old.html" class="btn btn-neutral float-right" title="Ubuntu Hibernate休眠(旧实践归档)" accesskey="n" rel="next">下一页 <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; <a href="../../copyright.html">版权所有</a> 2018 - now, Huatai Huang。</p>
  </div>

  利用 <a href="https://www.sphinx-doc.org/">Sphinx</a> 构建，使用的 
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">主题</a>
    由 <a href="https://readthedocs.org">Read the Docs</a> 开发.
  
    <!-- your html code here -->
    <br>
    <p><a href="https://github.com/huataihuang/cloud-atlas/issues">留言和讨论</a>|<a href="https://github.com/huataihuang/cloud-atlas/blob/master/source/donate.rst">请我喝一杯咖啡 👈</a></p>
    <br>
    <p>网站采用 <a href="https://utteranc.es/">utterances</a> 评论系统，所有评论存储在<a href="https://github.com/huataihuang/cloud-atlas/issues">GitHub issues</a> 中，如果你看不到下方的评论框，那么可能需要<a href="https://cloud-atlas.readthedocs.io/zh-cn/latest/linux/security/vpn/index.html">自备梯子</a> 👈</p>
    <div class="articleComments">
        <comments>
  <script src="https://utteranc.es/client.js"
    repo="huataihuang/cloud-atlas"
    issue-term="pathname"
    theme="github-light"
    crossorigin="anonymous"
    async>
  </script>
</comments>
    </div>


</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>