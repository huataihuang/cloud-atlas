<!DOCTYPE html>
<html class="writer-html5" lang="zh" data-content_root="../../../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>升级Ubuntu 20.04 LTS到22.04 LTS &mdash; Cloud Atlas: Discovery beta 文档</title>
      <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="../../../_static/css/theme.css?v=19f00094" />
      <link rel="stylesheet" type="text/css" href="../../../_static/graphviz.css?v=fd3f3429" />

  
    <link rel="shortcut icon" href="../../../_static/favicon.png"/>
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../../../_static/jquery.js?v=5d32c60e"></script>
        <script src="../../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../../../_static/documentation_options.js?v=8534f863"></script>
        <script src="../../../_static/doctools.js?v=9a2dae69"></script>
        <script src="../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="索引" href="../../../genindex.html" />
    <link rel="search" title="搜索" href="../../../search.html" />
    <link rel="copyright" title="版权所有" href="../../../copyright.html" />
    <link rel="next" title="Ubuntu修订Grub内核启动参数" href="ubuntu_grub.html" />
    <link rel="prev" title="Ubuntu无人值守升级" href="ubuntu_unattended_upgrade.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../../index.html" class="icon icon-home">
            Cloud Atlas: Discovery
          </a>
              <div class="version">
                1.1
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="搜索文档" aria-label="搜索文档" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="导航菜单">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../studio/index.html">Studio</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../infrastructure/index.html">Infrastructure</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../devops/index.html">DevOps</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../kvm/index.html">KVM</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../ceph/index.html">Ceph</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../gluster/index.html">Gluster</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../ovirt/index.html">oVirt</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../openstack/index.html">OpenStack</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../docker/index.html">Docker</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../kubernetes/index.html">Kubernetes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../k8s_dev/index.html">Kubernetes Develop</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../rancher/index.html">Rancher</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../openshift/index.html">OpenShift</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../sql/index.html">SQL</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../sqlite/index.html">SQLite</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../mysql/index.html">MySQL</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../pgsql/index.html">PostgreSQL</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../nosql/index.html">NoSQL</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../network/index.html">Network</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../infra_service/index.html">Infra-Service</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../infra_search/index.html">Infra-Search</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../web/index.html">Web</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../info_service/index.html">Info-Service</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../big_data/index.html">Big Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../machine_learning/index.html">Machine Learning</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../drone/index.html">Drone</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../index.html">Linux</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../best_linux.html">最佳Linux</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../admin/index.html">Linux系统管理</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../redhat_linux/index.html">RedHat Linux</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../arch_linux/index.html">Arch Linux</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../asahi_linux/index.html">Asahi Linux</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../gentoo_linux/index.html">Gentoo Linux</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../lfs/index.html">LFS(Linux from scratch)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../blfs/index.html">BLFS(Beyond Linux from scratch)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../alfs/index.html">ALFS(Automated Linux from scratch)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../pilfs/index.html">PiLFS(Automated Linux from scratch on the Raspberry Pi)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../yocto/index.html">Yocto</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../debian/index.html">Debian</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../index.html">Ubuntu Linux</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../ubuntu_on_mbp.html">MacBook Pro上运行Ubuntu</a></li>
<li class="toctree-l3"><a class="reference internal" href="../ubuntu_on_thinkpad_x220.html">ThinkPad X220上运行Ubuntu</a></li>
<li class="toctree-l3"><a class="reference internal" href="../ubuntu_server.html">Ubuntu Server</a></li>
<li class="toctree-l3"><a class="reference internal" href="../ubuntu_server_init.html">Ubuntu服务器初始化</a></li>
<li class="toctree-l3"><a class="reference internal" href="../ubuntu_desktop.html">Ubuntu Desktop</a></li>
<li class="toctree-l3"><a class="reference internal" href="../upgrade_ubuntu.html">升级Ubuntu</a></li>
<li class="toctree-l3"><a class="reference internal" href="../ubuntu_hibernate.html">Ubuntu Hibernate休眠</a></li>
<li class="toctree-l3"><a class="reference internal" href="../ubuntu_hibernate_old.html">Ubuntu Hibernate休眠(旧实践归档)</a></li>
<li class="toctree-l3 current"><a class="reference internal" href="index.html">Ubuntu系统管理</a><ul class="current">
<li class="toctree-l4"><a class="reference internal" href="apt.html">APT包管理</a></li>
<li class="toctree-l4"><a class="reference internal" href="alien.html">alien软件包转换工具</a></li>
<li class="toctree-l4"><a class="reference internal" href="snap.html">snap软件包管理</a></li>
<li class="toctree-l4"><a class="reference internal" href="disable_snap.html">在Ubuntu 20.04中禁用Snaps</a></li>
<li class="toctree-l4"><a class="reference internal" href="debootstrap.html">debootstrap</a></li>
<li class="toctree-l4"><a class="reference internal" href="ufw.html">ufw防火墙服务</a></li>
<li class="toctree-l4"><a class="reference internal" href="tar_multi_boot_ubuntu.html">tar包手工安装多重启动的ubuntu</a></li>
<li class="toctree-l4"><a class="reference internal" href="recover_system_by_tar.html">通过tar备份和恢复Linux系统</a></li>
<li class="toctree-l4"><a class="reference internal" href="ubuntu_unattended_upgrade.html">Ubuntu无人值守升级</a></li>
<li class="toctree-l4 current"><a class="current reference internal" href="#">升级Ubuntu 20.04 LTS到22.04 LTS</a></li>
<li class="toctree-l4"><a class="reference internal" href="ubuntu_grub.html">Ubuntu修订Grub内核启动参数</a></li>
<li class="toctree-l4"><a class="reference internal" href="ubuntu_serial_console.html">Ubuntu 串口控制台</a></li>
<li class="toctree-l4"><a class="reference internal" href="run_centos_in_chroot_under_ubuntu.html">在Ubuntu中构建chroot环境运行CentOS</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../cgroup/index.html">Ubuntu Cgroup</a></li>
<li class="toctree-l3"><a class="reference internal" href="../network/index.html">Ubuntu网络</a></li>
<li class="toctree-l3"><a class="reference internal" href="../storage/index.html">Ubuntu存储管理</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../suse_linux/index.html">SUSE Linux</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../kali_linux/index.html">Kali Linux</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../tails_linux/index.html">Tails Linux</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../qubes_os/index.html">Qubes OS</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../postmarketos/index.html">postmarketOS</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../container_os/index.html">容器化操作系统(Container OS)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../fedora_coreos/index.html">Fedora CoreOS容器操作系统</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../chromeos/index.html">ChromeOS</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../alpine_linux/index.html">Alpine Linux</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../subgraph_os/index.html">Subgraph OS</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../kaios/index.html">KaiOS - 世界第三手机操作系统</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../compute/index.html">Linux计算</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../storage/index.html">Linux存储</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../network/index.html">Linux网络</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../server/index.html">Linux服务器</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../security/index.html">Linux安全</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../desktop/index.html">Linux桌面</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../linux_tablet/index.html">Linux平板</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../kernel/index.html">Kernel</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../performance/index.html">Performance</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../distributed_system/index.html">Distributed System</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../shell/index.html">Shell</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../python/index.html">Python</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../django/index.html">Django</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../javascript/index.html">JavaScript</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../nodejs/index.html">Node.js</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../clang/index.html">C</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../golang/index.html">Go</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../swift/index.html">Swift</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../rust/index.html">Rust</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../ruby/index.html">Ruby</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../lua/index.html">Lua</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../arm/index.html">ARM</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../raspberry_pi/index.html">Raspberry Pi</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../android/index.html">Android</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../bsd/index.html">BSD</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../freebsd/index.html">FreeBSD</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../apple/index.html">Apple</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../windows/index.html">Windows</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../real/index.html">Real</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../management/index.html">Management</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../life/index.html">Life</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../copyright.html">Copyright</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../aboutme.html">关于作者</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../donate.html">捐赠</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../thanks.html">感谢</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../roadmap.html">Roadmap</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../appendix/index.html">附录</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="移动版导航菜单" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">Cloud Atlas: Discovery</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="页面导航">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../index.html">Linux</a></li>
          <li class="breadcrumb-item"><a href="../index.html">Ubuntu Linux</a></li>
          <li class="breadcrumb-item"><a href="index.html">Ubuntu系统管理</a></li>
      <li class="breadcrumb-item active">升级Ubuntu 20.04 LTS到22.04 LTS</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../../_sources/linux/ubuntu_linux/admin/upgrade_ubuntu_20.04_to_22.04.rst.txt" rel="nofollow"> 查看页面源码</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="ubuntu-20-04-lts22-04-lts">
<span id="upgrade-ubuntu-20-04-to-22-04"></span><h1>升级Ubuntu 20.04 LTS到22.04 LTS<a class="headerlink" href="#ubuntu-20-04-lts22-04-lts" title="Link to this heading"></a></h1>
<p>按照 <a class="reference external" href="https://ubuntu.com/about/release-cycle#ubuntu">Ubuntu发布周期</a> 每2年会发布一个 &quot;长期支持版&quot; (LTS, Long Term Support)。具体来说，就是每2年的4月份会发布一个支持周期长达5年的稳定版本，如: 20.04 和 22.04 分别代表 2020年4月 和 2022年4月 发布的长期支持版本.</p>
<figure class="align-default">
<a class="reference internal image-reference" href="../../../_images/ubuntu_release_cycle.png"><img alt="../../../_images/ubuntu_release_cycle.png" src="../../../_images/ubuntu_release_cycle.png" style="width: 583.0999999999999px; height: 290.5px;" /></a>
</figure>
<p>当前(2022年9月)，Ubuntu 22.04 LTS发布已经将近半年，我准备将 <a class="reference internal" href="../../../real/priv_cloud/priv_cloud_infra.html#priv-cloud-infra"><span class="std std-ref">私有云架构</span></a> 的 <a class="reference internal" href="../../server/hardware/hpe/hpe_dl360_gen9.html#hpe-dl360-gen9"><span class="std std-ref">HPE ProLiant DL360 Gen9服务器</span></a> 底层操作系统Ubuntu Linux升级到最新长期稳定版本。</p>
<p>由于Ubuntu跨版本升级可能需要较多的磁盘空间，而我在构建 <a class="reference internal" href="../../../real/priv_cloud/priv_cloud_infra.html#priv-cloud-infra"><span class="std std-ref">私有云架构</span></a> 时为了能够尽可能将存储空间保留给 <a class="reference internal" href="../../../docker/storage/docker_btrfs_driver.html#docker-btrfs-driver"><span class="std std-ref">Docker btrfs 存储驱动</span></a> ，操作系统的根目录磁盘空间只有 32G (日常运行只有3G空闲)，所以首先需要在虚拟机环境模拟升级，充分验证升级可行性。</p>
<div class="admonition note">
<p class="admonition-title">备注</p>
<p>实际磁盘空间分配可以采用 <a class="reference internal" href="../../../shell/bash/trace_disk_space_usage.html#trace-disk-space-usage"><span class="std std-ref">排查磁盘空间消耗</span></a> 进行分析，我通过这种方法将系统中占用大量磁盘的数据文件全部迁移到独立挂载磁盘分区的 <a class="reference internal" href="../../storage/btrfs/index.html#btrfs"><span class="std std-ref">Btrfs</span></a> 卷中，最终可以将日常根目录10G以下(空闲22G)。</p>
<p>之前在 <a class="reference internal" href="../upgrade_ubuntu.html#upgrade-ubuntu"><span class="std std-ref">升级Ubuntu</span></a> 是非稳定版本升级，本次实践则完整记录LTS稳定版本升级。</p>
</div>
<section id="id1">
<h2>升级系统包<a class="headerlink" href="#id1" title="Link to this heading"></a></h2>
<ul>
<li><p>在进行大版本升级之前，首先要将当前版本升级到最新:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">apt</span> <span class="n">update</span> <span class="o">&amp;&amp;</span> <span class="n">sudo</span> <span class="n">apt</span> <span class="n">upgrade</span> <span class="o">-</span><span class="n">y</span>
</pre></div>
</div>
</li>
<li><p>清理无用包:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">apt</span> <span class="n">autoremove</span> <span class="o">-</span><span class="n">y</span>
</pre></div>
</div>
</li>
<li><p>重启系统:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">reboot</span>
</pre></div>
</div>
</li>
</ul>
</section>
<section id="ssh">
<h2>准备后备SSH端口<a class="headerlink" href="#ssh" title="Link to this heading"></a></h2>
<p>如果使用ssh登录到服务器上进行版本升级，升级过程中ssh网络链接会断开。Ubuntu升级工具会在默认SSH端口22断开连接时提供一个fallback端口 <code class="docutils literal notranslate"><span class="pre">1022</span></code> 。但是需要注意，如果使用了Ubuntu的防火墙 <a class="reference internal" href="ufw.html#ufw"><span class="std std-ref">ufw防火墙服务</span></a> 则需要先允许该端口访问:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">ufw</span> <span class="n">allow</span> <span class="mi">1022</span><span class="o">/</span><span class="n">tcp</span>
<span class="n">sudo</span> <span class="n">ufw</span> <span class="n">reload</span>
</pre></div>
</div>
<p>并检查端口打开情况:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">ufw</span> <span class="n">status</span>
</pre></div>
</div>
</section>
<section id="id2">
<h2>升级<a class="headerlink" href="#id2" title="Link to this heading"></a></h2>
<ul>
<li><p>首先安装版本升级工具 <code class="docutils literal notranslate"><span class="pre">do-release-upgrade</span></code></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">apt</span> <span class="n">install</span> <span class="n">update</span><span class="o">-</span><span class="n">manager</span><span class="o">-</span><span class="n">core</span>
</pre></div>
</div>
</li>
<li><p>执行以下命令开始升级:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">do</span><span class="o">-</span><span class="n">release</span><span class="o">-</span><span class="n">upgrade</span> <span class="o">-</span><span class="n">d</span>
</pre></div>
</div>
</li>
</ul>
<p>提示信息:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>Reading cache

Checking package manager

Continue running under SSH?

This session appears to be running under ssh. It is not recommended
to perform a upgrade over ssh currently because in case of failure it
is harder to recover.

If you continue, an additional ssh daemon will be started at port
&#39;1022&#39;.
Do you want to continue?

Continue [yN]
</pre></div>
</div>
<p>可以看到不推荐通过SSH升级: 当然，对于我所使用的 <a class="reference internal" href="../../server/hardware/hpe/hpe_dl360_gen9.html#hpe-dl360-gen9"><span class="std std-ref">HPE ProLiant DL360 Gen9服务器</span></a> 实际上可以通过 <a class="reference internal" href="../../server/hardware/hpe/hp_ilo/index.html#hp-ilo"><span class="std std-ref">HP服务器iLO技术</span></a> 的控制台进行升级，这样更为保险。</p>
<ul class="simple">
<li><p>由于这里案例采用SSH方式访问服务器进行升级，所以按照提示输入 <code class="docutils literal notranslate"><span class="pre">y</span></code> 继续</p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">备注</p>
<p><code class="docutils literal notranslate"><span class="pre">do-release-upgrade</span></code> 实际上启动了一个 <code class="docutils literal notranslate"><span class="pre">screen</span></code> 工具来保证网络断开时不影响升级过程。</p>
</div>
<p>此时提示:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Starting</span> <span class="n">additional</span> <span class="n">sshd</span>

<span class="n">To</span> <span class="n">make</span> <span class="n">recovery</span> <span class="ow">in</span> <span class="n">case</span> <span class="n">of</span> <span class="n">failure</span> <span class="n">easier</span><span class="p">,</span> <span class="n">an</span> <span class="n">additional</span> <span class="n">sshd</span> <span class="n">will</span>
<span class="n">be</span> <span class="n">started</span> <span class="n">on</span> <span class="n">port</span> <span class="s1">&#39;1022&#39;</span><span class="o">.</span> <span class="n">If</span> <span class="n">anything</span> <span class="n">goes</span> <span class="n">wrong</span> <span class="k">with</span> <span class="n">the</span> <span class="n">running</span>
<span class="n">ssh</span> <span class="n">you</span> <span class="n">can</span> <span class="n">still</span> <span class="n">connect</span> <span class="n">to</span> <span class="n">the</span> <span class="n">additional</span> <span class="n">one</span><span class="o">.</span>
<span class="n">If</span> <span class="n">you</span> <span class="n">run</span> <span class="n">a</span> <span class="n">firewall</span><span class="p">,</span> <span class="n">you</span> <span class="n">may</span> <span class="n">need</span> <span class="n">to</span> <span class="n">temporarily</span> <span class="nb">open</span> <span class="n">this</span> <span class="n">port</span><span class="o">.</span> <span class="n">As</span>
<span class="n">this</span> <span class="ow">is</span> <span class="n">potentially</span> <span class="n">dangerous</span> <span class="n">it</span><span class="s1">&#39;s not done automatically. You can</span>
<span class="nb">open</span> <span class="n">the</span> <span class="n">port</span> <span class="k">with</span> <span class="n">e</span><span class="o">.</span><span class="n">g</span><span class="o">.</span><span class="p">:</span>
<span class="s1">&#39;iptables -I INPUT -p tcp --dport 1022 -j ACCEPT&#39;</span>

<span class="n">To</span> <span class="k">continue</span> <span class="n">please</span> <span class="n">press</span> <span class="p">[</span><span class="n">ENTER</span><span class="p">]</span>
</pre></div>
</div>
<ul>
<li><p>按下回车继续</p></li>
<li><p>提示信息显示会禁止第三方软件仓库:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Reading</span> <span class="n">package</span> <span class="n">lists</span><span class="o">...</span> <span class="n">Done</span>
<span class="n">Building</span> <span class="n">dependency</span> <span class="n">tree</span>
<span class="n">Reading</span> <span class="n">state</span> <span class="n">information</span><span class="o">...</span> <span class="n">Done</span>
<span class="n">Hit</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">archive</span><span class="o">.</span><span class="n">ubuntu</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">ubuntu</span> <span class="n">focal</span> <span class="n">InRelease</span>
<span class="n">Get</span><span class="p">:</span><span class="mi">1</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">archive</span><span class="o">.</span><span class="n">ubuntu</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">ubuntu</span> <span class="n">focal</span><span class="o">-</span><span class="n">updates</span> <span class="n">InRelease</span> <span class="p">[</span><span class="mi">114</span> <span class="n">kB</span><span class="p">]</span>
<span class="n">Get</span><span class="p">:</span><span class="mi">2</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">archive</span><span class="o">.</span><span class="n">ubuntu</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">ubuntu</span> <span class="n">focal</span><span class="o">-</span><span class="n">backports</span> <span class="n">InRelease</span> <span class="p">[</span><span class="mi">108</span> <span class="n">kB</span><span class="p">]</span>
<span class="n">Get</span><span class="p">:</span><span class="mi">3</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">archive</span><span class="o">.</span><span class="n">ubuntu</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">ubuntu</span> <span class="n">focal</span><span class="o">-</span><span class="n">security</span> <span class="n">InRelease</span> <span class="p">[</span><span class="mi">114</span> <span class="n">kB</span><span class="p">]</span>
<span class="n">Get</span><span class="p">:</span><span class="mi">4</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">archive</span><span class="o">.</span><span class="n">ubuntu</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">ubuntu</span> <span class="n">focal</span><span class="o">-</span><span class="n">security</span><span class="o">/</span><span class="n">universe</span> <span class="n">amd64</span> <span class="n">Packages</span> <span class="p">[</span><span class="mi">729</span> <span class="n">kB</span><span class="p">]</span>
<span class="n">Ign</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">downloads</span><span class="o">.</span><span class="n">linux</span><span class="o">.</span><span class="n">hpe</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">SDR</span><span class="o">/</span><span class="n">repo</span><span class="o">/</span><span class="n">mcp</span> <span class="n">bionic</span><span class="o">/</span><span class="n">current</span><span class="o">-</span><span class="n">gen9</span> <span class="n">InRelease</span>
<span class="n">Hit</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">downloads</span><span class="o">.</span><span class="n">linux</span><span class="o">.</span><span class="n">hpe</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">SDR</span><span class="o">/</span><span class="n">repo</span><span class="o">/</span><span class="n">mcp</span> <span class="n">bionic</span><span class="o">/</span><span class="n">current</span><span class="o">-</span><span class="n">gen9</span> <span class="n">Release</span>
<span class="n">Get</span><span class="p">:</span><span class="mi">5</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">archive</span><span class="o">.</span><span class="n">ubuntu</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">ubuntu</span> <span class="n">focal</span><span class="o">-</span><span class="n">security</span><span class="o">/</span><span class="n">universe</span> <span class="n">Translation</span><span class="o">-</span><span class="n">en</span> <span class="p">[</span><span class="mi">135</span> <span class="n">kB</span><span class="p">]</span>
<span class="n">Get</span><span class="p">:</span><span class="mi">6</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">archive</span><span class="o">.</span><span class="n">ubuntu</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">ubuntu</span> <span class="n">focal</span><span class="o">-</span><span class="n">security</span><span class="o">/</span><span class="n">universe</span> <span class="n">amd64</span> <span class="n">c</span><span class="o">-</span><span class="n">n</span><span class="o">-</span><span class="n">f</span> <span class="n">Metadata</span> <span class="p">[</span><span class="mf">15.1</span> <span class="n">kB</span><span class="p">]</span>
<span class="n">Fetched</span> <span class="mi">1</span><span class="p">,</span><span class="mi">215</span> <span class="n">kB</span> <span class="ow">in</span> <span class="mi">6</span><span class="n">s</span> <span class="p">(</span><span class="mi">103</span> <span class="n">kB</span><span class="o">/</span><span class="n">s</span><span class="p">)</span>
<span class="n">Reading</span> <span class="n">package</span> <span class="n">lists</span><span class="o">...</span> <span class="n">Done</span>
<span class="n">Building</span> <span class="n">dependency</span> <span class="n">tree</span>
<span class="n">Reading</span> <span class="n">state</span> <span class="n">information</span><span class="o">...</span> <span class="n">Done</span>

<span class="n">Updating</span> <span class="n">repository</span> <span class="n">information</span>

<span class="n">Third</span> <span class="n">party</span> <span class="n">sources</span> <span class="n">disabled</span>

<span class="n">Some</span> <span class="n">third</span> <span class="n">party</span> <span class="n">entries</span> <span class="ow">in</span> <span class="n">your</span> <span class="n">sources</span><span class="o">.</span><span class="n">list</span> <span class="n">were</span> <span class="n">disabled</span><span class="o">.</span> <span class="n">You</span> <span class="n">can</span>
<span class="n">re</span><span class="o">-</span><span class="n">enable</span> <span class="n">them</span> <span class="n">after</span> <span class="n">the</span> <span class="n">upgrade</span> <span class="k">with</span> <span class="n">the</span> <span class="s1">&#39;software-properties&#39;</span> <span class="n">tool</span>
<span class="ow">or</span> <span class="n">your</span> <span class="n">package</span> <span class="n">manager</span><span class="o">.</span>

<span class="n">To</span> <span class="k">continue</span> <span class="n">please</span> <span class="n">press</span> <span class="p">[</span><span class="n">ENTER</span><span class="p">]</span>
</pre></div>
</div>
</li>
<li><p>继续回车</p></li>
</ul>
<p>此时会下载仓库软件索引信息</p>
<p>然后提示信息:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>Do you want to start the upgrade?


12 packages are going to be removed. 187 new packages are going to be
installed. 1015 packages are going to be upgraded.

You have to download a total of 998 M. This download will take about
6 hours with your connection.

Installing the upgrade can take several hours. Once the download has
finished, the process cannot be canceled.

 Continue [yN]  Details [d]
</pre></div>
</div>
<p>输入 <code class="docutils literal notranslate"><span class="pre">y</span></code> 继续</p>
<ul>
<li><p>升级安装包过程非常顺滑，安装过程会提示一些服务会重启，在这里选择 <code class="docutils literal notranslate"><span class="pre">Yes</span></code> 避免重复提示:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>There are services installed on your system which need to be restarted when certain libraries,
such as libpam, libc, and libssl, are upgraded. Since these restarts may cause interruptions of service for the system,
you will normally be prompted on each upgrade for the list of services you wish to restart.
You can choose this option to avoid being prompted;
instead, all necessary restarts will be done for you automatically so you can avoid being asked questions on each library upgrade.

Restart services during package upgrades without asking?
</pre></div>
</div>
</li>
<li><p>在安装过程中会提示修改 <code class="docutils literal notranslate"><span class="pre">sshd_config</span></code> 配置文件，可以选择使用软件包维护者版本或保留原先本地配置</p></li>
<li><p>我修订过 <code class="docutils literal notranslate"><span class="pre">/etc/systemd/resolved.conf</span></code> ，所以保留该文件而不是安装的默认配置</p></li>
<li><p>nginx配置也保留原有配置:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>Configuration file &#39;/etc/nginx/nginx.conf&#39;
 ==&gt; Modified (by you or by a script) since installation.
 ==&gt; Package distributor has shipped an updated version.
   What would you like to do about it ?  Your options are:
    Y or I  : install the package maintainer&#39;s version
    N or O  : keep your currently-installed version
      D     : show the differences between the versions
      Z     : start a shell to examine the situation
 The default action is to keep your current version.
*** nginx.conf (Y/I/N/O/D/Z) [default=N] ?
Installing new version of config file /etc/nginx/sites-available/default ...
</pre></div>
</div>
</li>
<li><p>sudo 配置和 sysctl.conf / chrony.conf / sshd.conf / squid.conf</p></li>
<li><p>最后会提示是否移除安装包，回答 <code class="docutils literal notranslate"><span class="pre">y</span></code> ，并重启</p></li>
<li><p>重启后检查版本:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">lsb_release</span> <span class="o">-</span><span class="n">a</span>
</pre></div>
</div>
</li>
</ul>
<p>输出显示升级成功:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">No</span> <span class="n">LSB</span> <span class="n">modules</span> <span class="n">are</span> <span class="n">available</span><span class="o">.</span>
<span class="n">Distributor</span> <span class="n">ID</span><span class="p">:</span>      <span class="n">Ubuntu</span>
<span class="n">Description</span><span class="p">:</span> <span class="n">Ubuntu</span> <span class="mf">22.04.1</span> <span class="n">LTS</span>
<span class="n">Release</span><span class="p">:</span>     <span class="mf">22.04</span>
<span class="n">Codename</span><span class="p">:</span>    <span class="n">jammy</span>
</pre></div>
</div>
<p>Linux版本检查:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">uname</span> <span class="o">-</span><span class="n">mrs</span>
</pre></div>
</div>
<p>可以看到内核从 <code class="docutils literal notranslate"><span class="pre">5.4</span></code> 跃升到 <code class="docutils literal notranslate"><span class="pre">5.15</span></code></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Linux</span> <span class="mf">5.15.0</span><span class="o">-</span><span class="mi">48</span><span class="o">-</span><span class="n">generic</span> <span class="n">x86_64</span>
</pre></div>
</div>
<ul>
<li><p>重新激活第三方软件仓库: 第三方软件仓库配置被集中到 <code class="docutils literal notranslate"><span class="pre">/etc/apt/sources.list.d</span></code> 目录下</p></li>
<li><p>最后清理磁盘空间，删除不需要的文件:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">apt</span> <span class="n">autoremove</span> <span class="o">--</span><span class="n">purge</span>
</pre></div>
</div>
</li>
</ul>
</section>
<section id="id3">
<h2>升级失败的处理<a class="headerlink" href="#id3" title="Link to this heading"></a></h2>
<p>我在 <a class="reference internal" href="../../../ceph/deploy/install_ceph_manual/ceph_os_upgrade_ubuntu_22.04.html#ceph-os-upgrade-ubuntu-22-04"><span class="std std-ref">Ceph底层Ubuntu操作系统升级到22.04</span></a> 没有在虚拟机根目录保留足够的空间，所以导致安装最后生成 <code class="docutils literal notranslate"><span class="pre">initrd.img</span></code> 失败:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Processing</span> <span class="n">triggers</span> <span class="k">for</span> <span class="n">dbus</span> <span class="p">(</span><span class="mf">1.12.20</span><span class="o">-</span><span class="mi">2</span><span class="n">ubuntu4</span><span class="mf">.1</span><span class="p">)</span> <span class="o">...</span>
<span class="n">Processing</span> <span class="n">triggers</span> <span class="k">for</span> <span class="n">linux</span><span class="o">-</span><span class="n">image</span><span class="o">-</span><span class="mf">5.15.0</span><span class="o">-</span><span class="mi">52</span><span class="o">-</span><span class="n">generic</span> <span class="p">(</span><span class="mf">5.15.0</span><span class="o">-</span><span class="mf">52.58</span><span class="p">)</span> <span class="o">...</span>
<span class="o">...</span>
<span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">kernel</span><span class="o">/</span><span class="n">postinst</span><span class="o">.</span><span class="n">d</span><span class="o">/</span><span class="n">initramfs</span><span class="o">-</span><span class="n">tools</span><span class="p">:</span>
<span class="n">update</span><span class="o">-</span><span class="n">initramfs</span><span class="p">:</span> <span class="n">Generating</span> <span class="o">/</span><span class="n">boot</span><span class="o">/</span><span class="n">initrd</span><span class="o">.</span><span class="n">img</span><span class="o">-</span><span class="mf">5.15.0</span><span class="o">-</span><span class="mi">52</span><span class="o">-</span><span class="n">generic</span>
<span class="n">zstd</span><span class="p">:</span> <span class="n">error</span> <span class="mi">25</span> <span class="p">:</span> <span class="n">Write</span> <span class="n">error</span> <span class="p">:</span> <span class="n">No</span> <span class="n">space</span> <span class="n">left</span> <span class="n">on</span> <span class="n">device</span> <span class="p">(</span><span class="n">cannot</span> <span class="n">write</span> <span class="n">compressed</span> <span class="n">block</span><span class="p">)</span>
<span class="n">E</span><span class="p">:</span> <span class="n">mkinitramfs</span> <span class="n">failure</span> <span class="n">zstd</span> <span class="o">-</span><span class="n">q</span> <span class="o">-</span><span class="mi">1</span> <span class="o">-</span><span class="n">T0</span> <span class="mi">25</span>
<span class="n">update</span><span class="o">-</span><span class="n">initramfs</span><span class="p">:</span> <span class="n">failed</span> <span class="k">for</span> <span class="o">/</span><span class="n">boot</span><span class="o">/</span><span class="n">initrd</span><span class="o">.</span><span class="n">img</span><span class="o">-</span><span class="mf">5.15.0</span><span class="o">-</span><span class="mi">52</span><span class="o">-</span><span class="n">generic</span> <span class="k">with</span> <span class="mf">1.</span>
<span class="n">run</span><span class="o">-</span><span class="n">parts</span><span class="p">:</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">kernel</span><span class="o">/</span><span class="n">postinst</span><span class="o">.</span><span class="n">d</span><span class="o">/</span><span class="n">initramfs</span><span class="o">-</span><span class="n">tools</span> <span class="n">exited</span> <span class="k">with</span> <span class="k">return</span> <span class="n">code</span> <span class="mi">1</span>
<span class="n">dpkg</span><span class="p">:</span> <span class="n">error</span> <span class="n">processing</span> <span class="n">package</span> <span class="n">linux</span><span class="o">-</span><span class="n">image</span><span class="o">-</span><span class="mf">5.15.0</span><span class="o">-</span><span class="mi">52</span><span class="o">-</span><span class="n">generic</span> <span class="p">(</span><span class="o">--</span><span class="n">configure</span><span class="p">):</span>
 <span class="n">installed</span> <span class="n">linux</span><span class="o">-</span><span class="n">image</span><span class="o">-</span><span class="mf">5.15.0</span><span class="o">-</span><span class="mi">52</span><span class="o">-</span><span class="n">generic</span> <span class="n">package</span> <span class="n">post</span><span class="o">-</span><span class="n">installation</span> <span class="n">script</span> <span class="n">subprocess</span> <span class="n">returned</span> <span class="n">error</span> <span class="n">exit</span> <span class="n">status</span> <span class="mi">1</span>
<span class="n">Errors</span> <span class="n">were</span> <span class="n">encountered</span> <span class="k">while</span> <span class="n">processing</span><span class="p">:</span>
 <span class="n">linux</span><span class="o">-</span><span class="n">image</span><span class="o">-</span><span class="mf">5.15.0</span><span class="o">-</span><span class="mi">52</span><span class="o">-</span><span class="n">generic</span>
<span class="ne">Exception</span> <span class="n">during</span> <span class="n">pm</span><span class="o">.</span><span class="n">DoInstall</span><span class="p">():</span>  <span class="n">E</span><span class="p">:</span><span class="n">Sub</span><span class="o">-</span><span class="n">process</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">dpkg</span> <span class="n">returned</span> <span class="n">an</span> <span class="n">error</span> <span class="n">code</span> <span class="p">(</span><span class="mi">1</span><span class="p">)</span>

<span class="n">Could</span> <span class="ow">not</span> <span class="n">install</span> <span class="n">the</span> <span class="n">upgrades</span>

<span class="n">The</span> <span class="n">upgrade</span> <span class="n">has</span> <span class="n">aborted</span><span class="o">.</span> <span class="n">Your</span> <span class="n">system</span> <span class="n">could</span> <span class="n">be</span> <span class="ow">in</span> <span class="n">an</span> <span class="n">unusable</span> <span class="n">state</span><span class="o">.</span> <span class="n">A</span>
<span class="n">recovery</span> <span class="n">will</span> <span class="n">run</span> <span class="n">now</span> <span class="p">(</span><span class="n">dpkg</span> <span class="o">--</span><span class="n">configure</span> <span class="o">-</span><span class="n">a</span><span class="p">)</span><span class="o">.</span>

<span class="n">Please</span> <span class="n">report</span> <span class="n">this</span> <span class="n">bug</span> <span class="ow">in</span> <span class="n">a</span> <span class="n">browser</span> <span class="n">at</span>
<span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">bugs</span><span class="o">.</span><span class="n">launchpad</span><span class="o">.</span><span class="n">net</span><span class="o">/</span><span class="n">ubuntu</span><span class="o">/+</span><span class="n">source</span><span class="o">/</span><span class="n">ubuntu</span><span class="o">-</span><span class="n">release</span><span class="o">-</span><span class="n">upgrader</span><span class="o">/+</span><span class="n">filebug</span>
<span class="ow">and</span> <span class="n">attach</span> <span class="n">the</span> <span class="n">files</span> <span class="ow">in</span> <span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">log</span><span class="o">/</span><span class="n">dist</span><span class="o">-</span><span class="n">upgrade</span><span class="o">/</span> <span class="n">to</span> <span class="n">the</span> <span class="n">bug</span> <span class="n">report</span><span class="o">.</span>
<span class="n">E</span><span class="p">:</span><span class="n">Sub</span><span class="o">-</span><span class="n">process</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">dpkg</span> <span class="n">returned</span> <span class="n">an</span> <span class="n">error</span> <span class="n">code</span> <span class="p">(</span><span class="mi">1</span><span class="p">)</span>

<span class="n">Setting</span> <span class="n">up</span> <span class="n">linux</span><span class="o">-</span><span class="n">image</span><span class="o">-</span><span class="mf">5.15.0</span><span class="o">-</span><span class="mi">52</span><span class="o">-</span><span class="n">generic</span> <span class="p">(</span><span class="mf">5.15.0</span><span class="o">-</span><span class="mf">52.58</span><span class="p">)</span> <span class="o">...</span>
<span class="n">Processing</span> <span class="n">triggers</span> <span class="k">for</span> <span class="n">linux</span><span class="o">-</span><span class="n">image</span><span class="o">-</span><span class="mf">5.15.0</span><span class="o">-</span><span class="mi">52</span><span class="o">-</span><span class="n">generic</span> <span class="p">(</span><span class="mf">5.15.0</span><span class="o">-</span><span class="mf">52.58</span><span class="p">)</span> <span class="o">...</span>
<span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">kernel</span><span class="o">/</span><span class="n">postinst</span><span class="o">.</span><span class="n">d</span><span class="o">/</span><span class="n">initramfs</span><span class="o">-</span><span class="n">tools</span><span class="p">:</span>
<span class="n">update</span><span class="o">-</span><span class="n">initramfs</span><span class="p">:</span> <span class="n">Generating</span> <span class="o">/</span><span class="n">boot</span><span class="o">/</span><span class="n">initrd</span><span class="o">.</span><span class="n">img</span><span class="o">-</span><span class="mf">5.15.0</span><span class="o">-</span><span class="mi">52</span><span class="o">-</span><span class="n">generic</span>
<span class="n">zstd</span><span class="p">:</span> <span class="n">error</span> <span class="mi">25</span> <span class="p">:</span> <span class="n">Write</span> <span class="n">error</span> <span class="p">:</span> <span class="n">No</span> <span class="n">space</span> <span class="n">left</span> <span class="n">on</span> <span class="n">device</span> <span class="p">(</span><span class="n">cannot</span> <span class="n">write</span> <span class="n">compressed</span> <span class="n">block</span><span class="p">)</span>
<span class="n">E</span><span class="p">:</span> <span class="n">mkinitramfs</span> <span class="n">failure</span> <span class="n">zstd</span> <span class="o">-</span><span class="n">q</span> <span class="o">-</span><span class="mi">1</span> <span class="o">-</span><span class="n">T0</span> <span class="mi">25</span>
<span class="n">update</span><span class="o">-</span><span class="n">initramfs</span><span class="p">:</span> <span class="n">failed</span> <span class="k">for</span> <span class="o">/</span><span class="n">boot</span><span class="o">/</span><span class="n">initrd</span><span class="o">.</span><span class="n">img</span><span class="o">-</span><span class="mf">5.15.0</span><span class="o">-</span><span class="mi">52</span><span class="o">-</span><span class="n">generic</span> <span class="k">with</span> <span class="mf">1.</span>
<span class="n">run</span><span class="o">-</span><span class="n">parts</span><span class="p">:</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">kernel</span><span class="o">/</span><span class="n">postinst</span><span class="o">.</span><span class="n">d</span><span class="o">/</span><span class="n">initramfs</span><span class="o">-</span><span class="n">tools</span> <span class="n">exited</span> <span class="k">with</span> <span class="k">return</span> <span class="n">code</span> <span class="mi">1</span>
<span class="n">dpkg</span><span class="p">:</span> <span class="n">error</span> <span class="n">processing</span> <span class="n">package</span> <span class="n">linux</span><span class="o">-</span><span class="n">image</span><span class="o">-</span><span class="mf">5.15.0</span><span class="o">-</span><span class="mi">52</span><span class="o">-</span><span class="n">generic</span> <span class="p">(</span><span class="o">--</span><span class="n">configure</span><span class="p">):</span>
 <span class="n">installed</span> <span class="n">linux</span><span class="o">-</span><span class="n">image</span><span class="o">-</span><span class="mf">5.15.0</span><span class="o">-</span><span class="mi">52</span><span class="o">-</span><span class="n">generic</span> <span class="n">package</span> <span class="n">post</span><span class="o">-</span><span class="n">installation</span> <span class="n">script</span> <span class="n">subprocess</span> <span class="n">returned</span> <span class="n">error</span> <span class="n">exit</span> <span class="n">status</span> <span class="mi">1</span>
<span class="n">Errors</span> <span class="n">were</span> <span class="n">encountered</span> <span class="k">while</span> <span class="n">processing</span><span class="p">:</span>
 <span class="n">linux</span><span class="o">-</span><span class="n">image</span><span class="o">-</span><span class="mf">5.15.0</span><span class="o">-</span><span class="mi">52</span><span class="o">-</span><span class="n">generic</span>

<span class="n">Upgrade</span> <span class="n">complete</span>

<span class="n">The</span> <span class="n">upgrade</span> <span class="n">has</span> <span class="n">completed</span> <span class="n">but</span> <span class="n">there</span> <span class="n">were</span> <span class="n">errors</span> <span class="n">during</span> <span class="n">the</span> <span class="n">upgrade</span>
<span class="n">process</span><span class="o">.</span>

<span class="n">To</span> <span class="k">continue</span> <span class="n">please</span> <span class="n">press</span> <span class="p">[</span><span class="n">ENTER</span><span class="p">]</span>
<span class="o">===</span> <span class="n">Command</span> <span class="n">detached</span> <span class="kn">from</span> <span class="nn">window</span> <span class="p">(</span><span class="n">Mon</span> <span class="n">Nov</span>  <span class="mi">7</span> <span class="mi">18</span><span class="p">:</span><span class="mi">02</span><span class="p">:</span><span class="mi">31</span> <span class="mi">2022</span><span class="p">)</span> <span class="o">===</span>
<span class="o">===</span> <span class="n">Command</span> <span class="n">terminated</span> <span class="k">with</span> <span class="n">exit</span> <span class="n">status</span> <span class="mi">1</span> <span class="p">(</span><span class="n">Mon</span> <span class="n">Nov</span>  <span class="mi">7</span> <span class="mi">18</span><span class="p">:</span><span class="mi">02</span><span class="p">:</span><span class="mi">41</span> <span class="mi">2022</span><span class="p">)</span> <span class="o">===</span>
</pre></div>
</div>
<p>可以看到出现问题时正在处理 <code class="docutils literal notranslate"><span class="pre">linux-image-5.15.0-52-generic</span></code> 失败，所以此时不能重启系统，而是立即采用 <a class="reference internal" href="../../../kvm/libvirt/storage/libvirt_lvm_pool_resize_vm_disk.html#libvirt-lvm-pool-resize-vm-disk"><span class="std std-ref">在libvirt LVM卷管理存储池中扩展虚拟机磁盘</span></a> ，再重新安装一遍出错的软件包:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">apt</span> <span class="o">--</span><span class="n">reinstall</span> <span class="n">install</span> <span class="n">linux</span><span class="o">-</span><span class="n">image</span><span class="o">-</span><span class="mf">5.15.0</span><span class="o">-</span><span class="mi">52</span><span class="o">-</span><span class="n">generic</span>
</pre></div>
</div>
<p>确保安装成功后，再做重启</p>
</section>
<section id="id4">
<h2>参考<a class="headerlink" href="#id4" title="Link to this heading"></a></h2>
<ul class="simple">
<li><p><a class="reference external" href="https://jumpcloud.com/blog/how-to-upgrade-ubuntu-20-04-to-ubuntu-22-04">How to Upgrade from Ubuntu 20.04 LTS to Ubuntu 22.04 LTS</a></p></li>
<li><p><a class="reference external" href="https://www.cyberciti.biz/faq/upgrade-ubuntu-20-04-lts-to-22-04-lts/">How to upgrade from Ubuntu 20.04 LTS to 22.04 LTS</a></p></li>
<li><p><a class="reference external" href="https://linuxconfig.org/how-to-upgrade-ubuntu-to-22-04-lts-jammy-jellyfish">How To Upgrade Ubuntu To 22.04 LTS Jammy Jellyfish</a></p></li>
</ul>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="页脚">
        <a href="ubuntu_unattended_upgrade.html" class="btn btn-neutral float-left" title="Ubuntu无人值守升级" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> 上一页</a>
        <a href="ubuntu_grub.html" class="btn btn-neutral float-right" title="Ubuntu修订Grub内核启动参数" accesskey="n" rel="next">下一页 <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; <a href="../../../copyright.html">版权所有</a> 2018 - now, Huatai Huang。</p>
  </div>

  利用 <a href="https://www.sphinx-doc.org/">Sphinx</a> 构建，使用的 
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">主题</a>
    由 <a href="https://readthedocs.org">Read the Docs</a> 开发.
  
    <!-- your html code here -->
    <br>
    <p><a href="https://github.com/huataihuang/cloud-atlas/issues">留言和讨论</a>|<a href="https://github.com/huataihuang/cloud-atlas/blob/master/source/donate.rst">请我喝一杯咖啡 👈</a></p>
    <br>
    <p>网站采用 <a href="https://utteranc.es/">utterances</a> 评论系统，所有评论存储在<a href="https://github.com/huataihuang/cloud-atlas/issues">GitHub issues</a> 中，如果你看不到下方的评论框，那么可能需要<a href="https://cloud-atlas.readthedocs.io/zh-cn/latest/linux/security/vpn/index.html">自备梯子</a> 👈</p>
    <div class="articleComments">
        <comments>
  <script src="https://utteranc.es/client.js"
    repo="huataihuang/cloud-atlas"
    issue-term="pathname"
    theme="github-light"
    crossorigin="anonymous"
    async>
  </script>
</comments>
    </div>


</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>